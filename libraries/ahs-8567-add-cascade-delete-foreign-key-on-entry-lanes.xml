<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
  <changeSet id="65c36fa0-2c8c-47f3-9469-928ead0b0c4e" author="MineStar" failOnError="false">
    <preConditions onFailMessage="Ignored DropForeignKeyConstraint for PLAN_LANE_INFO_ENTRY_LANE_O_FK of table PLAN_LANE_INFO_ENTRY as foreignKey does not exist." onFail="MARK_RAN">
      <foreignKeyConstraintExists foreignKeyTableName="PLAN_LANE_INFO_ENTRY" foreignKeyName="PLAN_LANE_INFO_ENTRY_LANE_O_FK"/>
    </preConditions>
    <comment>AHS-8567: DropForeignKeyConstraint PLAN_LANE_INFO_ENTRY_LANE_O_FK from PLAN_LANE_INFO_ENTRY (LANE_OID)</comment>
    <dropForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" constraintName="PLAN_LANE_INFO_ENTRY_LANE_O_FK"/>
    <rollback>
      <addForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" baseColumnNames="LANE_OID" constraintName="PLAN_LANE_INFO_ENTRY_LANE_O_FK" referencedTableName="LANE" referencedColumnNames="LANE_OID" onDelete="NO ACTION"/>
    </rollback>
  </changeSet>
  <changeSet id="65689b28-0c49-4fcd-8329-352c9a188dbf" author="MineStar" failOnError="false">
    <preConditions onFailMessage="Ignored DropForeignKeyConstraint for PLAN_LANE_INFO_ENTRY_PLAN_O_FK of table PLAN_LANE_INFO_ENTRY as foreignKey does not exist." onFail="MARK_RAN">
      <foreignKeyConstraintExists foreignKeyTableName="PLAN_LANE_INFO_ENTRY" foreignKeyName="PLAN_LANE_INFO_ENTRY_PLAN_O_FK"/>
    </preConditions>
    <comment>AHS-8567: DropForeignKeyConstraint PLAN_LANE_INFO_ENTRY_PLAN_O_FK from PLAN_LANE_INFO_ENTRY (PLAN_OID)</comment>
    <dropForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" constraintName="PLAN_LANE_INFO_ENTRY_PLAN_O_FK"/>
    <rollback>
      <addForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" baseColumnNames="PLAN_OID" constraintName="PLAN_LANE_INFO_ENTRY_PLAN_O_FK" referencedTableName="PLAN_LANE_INFO" referencedColumnNames="PLAN_OID" onDelete="NO ACTION"/>
    </rollback>
  </changeSet>
  <changeSet id="43387c6d-7c27-4a7f-9c57-883bef2fc9e4" author="MineStar" context="Machine_Tracking/Machine_Tracking_Management" failOnError="false">
    <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PLAN_LANE_INFO_ENTRY_LANE_O_FK to table PLAN_LANE_INFO_ENTRY as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
      <columnExists tableName="PLAN_LANE_INFO_ENTRY" columnName="LANE_OID"/>
      <columnExists tableName="LANE" columnName="LANE_OID"/>
      <not>
        <foreignKeyConstraintExists foreignKeyTableName="PLAN_LANE_INFO_ENTRY" foreignKeyName="PLAN_LANE_INFO_ENTRY_LANE_O_FK"/>
      </not>
    </preConditions>
    <comment>AHS-8567: AddForeignKeyConstraint PLAN_LANE_INFO_ENTRY_LANE_O_FK to PLAN_LANE_INFO_ENTRY (LANE_OID)</comment>
    <sql>DELETE FROM PLAN_LANE_INFO_ENTRY WHERE LANE_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM LANE WHERE LANE.LANE_OID = PLAN_LANE_INFO_ENTRY.LANE_OID)</sql>
    <addForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" baseColumnNames="LANE_OID" constraintName="PLAN_LANE_INFO_ENTRY_LANE_O_FK" referencedTableName="LANE" referencedColumnNames="LANE_OID" onDelete="CASCADE"/>
    <rollback>
      <dropForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" constraintName="PLAN_LANE_INFO_ENTRY_LANE_O_FK"/>
    </rollback>
  </changeSet>
  <changeSet id="a5b21f85-8f98-4be6-a1b0-ed72f8ede1bc" author="MineStar" context="Machine_Tracking/Machine_Tracking_Management" failOnError="false">
    <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PLAN_LANE_INFO_ENTRY_PLAN_O_FK to table PLAN_LANE_INFO_ENTRY as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
      <columnExists tableName="PLAN_LANE_INFO_ENTRY" columnName="PLAN_OID"/>
      <columnExists tableName="PLAN_LANE_INFO" columnName="PLAN_OID"/>
      <not>
        <foreignKeyConstraintExists foreignKeyTableName="PLAN_LANE_INFO_ENTRY" foreignKeyName="PLAN_LANE_INFO_ENTRY_PLAN_O_FK"/>
      </not>
    </preConditions>
    <comment>AHS-8567: AddForeignKeyConstraint PLAN_LANE_INFO_ENTRY_PLAN_O_FK to PLAN_LANE_INFO_ENTRY (PLAN_OID)</comment>
    <sql>DELETE FROM PLAN_LANE_INFO_ENTRY WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PLAN_LANE_INFO WHERE PLAN_LANE_INFO.PLAN_OID = PLAN_LANE_INFO_ENTRY.PLAN_OID)</sql>
    <addForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" baseColumnNames="PLAN_OID" constraintName="PLAN_LANE_INFO_ENTRY_PLAN_O_FK" referencedTableName="PLAN_LANE_INFO" referencedColumnNames="PLAN_OID" onDelete="CASCADE"/>
    <rollback>
      <dropForeignKeyConstraint baseTableName="PLAN_LANE_INFO_ENTRY" constraintName="PLAN_LANE_INFO_ENTRY_PLAN_O_FK"/>
    </rollback>
  </changeSet>
</databaseChangeLog>
