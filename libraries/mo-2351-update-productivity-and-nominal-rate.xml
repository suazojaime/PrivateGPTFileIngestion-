<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<!-- Copyright (c) 2021 Caterpillar -->

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">

    <changeSet id="125d5896-eb2a-45d3-add3-0f873b2a3ccb" author="MineStar" context="Pit_Link/Pit_Link_Management" failOnError="false">
        <preConditions onFailMessage="Update RATE column failed because field don't exist" onFail="MARK_RAN">
            <columnExists tableName="MACHINE" columnName="RATE"/>
        </preConditions>
        <comment>MO-2351: Update RATE by multiplying with PRODUCTIVITY and divide by 100</comment>
        <sql>update MACHINE set RATE = RATE * PRODUCTIVITY / 100 WHERE ECF_CLASS_ID like '%Processor%' and PRODUCTIVITY > 100 and RATE > 0</sql>
        <rollback>
            <comment>@EmptyRollback</comment>
        </rollback>
    </changeSet>

    <changeSet id="225d5896-eb2a-45d3-add3-0f873b2a3ccc" author="MineStar" context="Pit_Link/Pit_Link_Management" failOnError="false">
        <preConditions onFailMessage="Update PRODUCTIVITY column failed because field don't exist" onFail="MARK_RAN">
            <columnExists tableName="MACHINE" columnName="PRODUCTIVITY"/>
        </preConditions>
        <comment>MO-2351: Update PRODUCTIVITY to 100 percent</comment>
        <sql>update MACHINE set PRODUCTIVITY = 100 WHERE ECF_CLASS_ID like '%Processor%' and PRODUCTIVITY > 100</sql>
        <rollback>
            <comment>@EmptyRollback</comment>
        </rollback>
    </changeSet>

</databaseChangeLog>
