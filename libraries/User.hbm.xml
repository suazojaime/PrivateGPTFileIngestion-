<?xml version="1.0"?>
<!-- Copyright (c) 2019 Caterpillar -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" default-lazy="false" schema="model">

    <class name="minestar.platform.domain.user.LoginImpl" table="LOGIN">

        <meta attribute="alias" inherit="false">Login</meta>
        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=LOGIN_USERID
            columns=USER_ID
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="description">User login details</meta>

        <id name="OID" type="long" column="OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <property name="userId" type="string" column="USER_ID" length="254" not-null="true"/>

        <property name="status" type="minestar.platform.domain.user.Login$Status$UserType" column="STATUS" not-null="true"/>

        <property name="loginDate" type="TimestampType" column="LOGIN_DATE_UTC">
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The utc date that was logged in</meta>
            <meta attribute="description">The date that was logged in</meta>
        </property>
    </class>

    <class name="minestar.platform.domain.user.AbstractUser" table="USER1" abstract="true">
        <meta attribute="alias" inherit="false">User</meta>
        <meta attribute="view-include">true</meta>
        <meta attribute="view-ignore">false</meta>
        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=USER1_USERID_CLASS_ID
            unique=true
            columns=USERID,CLASS_ID
            tablespace=MW_IDXENT
        </meta>

        <meta attribute="description">User security details</meta>

        <meta attribute="businessKeys">userId</meta>

        <id name="OID" type="long" column="USER_OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <discriminator column="CLASS_ID" length="254"/>

        <property name="userId" type="string" column="USERID" length="254" not-null="true"/>

        <property name="name" type="string" column="NAME" length="254"/>

        <property name="acctActive" type="boolean" column="ACTIVE" not-null="true">
            <meta attribute="defaultValue">true</meta>
        </property>

        <property name="reasonInactive" type="string" column="REASONINACTIVE" length="254"/>

        <subclass name="minestar.platform.domain.user.MineStarUser" discriminator-value="MineStarUser">

            <!-- Credentials are typically hex encodings of a hash value, so a typical 256-bit hash
                 would require 64 characters to represent 32 bytes.

                 Implicitly hash algorithms up to 512 bits (requiring 128 hex characters) can be
                 stored in 254 characters. -->
            <property name="authentication" type="string" column="AUTHENTICATION" length="254">
                <meta attribute="description">The authentication data.</meta>
            </property>

            <!-- The authentication spec can include the algorithm name and the hex-encoded salt, and
                 the salt should be as long as the hash. If the typical 256-bit (32-byte) hash is used
                 then the salt hex encoding would require 64 characters of storage. The algorithm names
                 may require around 32 characters of storage (e.g. 'PBKDF2WithHMACSHA1_AES128'), and
                 the various other parameters (iterations, key lengths) may require around 16 characters.

                 Implicitly hash algorithms up to 512 bits (requiring 128 hex characters) can be stored
                 in 254 characters. -->
            <property name="authenticationSpec" type="string" column="AUTHENTICATION_SPEC" length="254">
                <meta attribute="description">The authentication algorithm parameters.</meta>
            </property>

            <property name="email" type="string" column="EMAIL" length="254"/>

            <property name="menuset" type="string" column="MENUSET" length="254">
                <meta attribute="choices" inherit="false">choice:userMenuset</meta>
            </property>

            <property name="passwordExpires" type="java.util.Date" column="PASSWORDEXPIRES"/>

            <property name="passwordLastChanged" type="java.util.Date" column="PASSWORDLASTCHANGED"/>

            <property name="passwordReset" type="boolean">
                <meta attribute="defaultValue">false</meta>
                <column name="PASSWORDRESET" not-null="true" default="0"/>
            </property>

            <property name="roles" type="string" column="ROLES" length="254">
                <meta attribute="choices" inherit="false">choice:userRole</meta>
                <meta attribute="defaultValue">Member</meta>
            </property>

            <property name="accountExpires" type="java.util.Date">
                <meta attribute="description">At this time the User Account will expire.</meta>
                <column name="ACCOUNTEXPIRES" not-null="false"/>
            </property>

            <property name="resetAccountExpiryOnLogin" type="boolean">
                <meta attribute="defaultValue">false</meta>
                <meta attribute="description">Reset the User Account if the user trys to login after the accountExpires time.</meta>
                <column name="RESETACCOUNTEXPIRY" not-null="true" default="0"/>
            </property>
        </subclass>

        <subclass name="minestar.platform.domain.user.LdapUser" discriminator-value="LdapUser">
        </subclass>
    </class>

    <!-- ****************************************************************************** -->
    <!-- UserReference -->
    <!-- ****************************************************************************** -->
    <class name="minestar.platform.domain.user.UserReference" table="USER1" mutable="false" lazy="false">
        <meta attribute="alias" inherit="false">USER_REFERENCE</meta>
        <meta attribute="description">A minimal reference to a user</meta>
        <meta attribute="view-create-order">1</meta>

        <cache usage="read-only" region="model"/>

        <id name="OID" type="long" column="USER_OID"/>
        <property name="name" type="string" column="NAME" length="254" not-null="true"/>
        <property name="userId" type="string" column="USERID" length="254" not-null="true"/>
    </class>

</hibernate-mapping>
