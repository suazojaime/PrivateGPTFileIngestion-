<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!-- Copyright (c) 2020 Caterpillar -->

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">

    <changeSet id="db724cc1-ed2c-4c5b-9f87-93f5f4a4c1ed" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN</comment>
        <createTable tablespace="MW_ENT" remarks="Store Plan details" tableName="PROD_PLAN">
            <column name="OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="VERSION" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="EXTERNAL_REF" type="VARCHAR(254)">
                <constraints nullable="false"/>
            </column>
            <column name="SITE_NAME" type="VARCHAR(254)"/>
            <column name="PLANNED_START_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan starting">
                <constraints nullable="false"/>
            </column>
            <column name="PLANNED_END_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan ending">
                <constraints nullable="false"/>
            </column>
            <column name="ACTUAL_START_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan starting"/>
            <column name="ACTUAL_END_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan ending"/>
            <column name="MESSAGE_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of message"/>
            <column name="CREATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of plan created"/>
            <column name="UPDATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of plan created"/>
            <column name="STATUS" type="VARCHAR(254)" remarks="Status">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN"/>
        <addUniqueConstraint columnNames="EXTERNAL_REF" constraintName="PROD_PLAN_EXTERNAL_REF_UK" tableName="PROD_PLAN"/>
        <createIndex unique="false" tablespace="MW_IDXENT" indexName="PLANNED_START_TIMESTAMP" tableName="PROD_PLAN">
            <column name="PLANNED_START_TIMESTAMP_UTC"/>
        </createIndex>
        <createIndex unique="false" tablespace="MW_IDXENT" indexName="PLANNED_END_TIMESTAMP" tableName="PROD_PLAN">
            <column name="PLANNED_END_TIMESTAMP_UTC"/>
        </createIndex>
        <createIndex unique="false" tablespace="MW_IDXENT" indexName="ACTUAL_START_TIMESTAMP" tableName="PROD_PLAN">
            <column name="ACTUAL_START_TIMESTAMP_UTC"/>
        </createIndex>
        <createIndex unique="false" tablespace="MW_IDXENT" indexName="ACTUAL_END_TIMESTAMP" tableName="PROD_PLAN">
            <column name="ACTUAL_END_TIMESTAMP_UTC"/>
        </createIndex>
        <createIndex unique="false" tablespace="MW_IDXENT" indexName="CREATED_DATE" tableName="PROD_PLAN">
            <column name="CREATED_DATE_UTC"/>
        </createIndex>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="431e7acb-56b5-428f-82fc-87ccfb9f008d" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_BACKUP_DUMP as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_BACKUP_DUMP"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_BACKUP_DUMP</comment>
        <createTable tablespace="MW_ENT" tableName="PROD_PLAN_BACKUP_DUMP">
            <column name="PLAN_SOURCE_OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="DUMP_NR" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="DUMP_REFERENCE" type="VARCHAR(254)"/>
            <column name="PRIORITY" type="INT"/>
        </createTable>
        <addPrimaryKey columnNames="PLAN_SOURCE_OID,DUMP_NR" constraintName="PROD_PLAN_BACKUP_DUMP_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_BACKUP_DUMP"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="974d23ad-8062-4dd4-aa7c-058d14b61ae2" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_COMMENT as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_COMMENT"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_COMMENT</comment>
        <createTable tablespace="MW_ENT" tableName="PROD_PLAN_COMMENT">
            <column name="PLAN_OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="COMMENT_NR" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="PRIORITY" type="INT"/>
            <column name="DESCRIPTION" type="VARCHAR(1000)"/>
            <column name="IMPORTANT" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey columnNames="PLAN_OID,COMMENT_NR" constraintName="PROD_PLAN_COMMENT_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_COMMENT"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="488669cd-0e5e-42ce-96d8-16e4c93adc76" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_DUMP_ORDER as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_DUMP_ORDER"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_DUMP_ORDER</comment>
        <createTable tablespace="MW_ENT" remarks="Store Plan Dump Order details" tableName="PROD_PLAN_DUMP_ORDER">
            <column name="OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="PRIORITY" type="INT"/>
            <column name="DUMP_REFERENCE" type="VARCHAR(254)"/>
            <column name="PLANNED_MASS" type="DOUBLE" remarks="Planned Mass"/>
            <column name="PLAN_OID" type="BIGINT"/>
            <column name="ORDER_NR" type="INT"/>
        </createTable>
        <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_DUMP_ORDER_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_DUMP_ORDER"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="286add93-0f6d-48ae-bf2c-5a6442621108" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_FEED_OPTION as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_FEED_OPTION"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_FEED_OPTION</comment>
        <createTable tablespace="MW_ENT" tableName="PROD_PLAN_FEED_OPTION">
            <column name="PLAN_DUMP_ORDER_OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="OPTION_NR" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="SOURCE_REFERENCE" type="VARCHAR(254)"/>
            <column name="MAX_ALLOWABLE_PERCENTAGE" type="DOUBLE"/>
        </createTable>
        <addPrimaryKey columnNames="PLAN_DUMP_ORDER_OID,OPTION_NR" constraintName="PROD_PLAN_FEED_OPTION_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_FEED_OPTION"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="ef7cdd54-ea15-42a0-aa98-35efed269202" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_JOB as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_JOB"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_JOB</comment>
        <createTable tablespace="MW_ENT" tableName="PROD_PLAN_JOB">
            <column name="PLAN_OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="JOB_NR" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="EQUIPMENT_REFERENCE" type="VARCHAR(254)"/>
            <column name="SOURCE_REFERENCE" type="VARCHAR(254)"/>
            <column name="MATERIAL_REFERENCE" type="VARCHAR(254)"/>
            <column name="DUMP_REFERENCE" type="VARCHAR(254)"/>
            <column name="MINESTAR_SOURCE_REF_OID" type="BIGINT"/>
            <column name="MINESTAR_DUMP_REF_OID" type="BIGINT"/>
            <column name="MINESTAR_EQUIPMENT_REF_OID" type="BIGINT"/>
            <column name="PLANNED_MASS" type="DOUBLE"/>
            <column name="CREATED_DATE_UTC" type="DATETIME2"/>
            <column name="UPDATED_DATE_UTC" type="DATETIME2"/>
        </createTable>
        <addPrimaryKey columnNames="PLAN_OID,JOB_NR" constraintName="PROD_PLAN_JOB_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_JOB"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="7d3621bd-194c-49e3-b81e-41b594664b90" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_METRIC as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_METRIC"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_METRIC</comment>
        <createTable tablespace="MW_ENT" remarks="Store Plan Metric details" tableName="PROD_PLAN_METRIC">
            <column name="OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="METRIC_TYPE" type="VARCHAR(254)" remarks="Priority">
                <constraints nullable="false"/>
            </column>
            <column name="REFERENCE" type="VARCHAR(254)"/>
            <column name="PLANNED_MASS" type="DOUBLE" remarks="Planned Mass"/>
            <column name="CREATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of created"/>
            <column name="UPDATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of created"/>
            <column name="PLAN_OID" type="BIGINT"/>
            <column name="METRIC_NR" type="INT"/>
        </createTable>
        <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_METRIC_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_METRIC"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="0244bd5f-a9e8-4283-b7a1-ea50b875e5ec" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_SCHEDULED_OUTAGE as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_SCHEDULED_OUTAGE"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_SCHEDULED_OUTAGE</comment>
        <createTable tablespace="MW_ENT" tableName="PROD_PLAN_SCHEDULED_OUTAGE">
            <column name="PLAN_OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="OUTAGE_NR" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="REFERENCE" type="VARCHAR(254)"/>
            <column name="DELAY_TYPE" type="VARCHAR(254)"/>
            <column name="PLANNED_START_TIMESTAMP_UTC" type="DATETIME2"/>
            <column name="PLANNED_END_TIMESTAMP_UTC" type="DATETIME2"/>
            <column name="ACTUAL_START_TIMESTAMP_UTC" type="DATETIME2"/>
            <column name="ACTUAL_END_TIMESTAMP_UTC" type="DATETIME2"/>
        </createTable>
        <addPrimaryKey columnNames="PLAN_OID,OUTAGE_NR" constraintName="PROD_PLAN_SCHEDULED_OUTAGE_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_SCHEDULED_OUTAGE"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="3db789cd-74bb-4d9d-adec-91d0f3a30d1c" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_SOURCE as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_SOURCE"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_SOURCE</comment>
        <createTable tablespace="MW_ENT" remarks="Store Plan Source details" tableName="PROD_PLAN_SOURCE">
            <column name="OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="PRIORITY" type="INT"/>
            <column name="SOURCE_REFERENCE" type="VARCHAR(254)"/>
            <column name="EQUIPMENT_REFERENCE" type="VARCHAR(254)"/>
            <column name="MAX_ALLOWABLE_MASS" type="DOUBLE" remarks="Max Allowable Mass"/>
            <column name="MAX_AVAILABLE_MASS" type="DOUBLE" remarks="Max Available Mass"/>
            <column name="PLAN_OID" type="BIGINT"/>
            <column name="SOURCE_NR" type="INT"/>
        </createTable>
        <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_SOURCE_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_SOURCE"/>
        <createIndex unique="false" tablespace="MW_IDXENT" indexName="PLAN_OID" tableName="PROD_PLAN_SOURCE">
            <column name="PLAN_OID"/>
        </createIndex>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="140599ce-6cd4-4a66-9c73-8664012a9e29" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored CreateTable for PROD_PLAN_VALIDATION_ERROR as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="PROD_PLAN_VALIDATION_ERROR"/>
            </not>
        </preConditions>
        <comment>MO-1178: CreateTable PROD_PLAN_VALIDATION_ERROR</comment>
        <createTable tablespace="MW_ENT" tableName="PROD_PLAN_VALIDATION_ERROR">
            <column name="PLAN_OID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="ERROR_NR" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="REFERENCE" type="VARCHAR(254)"/>
        </createTable>
        <addPrimaryKey columnNames="PLAN_OID,ERROR_NR" constraintName="PROD_PLAN_VALIDATION_ERROR_PK" tablespace="MW_IDXENT" tableName="PROD_PLAN_VALIDATION_ERROR"/>
        <modifySql dbms="mssql,h2,postgresql" applyToRollback="true">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    <changeSet id="e184e0e2-8111-4d58-ba5d-9eb1501a26ce" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_BACKUP_DUMP_PLAN_FK to table PROD_PLAN_BACKUP_DUMP as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_BACKUP_DUMP" columnName="PLAN_SOURCE_OID"/>
            <columnExists tableName="PROD_PLAN_SOURCE" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_BACKUP_DUMP" foreignKeyName="PROD_PLAN_BACKUP_DUMP_PLAN_FK"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_BACKUP_DUMP_PLAN_FK to PROD_PLAN_BACKUP_DUMP (PLAN_SOURCE_OID)</comment>
        <sql>DELETE FROM PROD_PLAN_BACKUP_DUMP WHERE PLAN_SOURCE_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN_SOURCE WHERE PROD_PLAN_SOURCE.OID = PROD_PLAN_BACKUP_DUMP.PLAN_SOURCE_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_BACKUP_DUMP" baseColumnNames="PLAN_SOURCE_OID" constraintName="PROD_PLAN_BACKUP_DUMP_PLAN_FK" referencedTableName="PROD_PLAN_SOURCE" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="PROD_PLAN_BACKUP_DUMP" constraintName="PROD_PLAN_BACKUP_DUMP_PLAN_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="66dc5bf1-d768-4dc1-88f3-f4709212607e" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_COMMENT_PLAN_OID_FK to table PROD_PLAN_COMMENT as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_COMMENT" columnName="PLAN_OID"/>
            <columnExists tableName="PROD_PLAN" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_COMMENT" foreignKeyName="PROD_PLAN_COMMENT_PLAN_OID_FK"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_COMMENT_PLAN_OID_FK to PROD_PLAN_COMMENT (PLAN_OID)</comment>
        <sql>DELETE FROM PROD_PLAN_COMMENT WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN WHERE PROD_PLAN.OID = PROD_PLAN_COMMENT.PLAN_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_COMMENT" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_COMMENT_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="PROD_PLAN_COMMENT" constraintName="PROD_PLAN_COMMENT_PLAN_OID_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="d2a2bb61-8c9f-4fb0-9b42-3414ee97866b" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_DUMP_ORDER_PLAN_O_FK to table PROD_PLAN_DUMP_ORDER as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_DUMP_ORDER" columnName="PLAN_OID"/>
            <columnExists tableName="PROD_PLAN" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_DUMP_ORDER" foreignKeyName="PROD_PLAN_DUMP_ORDER_PLAN_O_FK"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_DUMP_ORDER_PLAN_O_FK to PROD_PLAN_DUMP_ORDER (PLAN_OID)</comment>
        <sql>UPDATE PROD_PLAN_DUMP_ORDER SET PLAN_OID = NULL WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN WHERE PROD_PLAN.OID = PROD_PLAN_DUMP_ORDER.PLAN_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_DUMP_ORDER" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_DUMP_ORDER_PLAN_O_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="PROD_PLAN_DUMP_ORDER" constraintName="PROD_PLAN_DUMP_ORDER_PLAN_O_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="3d4a359c-1577-456c-9090-4c6bf1948498" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_FEED_OPTION_PLAN_FK to table PROD_PLAN_FEED_OPTION as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_FEED_OPTION" columnName="PLAN_DUMP_ORDER_OID"/>
            <columnExists tableName="PROD_PLAN_DUMP_ORDER" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_FEED_OPTION" foreignKeyName="PROD_PLAN_FEED_OPTION_PLAN_FK"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_FEED_OPTION_PLAN_FK to PROD_PLAN_FEED_OPTION (PLAN_DUMP_ORDER_OID)</comment>
        <sql>DELETE FROM PROD_PLAN_FEED_OPTION WHERE PLAN_DUMP_ORDER_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN_DUMP_ORDER WHERE PROD_PLAN_DUMP_ORDER.OID = PROD_PLAN_FEED_OPTION.PLAN_DUMP_ORDER_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_FEED_OPTION" baseColumnNames="PLAN_DUMP_ORDER_OID" constraintName="PROD_PLAN_FEED_OPTION_PLAN_FK" referencedTableName="PROD_PLAN_DUMP_ORDER" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback/>
    </changeSet>
    <changeSet id="0c5b9aa7-cf05-4c61-9462-87b4cf3041ef" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_JOB_PLAN_OID_FK to table PROD_PLAN_JOB as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_JOB" columnName="PLAN_OID"/>
            <columnExists tableName="PROD_PLAN" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_JOB" foreignKeyName="PROD_PLAN_JOB_PLAN_OID_FK"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_JOB_PLAN_OID_FK to PROD_PLAN_JOB (PLAN_OID)</comment>
        <sql>DELETE FROM PROD_PLAN_JOB WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN WHERE PROD_PLAN.OID = PROD_PLAN_JOB.PLAN_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_JOB" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_JOB_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="PROD_PLAN_JOB" constraintName="PROD_PLAN_JOB_PLAN_OID_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="0c6b78c1-f908-4dc1-ac47-2a905dbc4fb9" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_METRIC_PLAN_OID_FK to table PROD_PLAN_METRIC as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_METRIC" columnName="PLAN_OID"/>
            <columnExists tableName="PROD_PLAN" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_METRIC" foreignKeyName="PROD_PLAN_METRIC_PLAN_OID_FK"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_METRIC_PLAN_OID_FK to PROD_PLAN_METRIC (PLAN_OID)</comment>
        <sql>UPDATE PROD_PLAN_METRIC SET PLAN_OID = NULL WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN WHERE PROD_PLAN.OID = PROD_PLAN_METRIC.PLAN_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_METRIC" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_METRIC_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="PROD_PLAN_METRIC" constraintName="PROD_PLAN_METRIC_PLAN_OID_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="b238b4b2-8a60-4fe6-8835-9c98311ee25f" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_SCHEDULED_OUTAGE_FK1 to table PROD_PLAN_SCHEDULED_OUTAGE as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_SCHEDULED_OUTAGE" columnName="PLAN_OID"/>
            <columnExists tableName="PROD_PLAN" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_SCHEDULED_OUTAGE" foreignKeyName="PROD_PLAN_SCHEDULED_OUTAGE_FK1"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_SCHEDULED_OUTAGE_FK1 to PROD_PLAN_SCHEDULED_OUTAGE (PLAN_OID)</comment>
        <sql>DELETE FROM PROD_PLAN_SCHEDULED_OUTAGE WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN WHERE PROD_PLAN.OID = PROD_PLAN_SCHEDULED_OUTAGE.PLAN_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_SCHEDULED_OUTAGE" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_SCHEDULED_OUTAGE_FK1" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="PROD_PLAN_SCHEDULED_OUTAGE" constraintName="PROD_PLAN_SCHEDULED_OUTAGE_FK1"/>
        </rollback>
    </changeSet>
    <changeSet id="24b6b2f5-437e-4fdb-b790-9b230d0a546e" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_SOURCE_PLAN_OID_FK to table PROD_PLAN_SOURCE as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_SOURCE" columnName="PLAN_OID"/>
            <columnExists tableName="PROD_PLAN" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_SOURCE" foreignKeyName="PROD_PLAN_SOURCE_PLAN_OID_FK"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_SOURCE_PLAN_OID_FK to PROD_PLAN_SOURCE (PLAN_OID)</comment>
        <sql>UPDATE PROD_PLAN_SOURCE SET PLAN_OID = NULL WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN WHERE PROD_PLAN.OID = PROD_PLAN_SOURCE.PLAN_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_SOURCE" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_SOURCE_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="PROD_PLAN_SOURCE" constraintName="PROD_PLAN_SOURCE_PLAN_OID_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="8dd08baa-5169-41dc-aed5-5eab916139fb" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for PROD_PLAN_VALIDATION_ERROR_FK1 to table PROD_PLAN_VALIDATION_ERROR as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="PROD_PLAN_VALIDATION_ERROR" columnName="PLAN_OID"/>
            <columnExists tableName="PROD_PLAN" columnName="OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="PROD_PLAN_VALIDATION_ERROR" foreignKeyName="PROD_PLAN_VALIDATION_ERROR_FK1"/>
            </not>
        </preConditions>
        <comment>MO-1178: AddForeignKeyConstraint PROD_PLAN_VALIDATION_ERROR_FK1 to PROD_PLAN_VALIDATION_ERROR (PLAN_OID)</comment>
        <sql>DELETE FROM PROD_PLAN_VALIDATION_ERROR WHERE PLAN_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PROD_PLAN WHERE PROD_PLAN.OID = PROD_PLAN_VALIDATION_ERROR.PLAN_OID)</sql>
        <addForeignKeyConstraint baseTableName="PROD_PLAN_VALIDATION_ERROR" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_VALIDATION_ERROR_FK1" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        <rollback/>
    </changeSet>

</databaseChangeLog>
