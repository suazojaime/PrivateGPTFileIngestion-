<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    <changeSet id="97db4f9c-3e64-4b02-a6e2-194186169501" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropNotNullConstraint for MACHINE.STOP_ON_SCALE as column does not exist or is already nullable" onFail="MARK_RAN">
            <ext:columnIsNotNullable tableName="MACHINE" columnName="STOP_ON_SCALE"/>
        </preConditions>
        <comment>MO-100074: Dropping Not NUll constraint</comment>
        <dropNotNullConstraint tableName="MACHINE" columnName="STOP_ON_SCALE" columnDataType="BOOLEAN"/>
        <rollback/>
    </changeSet>
    <changeSet id="a28092ad-85e2-40fb-833d-c9806eb0d552" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINE.STOP_ON_SCALE as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINE" columnName="STOP_ON_SCALE"/>
        </preConditions>
        <comment>MO-100074: DropDefaultValue '0' from MACHINE.STOP_ON_SCALE</comment>
        <dropDefaultValue columnName="STOP_ON_SCALE" columnDataType="BOOLEAN" tableName="MACHINE"/>
        <rollback>
            <addDefaultValue columnName="STOP_ON_SCALE" columnDataType="BOOLEAN" defaultValueNumeric="0" tableName="MACHINE"/>
        </rollback>
    </changeSet>

    <changeSet id="c581f4ac-2ac5-4096-809d-06b1dbd66277" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropColumn for STOP_ON_SCALE of table MACHINE as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="MACHINE" columnName="STOP_ON_SCALE"/>
        </preConditions>
        <comment>MO-10001: DropColumn MACHINE.STOP_ON_SCALE</comment>
        <dropColumn columnName="STOP_ON_SCALE" tableName="MACHINE"/>
        <rollback/>
    </changeSet>
    <changeSet id="9325df58-3be2-4ec9-86ed-91f744ac5b2c" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Add Column STOP_REQUIRED." onFail="MARK_RAN">
            <tableExists tableName="MACHINE"/>
            <not>
                <columnExists tableName="MACHINE" columnName="STOP_REQUIRED"/>
            </not>
        </preConditions>
        <comment>MO-10001: Add Column STOP_REQUIRED to machine table</comment>
        <addColumn tableName="MACHINE">
            <column name="STOP_REQUIRED" type="BOOLEAN" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="19cf3a98-4b0c-4abd-a82a-6d394ffe3c07" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored RenameColumn for OVER_SIZE_DETECTION of table MACHINE as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="MACHINE" columnName="OVER_SIZED_SENSING"/>
        </preConditions>
        <comment>MO-10001: RenameColumn MACHINE.OVER_SIZED_SENSING</comment>
        <renameColumn oldColumnName="OVER_SIZED_SENSING" newColumnName="OVER_SIZE_DETECTION" tableName="MACHINE"/>
        <rollback>
            <renameColumn oldColumnName="OVER_SIZE_DETECTION" newColumnName="OVER_SIZED_SENSING" tableName="MACHINE"/>
        </rollback>
    </changeSet>

    <changeSet id="a2f18cd3-fe5c-42c4-befa-d424b2176928" author="MineStar" failOnError="false">
        <comment>MO-10042: Update discriminators</comment>
        <update tableName="MACHINE">
            <column name="ECF_CLASS_ID" value="XAEntity.Machine.FixedPlant.PayloadService"/>
            <where>ECF_CLASS_ID='XAEntity.Machine.FixedPlant.Scale'</where>
        </update>
        <update tableName="MACHINECLASS">
            <column name="ECF_CLASS_ID" value="XAEntity.MachineClass.FixedPlantClass.PayloadServiceClass"/>
            <where>ECF_CLASS_ID='XAEntity.MachineClass.FixedPlantClass.ScaleClass'</where>
        </update>
        <update tableName="MACHINECATEGORY">
            <column name="ECF_CLASS_ID" value="XAEntity.MachineCategory.PayloadServiceCategory"/>
            <where>ECF_CLASS_ID='XAEntity.MachineCategory.ScaleCategory'</where>
        </update>
        <rollback>
            <update tableName="MACHINE">
                <column name="ECF_CLASS_ID" value="XAEntity.Machine.FixedPlant.Scale"/>
                <where>ECF_CLASS_ID='XAEntity.Machine.FixedPlant.PayloadService'</where>
            </update>
            <update tableName="MACHINECLASS">
                <column name="ECF_CLASS_ID" value="XAEntity.MachineClass.FixedPlantClass.ScaleClass"/>
                <where>ECF_CLASS_ID='XAEntity.MachineClass.FixedPlantClass.PayloadServiceClass'</where>
            </update>
            <update tableName="MACHINECATEGORY">
                <column name="ECF_CLASS_ID" value="XAEntity.MachineCategory.ScaleCategory"/>
                <where>ECF_CLASS_ID='XAEntity.MachineCategory.PayloadServiceCategory'</where>
            </update>
        </rollback>
    </changeSet>
</databaseChangeLog>
