<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" default-lazy="false" schema="model">

    <class name="minestar.mine.domain.minemodel.WaypointImpl"
           table="VIRTUALBEACON">

        <meta attribute="alias" inherit="false">Waypoint</meta>

        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=VIRTUALBEACON_ID
            unique=true
            columns=ID
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=VIRTUALBEACON_NAME
            unique=true
            columns=NAME
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="description">A mine model waypoint.</meta>
        <meta attribute="view-create-order">1</meta>

        <cache usage="read-write" region="model"/>

        <id name="OID" type="long" column="VIRTUALBEACON_OID">
            <generator class="assigned"/>
        </id>

        <property name="modelUpdateVersion"
                  type="long">
            <meta attribute="description">The mine model update version when the waypoint was created/modified.</meta>
            <column name="MODEL_UPDATE_VERSION" not-null="true" default="0"/>
        </property>

        <property name="layerUpdateVersion" type="long">
            <meta attribute="description">The layer update version when the waypoint was created/modified.</meta>
            <column name="LAYER_UPDATE_VERSION" not-null="true" default="0"/>
        </property>

        <property name="active" type="boolean">
            <meta attribute="description">Is this waypoint active</meta>
            <column name="IS_ACTIVE" not-null="true" default="1"/>
        </property>

        <property name="name" type="string" column="NAME" length="254" not-null="true">
            <meta attribute="description">The name of the waypoint.</meta>
        </property>

        <property name="description" type="string" column="DESCRIPTION" length="254">
            <meta attribute="description">The description of the waypoint.</meta>
        </property>

        <property name="color" type="byte">
            <meta attribute="description">The colour of the waypoint.</meta>
            <meta attribute="choices" inherit="false">choice:officeWaypointColor</meta>
            <column name="COLOUR" not-null="true" default="0"/>
        </property>

        <property name="dateLastModified" type="TimestampType" column="DATE_LAST_MODIFIED_UTC">
            <meta attribute="utc-description">The utc date the waypoint was last modified.</meta>
            <meta attribute="description">The date the waypoint was last modified.</meta>
            <meta attribute="view-localtime">true</meta>
        </property>

        <property name="flags" type="byte">
            <meta attribute="description">
                Beacon flags:
                Bit 0: Send location on entry to beacon boundary 0 = No, 1 = Yes
                Bit 1: Send location on exit from beacon boundary 0 = No, 1 = Yes
                Bit 2: Use route point 0 = No, 1 = Yes
                Bit 3: Machine ID 0 = No, 1 = Yes
                Bit 4: Fill polygon - Open polygon 0 = No, 1 = Yes
                Bit 5: Is the waypoint a parent? 0 = No, 1 = Yes
                Bits 6-7: Reserved - set to 0
            </meta>
            <meta attribute="choices" inherit="false">choice:eqmtOnbdWaypointFlag</meta>
            <column name="FLAGS" not-null="true" default="0"/>
        </property>

        <property name="height" column="HEIGHT">
            <meta attribute="description">The height of the waypoint.</meta>
            <meta attribute="unitType">length</meta>
            <type name="quantity">
                <param name="unitType">length</param>
            </type>
        </property>

        <property name="id" type="int" column="ID" not-null="true">
            <meta attribute="description">The ID of the waypoint.</meta>
            <meta attribute="universe-type-measure">false</meta>
            <meta attribute="export-marshall" inherit="false">true</meta>
        </property>

        <property name="loaderID" type="java.lang.Integer" column="LOADERID">
            <meta attribute="description">The ID of the loader at the waypoint.</meta>
        </property>

        <property name="radius" column="RADIUS">
            <meta attribute="description">The radius of the waypoint.</meta>
            <meta attribute="unitType">length</meta>
            <type name="quantity">
                <param name="unitType">length</param>
            </type>
        </property>

        <property name="reassignmt" type="boolean">
            <meta attribute="description">Trucks request a reassignment when empty at this waypoint (0=No, 1=Yes).</meta>
            <column name="REASSIGNMT" not-null="true" default="0"/>
        </property>

        <property name="reassignfull" type="boolean">
            <meta attribute="description">Trucks request a reassignment when loaded at this waypoint (0=No, 1=Yes).</meta>
            <column name="REASSIGNFULL" not-null="true" default="0"/>
        </property>

        <property name="type" type="minestar.domain.model.persistence.WaypointTypeUserType" column="TYPE" not-null="true">
            <meta attribute="description">The type of the waypoint.</meta>
            <meta attribute="choices" inherit="false">choice:officeWaypointType</meta>
        </property>

        <property name="versionNum" type="int">
            <meta attribute="description">The version of the waypoint.</meta>
            <column name="VERSION" not-null="true" default="0"/>
        </property>

        <property name="zorder" type="byte">
            <meta attribute="description">The ordering of the points that make up the waypoint.</meta>
            <column name="ZORDER" not-null="true" default="0"/>
        </property>

        <property name="missedCount" type="long">
            <meta attribute="description">The number of times this waypoint was missed when on a trucks path.</meta>
            <column name="MISSED_COUNT" not-null="true" default="0"/>
        </property>

        <property name="routePoint" type="XYZCoordinate">
            <meta attribute="description">The routePoint coordinate for the waypoint.</meta>
            <column name="ROUTE_POINT_X"/>
            <column name="ROUTE_POINT_Y"/>
            <column name="ROUTE_POINT_Z"/>
        </property>

        <property name="externalRef" type="string" column="EXTERNALREF" length="254">
            <meta attribute="description">The external system reference of this waypoint</meta>
        </property>
        <property name="externalDesc" type="string" column="EXTERNALDESC" length="254">
            <meta attribute="description">The External System Description</meta>
        </property>

        <!-- associations -->
        <list name="relativePolygon" table="WAYPOINT_POLYGON" fetch="select" batch-size="100">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>
            <meta attribute="index-alias">pointNr</meta>
            <meta attribute="description">The relative polygon coordinates for the waypoint.</meta>

            <cache usage="read-write" region="model"/>

            <key column="OID" not-null="true"/>
            <index type="java.lang.Integer" column="POINT_NR"/>
            <element type="XYZCoordinate">
                <column name="X_MAGNITUDE"/>
                <column name="Y_MAGNITUDE"/>
                <column name="Z_MAGNITUDE"/>
            </element>
        </list>
    </class>

    <!-- A lightweight reference to a Waypoint -->
    <class name="minestar.mine.domain.minemodel.WaypointReference" table="VIRTUALBEACON" mutable="false" lazy="false">

        <meta attribute="alias" inherit="false">WAYPOINT_REFERENCE</meta>
        <meta attribute="description">A minimal reference to a waypoint.</meta>
        <meta attribute="view-create-order">1</meta>

        <cache usage="read-only" region="model"/>

        <id name="OID" type="long" column="VIRTUALBEACON_OID"/>
        <property name="name" type="string" column="NAME" length="254" not-null="true"/>
        <property name="id" type="int" column="ID" not-null="true"/>
    </class>

</hibernate-mapping>
