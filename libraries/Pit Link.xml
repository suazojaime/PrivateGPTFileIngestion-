<?xml version="1.0" encoding="us-ascii" standalone="no"?>
<!-- Copyright (c) 2018, Caterpillar, Brisbane Australia. All rights reserved. -->

<!DOCTYPE classdefs SYSTEM "metadata.dtd">
<classdefs>
    <classdef name="Generate Coverage Map">
        <!--implclass name='{executor:"JobExecutionService"}'/-->
        <privilege>Generate Coverage Map</privilege>
        <tag>general</tag>
        <propertydef name="executorName">
            <uidef visiblewhen="false"/>
            <defaultvalue>JobExecutionService</defaultvalue>
        </propertydef>
	    <propertygroup name="standardOptions">
    	    <uigroupdef layout="vertical" layoutInfo='{rowSpec="fill:default:grow"}'/>
            <propertydef name="jobUrl">
                <uidef visiblewhen="false"/>
                <defaultvalue>minestar.pitlink.service.jobs.HeatMapJob</defaultvalue>
            </propertydef>
            <propertydef name="mappingProvider" label="Mapping algorithm">
                <typedef><type code="string" choices='{"inverseDistanceWeighting":"IDW"}' /></typedef>
                <uidef visiblewhen="false"/>
                <defaultvalue>inverseDistanceWeighting</defaultvalue>
            </propertydef>
            <propertydef name="parameterName" label="Parameter to Map">
                <typedef><type code="string" choices='{"latency":"Latency","messageRetries":"Message retries","duplicates":"Duplicate Messages","satellites":"Satellites","accuracy":"GPS Accuracy"}' /></typedef>
                <defaultvalue>latency</defaultvalue>
            </propertydef>
            <propertygroup name="imageParameters" label="Image Parameters">
                <propertydef name="directory" label="Image Directory">
                    <typedef>
                        <type code="string"/>
                    </typedef>
                    <uidef widget="directorySelector" mask="networkPathDirectory"/>
                    <defaultvalue type="python">interpretPath('{MSTAR_CONFIG}/explorer/dxf')</defaultvalue>
                    <description>Directory to which images are saved.</description>
                </propertydef>
                <propertydef name="imageType" label="Image Type">
                    <typedef><type code="string" choices='{"png":"PNG","gif":"GIF"}' /></typedef>
                    <defaultvalue>png</defaultvalue>
                </propertydef>
            </propertygroup>
            <propertygroup name="gridParameters" label="Grid Parameters">
                <propertydef name="minX" label="Western boundary of Heat Map in Site Coordinates (Min X)">
                    <typedef><type code="double"/></typedef>
                    <uidef widget="unit" custom='{"unitType":"length","minimumZero"="false"}'/>
                    <description>This sets the western boundary of the resulting map.  If set the boundary is not automatically determined from the data.  This may result in artifacts in regions where little data is available.</description>
                </propertydef>
                <propertydef name="maxX" label="Eastern boundary of Heat Map in Site Coordinates (Max X)">
                    <typedef><type code="double"/></typedef>
                    <uidef widget="unit" custom='{"unitType":"length","minimumZero"="false"}'/>
                    <description>This sets the eastern boundary of the resulting map.  If set the boundary is not automatically determined from the data.  This may result in artifacts in regions where little data is available.</description>
                </propertydef>
                <propertydef name="minY" label="Southern boundary of Heat Map in Site Coordinates (Min Y)">
                    <typedef><type code="double"/></typedef>
                    <uidef widget="unit" custom='{"unitType":"length","minimumZero"="false"}'/>
                    <description>This sets the southern boundary of the resulting map.  If set the boundary is not automatically determined from the data.  This may result in artifacts in regions where little data is available.</description>
                </propertydef>
                <propertydef name="maxY" label="Northern boundary of Heat Map in Site Coordinates (Max Y)">
                    <typedef><type code="double"/></typedef>
                    <uidef widget="unit" custom='{"unitType":"length","minimumZero"="false"}'/>
                    <description>This sets the northern boundary of the resulting map.  If set the boundary is not automatically determined from the data.  This may result in artifacts in regions where little data is available.</description>
                </propertydef>
                <propertydef name="gridSize" label = "Size of pixel in the generated map">
                    <typedef><type code="double"/></typedef>
                    <uidef widget="unit" custom='{"unitType":"length"}'/>
                    <defaultvalue class="java.lang.Double">10</defaultvalue>
                    <description>This sets the physical size of cells used to generate the map.  Available data is accumulated over cells of the specified size in order to estimate the plotted parameter.</description>
                </propertydef>
            </propertygroup>
            <propertygroup name="periodSelection" label="Period Selection">
                <uigroupdef mode="region"/>
                <propertydef name="sourceGWMDirectory" label="GWM File(s) Directory">
                    <typedef>
                        <type code="string"/>
                    </typedef>
                    <uidef widget="directorySelector" mask="networkPathDirectory"/>
                    <defaultvalue type="python">interpretPath('{MSTAR_MESSAGES}')</defaultvalue>
                    <description>Directory of GWM files.</description>
                </propertydef>
                <propertydef name="periodType" label="" >
                    <typedef><type code="int" choices='{0:"Relative",1:"Explicit"}'/></typedef>
                    <uidef widget="radio" processOnChange="true"/>
                    <defaultvalue>0</defaultvalue>
                    <description>Relative = run the job with a time frame relative to the start time of the job</description>
                </propertydef>
                <propertygroup name="relativePeriod" label="Period Selection">
                    <uigroupdef mode="plain" visiblewhen='form.getFieldValue("periodType") == 0'/>
                    <propertydef name="periodOffset" label="Period Offset">
                        <typedef><type code="string" /></typedef>
                        <uidef widget="spinner" />
                        <description>Number of hours previous to run time of job to use</description>
                    </propertydef>
                </propertygroup>
                <propertygroup name="explicitPeriod" label="Period Selection">
                    <uigroupdef mode="plain" visiblewhen='form.getFieldValue("periodType") == 1'/>
                    <propertydef name="periodDesc" label="Period">
                        <typedef><type code="string" /></typedef>
                        <uidef widget="period" option="minDate,maxDate" updateable="false" />
                    </propertydef>
                    <propertydef name="minDate" label="Start Date">
                        <typedef><javaclass name="java.util.Date"/></typedef>
                    </propertydef>
                    <propertydef name="maxDate" label="End Date">
                        <typedef><javaclass name="java.util.Date"/></typedef>
                    </propertydef>
                    <propertydef name="splitByHour" label="Generate images showing coverage for each hour of the nominated period">
                        <typedef><type code="boolean"/></typedef>
                        <defaultvalue>false</defaultvalue>
                        <description>If set, a separate image will be generated showing coverage for each hour within the specified period.</description>
                    </propertydef>
                </propertygroup>
            </propertygroup>
            <propertygroup name="otherProperties" label="Other Parameters">
                <uigroupdef layout="vertical" layoutInfo='{rowSpec="fill:default:grow"}'/>
                <propertydef name="eliminateMachinesWithOutliers" label="Do not include machines with any bad gps data">
                    <typedef><type code="boolean"/></typedef>
                    <defaultvalue>true</defaultvalue>
                    <description>If set, this will eliminate data from any machines found to be returning suspicious GPS during the analysis period.  Setting this will reduce the amount of data available for analysis, but should improve the quality of the resulting map.  A value of 0.9 indicates that only those 90% of point closest to the center of the data should be used.  Other points would be considered outliers.</description>
                </propertydef>
                <propertydef name="alpha" label="Alpha">
                    <typedef><type code="double"/></typedef>
                    <defaultvalue>0.99</defaultvalue>
                    <description>The data is scanned in an attempt to identify points with bad GPS.  The parameter determines the proportion of points used to determine the valid range of GPS coordinates.</description>
                </propertydef>
                <propertydef name="radius" label="Radius">
                    <typedef><type code="double"/></typedef>
                    <uidef widget="unit" custom='{"unitType":"length"}'/>
                    <defaultvalue>20</defaultvalue>
                    <description>The default radius of influence for each data point.  Smaller values lead to maps showing more local peaks.  Larger values lead to maps containing smoothed data.</description>
                </propertydef>
                <propertydef name="threshold" label="Threshold for inclusion">
                    <typedef><type code="double"/></typedef>
                    <defaultvalue>3</defaultvalue>
                    <description>The minimum number of data points required for a map value to be constructed.  Too low a value may lead to artifacts in the resulting map.  Too high a value will stop a map geing generated.</description>
                </propertydef>
            </propertygroup>
        </propertygroup>
        <description>Generate a map of a parameter across the mine site.</description>
    </classdef>

    <classdef name="ExecutorOptions">
        <privilege>Field Communications</privilege>
        <tag>system</tag>
        <propertydef name="executorName">
            <defaultvalue>Onboard Config Service</defaultvalue>
        </propertydef>
    </classdef>

    <classdef name="Record GWM Duplicates Data">
        <!--implclass name='{executor:"JobExecutionService"}'/-->
        <privilege>Record GWM Duplicates Data</privilege>
        <tag>user</tag>
        <propertygroup name="standardOptions">
            <uigroupdef visiblewhen="false"/>

            <propertydef name="jobUrl">
                <uidef visiblewhen="false"/>
                <defaultvalue>minestar.pitlink.service.jobs.GwmDuplicatesReportJob</defaultvalue>
            </propertydef>

            <propertydef name="executorName" access="readonly">
                <uidef visiblewhen="false"/>
                <defaultvalue>JobExecutionService</defaultvalue>
            </propertydef>
        </propertygroup>
        <description>Records the GWM Duplicates Data</description>
    </classdef>

    <classdef name="PositionEventExport">
        <!--implclass name='{executor:"JobExecutionService"}'/-->
        <privilege>Position Analysis</privilege>
        <tag>general</tag>
        <propertydef name="executorName">
            <uidef visiblewhen="false"/>
            <defaultvalue>JobExecutionService</defaultvalue>
        </propertydef>
        <propertygroup name="standardOptions">
            <propertydef name="jobUrl">
                <uidef visiblewhen="false"/>
                <defaultvalue>minestar.platform.service.event.EventPositionExport</defaultvalue>
            </propertydef>
            <propertygroup name="outputFiles" label="Output Files">
                <uigroupdef mode="region"/>
                <propertydef name="positionOutputFile" label="Positions File Name">
                    <typedef><type code="string"/></typedef>
                    <uidef widget="file" mask="networkPath"/>
                    <defaultvalue type="python">interpretNetworkPath('{MSTAR_DATA}/positionEvtInfo.txt')</defaultvalue>
                </propertydef>
                <propertydef name="stateOutputFile" label="States File Name">
                    <typedef><type code="string"/></typedef>
                    <uidef widget="file" mask="networkPath"/>
                    <defaultvalue type="python">interpretNetworkPath('{MSTAR_DATA}/stateEvtInfo.txt')</defaultvalue>
                </propertydef>
                <propertydef name="gpsOutputFile" label="GPS File Name">
                    <typedef><type code="string"/></typedef>
                    <uidef widget="file" mask="networkPath"/>
                    <defaultvalue type="python">interpretNetworkPath('{MSTAR_DATA}/gpsEvtInfo.txt')</defaultvalue>
                </propertydef>
            </propertygroup>
            <propertygroup name="periodSelection" label="Period Selection">
                <uigroupdef mode="region"/>
                <propertydef name="periodType" label="" >
                    <typedef><type code="int" choices='{0:"Relative",1:"Explicit"}'/></typedef>
                    <uidef widget="radio" processOnChange="true"/>
                    <defaultvalue>0</defaultvalue>
                    <description>Relative = run the export with a time frame relative to the start time of the job</description>
                </propertydef>
                <propertygroup name="relativePeriod" label="Period Selection">
                    <uigroupdef mode="plain" visiblewhen='form.getFieldValue("periodType") == 0'/>
                    <propertydef name="periodOffset" label="Period Offset">
                        <typedef><type code="string" /></typedef>
                        <uidef widget="spinner" />
                        <description>Number of hours previous to run time of job to export</description>
                    </propertydef>
                </propertygroup>
                <propertygroup name="explicitPeriod" label="Period Selection">
                    <uigroupdef mode="plain" visiblewhen='form.getFieldValue("periodType") == 1'/>
                    <propertydef name="periodDesc" label="Period">
                        <typedef><type code="string" /></typedef>
                        <uidef widget="period" option="startDate,endDate" updateable="false" />
                    </propertydef>
                    <propertydef name="startDate" label="Start Date">
                        <typedef><javaclass name="java.util.Date"/></typedef>
                    </propertydef>
                    <propertydef name="endDate" label="End Date">
                        <typedef><javaclass name="java.util.Date"/></typedef>
                    </propertydef>
                </propertygroup>
            </propertygroup>
            <propertygroup name="machineSelection" label="Machine Selection">
                <uigroupdef mode="region"/>
                <propertydef name="machinesByCategory" label="" >
                    <typedef><type code="int" choices='{0:"By Category",1:"By Truck/Shovel"}'/></typedef>
                    <uidef widget="radio" processOnChange="true"/>
                    <defaultvalue>0</defaultvalue>
                </propertydef>

                <propertydef name="machineCategories" label="Categories">
                    <typedef>
                        <javaclass name="java.util.Set" choices="service(minestar.pitlink.application.MachineCategoryCollectionProvider):machineCategories" />
                    </typedef>
                    <uidef widget="checkbox" visiblewhen='form.getFieldValue("machinesByCategory") == 0'/>
                </propertydef>

                <propertygroup name="truckshovel" label="">
                    <uigroupdef mode="plain" layout="horizontal"  visiblewhen='form.getFieldValue("machinesByCategory") == 1'/>
                    <propertydef name="trucks" label="Trucks">
                        <typedef>
                            <javaclass name="java.util.Set" choices="machine:Truck" />
                        </typedef>
                        <uidef widget="checkbox"/>
                    </propertydef>

                    <propertydef name="loaders" label="Excavators">
                        <typedef>
                            <javaclass name="java.util.Set" choices="machine:LoadingTool" />
                        </typedef>
                        <uidef widget="checkbox"/>
                    </propertydef>
                </propertygroup>
            </propertygroup>

            <propertygroup name="eventType" label="Event Type">
                <uigroupdef mode="region"/>
                <propertydef name="eventTypes" label="Events">
                    <typedef>
                        <javaclass name="java.util.Set" choices='{
                        "minestar.production.domain.event.PositionReportEvent":"Position Report",
                        "minestar.production.domain.event.DipperReportEvent":"Dipper Report",
                        "minestar.production.domain.event.LoadReportEvent":"Load Report",
                        "minestar.production.domain.event.CycleReportEvent":"Cycle Report",
                        "minestar.production.domain.event.DelayReportEvent":"Delay Report",
                        "minestar.health.domain.event.HealthEvent":"Health Event"}' />
                    </typedef>
                    <uidef widget="checkbox" processOnChange="true"/>
                </propertydef>
                <propertydef name="healthEventName" label="Health Event">
                    <typedef><type code="int" choices="healthConfig.events"/></typedef>
                    <uidef widget="ordered" visiblewhen='form.getFieldValue("eventTypes").contains("minestar.health.domain.event.HealthEvent")'
                            custom='{textFilter=true}'/>
                    <defaultvalue type="python"></defaultvalue>
                </propertydef>
            </propertygroup>
        </propertygroup>
        <description>Export event information for plotting in Minescape.</description>
    </classdef>

    <classdef name="Generate MineStar Files">
        <implclass name='{parametersProcessor:com.mincom.works.page.onboard.JobParametersProcessor}'/>
        <privilege>Generate MineStar Files</privilege>
        <tag>user</tag>
		<propertygroup name="executorOptions">
            <propertydef name="executorName" label="Remote Executor">
                <uidef visiblewhen="false"/>
                <defaultvalue>JobExecutionService</defaultvalue>
            </propertydef>
		</propertygroup>
		<propertygroup name="standardOptions">
			<uigroupdef layout="horizontal" layoutInfo='{rowSpec="fill:default:grow"}'/>
            <propertydef name="jobUrl">
                <uidef visiblewhen="false"/>
                <defaultvalue>com.mincom.integ.cat.equip.onboard.commands.GenerateMineStarFiles</defaultvalue>
            </propertydef>
			<propertydef name="fileTypes" label="">
				<typedef><type code="string" choices="onboard.topeMineStarFiles"/></typedef>
				<uidef widget="onboardFileUpload"/>
			</propertydef>
			<propertydef name="generate" label="Generate">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">true</defaultvalue>
			</propertydef>
			<propertydef name="upload" label="Upload">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">false</defaultvalue>
			</propertydef>
			<propertydef name="activate" label="Activate">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">false</defaultvalue>
			</propertydef>
		</propertygroup>
        <description>Generates onboard files for specified machines</description>
    </classdef>

    <classdef name="Upload MineStar Files">
        <implclass name='{parametersProcessor:com.mincom.works.page.onboard.JobParametersProcessor}'/>
        <privilege>Upload MineStar Files</privilege>
        <tag>user</tag>
		<propertygroup name="executorOptions">
			<uigroupdef source="Jobs:Pit Link.ExecutorOptions" visiblewhen="false" />
		</propertygroup>
		<propertygroup name="standardOptions">
			<uigroupdef layout="horizontal" layoutInfo='{rowSpec="fill:default:grow"}'/>
            <propertydef name="jobUrl">
                <uidef visiblewhen="false"/>
                <defaultvalue>ProcessMineStarFiles</defaultvalue>
            </propertydef>
			<propertydef name="machines" label="">
				<typedef>
                    <javaclass name="minestar.pitlink.domain.machine.Machine" choices="machine.AssignableMachine"/>
					<dimension name="entityOID"  />
				</typedef>
				<uidef widget="machineSelector" visiblewhen='form.getFieldValue("trigger.type") in [0,1]'/>
			</propertydef>
			<propertydef name="fileTypes" label="">
				<typedef><javaclass name="java.util.List" choices="onboard.topeMineStarFiles"/></typedef>
				<uidef widget="onboardFileUpload"/>
			</propertydef>
			<propertydef name="generate" label="Generate">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">false</defaultvalue>
			</propertydef>
			<propertydef name="upload" label="Upload">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">true</defaultvalue>
			</propertydef>
			<propertydef name="activate" label="Activate">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">false</defaultvalue>
			</propertydef>
		</propertygroup>
        <description>Uploads MineStar files to specified machines</description>
    </classdef>

    <classdef name="Activate MineStar Files">
        <implclass name='{parametersProcessor:com.mincom.works.page.onboard.JobParametersProcessor}'/>
        <privilege>Activate MineStar Files</privilege>
        <tag>user</tag>
		<propertygroup name="executorOptions">
			<uigroupdef source="Jobs:Pit Link.ExecutorOptions" visiblewhen="false" />
		</propertygroup>
		<propertygroup name="standardOptions">
			<uigroupdef layout="horizontal" layoutInfo='{rowSpec="fill:default:grow"}'/>
            <propertydef name="jobUrl">
                <uidef visiblewhen="false"/>
                <defaultvalue>ProcessMineStarFiles</defaultvalue>
            </propertydef>
			<propertydef name="machines" label="">
				<typedef>
                    <javaclass name="minestar.pitlink.domain.machine.Machine" choices="machine.AssignableMachine"/>
					<dimension name="entityOID"  />
				</typedef>
				<uidef widget="machineSelector" visiblewhen='form.getFieldValue("trigger.type") in [0,1]'/>
			</propertydef>
			<propertydef name="fileTypes" label="">
				<typedef><type code="string" choices="onboard.topeMineStarFiles"/></typedef>
				<uidef widget="onboardFileUpload"/>
			</propertydef>
			<propertydef name="generate" label="Generate">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">false</defaultvalue>
			</propertydef>
			<propertydef name="upload" label="Upload">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">false</defaultvalue>
			</propertydef>
			<propertydef name="activate" label="Activate">
				<typedef><type code="boolean"/></typedef>
				<uidef visiblewhen="false"/>
				<defaultvalue class="java.lang.Boolean">true</defaultvalue>
			</propertydef>
		</propertygroup>
        <description>Activates MineStar files on specified machines</description>
    </classdef>

</classdefs>
