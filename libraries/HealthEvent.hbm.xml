<?xml version="1.0"?>
<!-- Copyright (c) 2023 Caterpillar -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping schema="historical">

    <class name="minestar.health.domain.event.HealthEvent"
           table="HEALTH_EVENT"
           dynamic-update="true">

        <meta attribute="index">
            name=HEALTH_EVENT_1
            columns=MACHINE_OID,SOURCE_TIMESTAMP_UTC
            tablespace=MW_IDXENT
        </meta>

        <meta attribute="index">
            name=HEALTH_EVENT_2
            columns=MACHINE_OID,TIMESTAMP_UTC
            tablespace=MW_IDXENT
        </meta>

        <meta attribute="index">
            name=HEALTH_EVENT_UNIQ
            columns=MACHINE_OID, NAME, MID, SOURCE_TIMESTAMP_UTC,HELEVEL
            unique=true
            tablespace=MW_IDXENT
        </meta>

        <!--
            Default order is 10
                enter a number either side of 10 to change
                the order the view is created
        -->
        <meta attribute="view-create-order">18</meta>

        <meta attribute="viewproperty-fmiOID" inherit="false">
            type=string
            description=The failure mode indicator associated with the event.
            expression=lookupResource.healthevent.fmiOID.query
        </meta>
        <meta attribute="viewproperty-fmi_N" inherit="false">
            type=string
            description=The failure mode indicator associated with the event.
            expression=lookupResource.healthEvent.fmi_N.query
        </meta>
        <meta attribute="viewproperty-cidOID" inherit="false">
            type=string
            description=The component id associated with the event.
            expression=lookupResource.healthevent.cidOID.query
        </meta>
        <meta attribute="viewproperty-cid_N" inherit="false">
            type=string
            description=The component associated with the event.
            expression=lookupResource.healthEvent.cid_N.query
        </meta>
        <meta attribute="viewproperty-midOID" inherit="false">
            type=string
            description=The module id associated with the event.
            expression=lookupResource.healthevent.midOID.query
        </meta>
        <meta attribute="viewproperty-mid_N" inherit="false">
            type=string
            description=The module associated with the event.
            expression = lookupResource.healthEvent.mid_N.query
        </meta>
        <meta attribute="viewproperty-firstValue_Q" inherit="false">
            type=string
            description=The first value quantity associated with the event.
            expression=lookupResource.healthEvent.firstValue_Q.query
        </meta>
        <meta attribute="viewproperty-firstValue_U" inherit="false">
            type=string
            description=The first value unit associated with the event.
            expression=lookupResource.healthEvent.firstValue_U.query
        </meta>
        <meta attribute="viewproperty-firstValue_D" inherit="false">
            type=string
            description=The decoded text associated with the channel's first value
            expression=lookupResource.healthEvent.firstValue_D.query
        </meta>
        <meta attribute="viewproperty-worstValue_Q" inherit="false">
            type=string
            description=The worst value quantity associated with the event.
            expression=lookupResource.healthEvent.worstValue_Q.query
        </meta>
        <meta attribute="viewproperty-worstValue_U" inherit="false">
            type=string
            description=The worst value unit associated with the event.
            expression=lookupResource.healthEvent.worstValue_U.query
        </meta>

        <meta attribute="viewproperty-worstValue_D" inherit="false">
            type=string
            description=The decoded text associated with the channel's worst value
            expression=lookupResource.healthEvent.worstValue_D.query
        </meta>
        <meta attribute="description">Generic Health Event.</meta>

        <!-- Start BaseEventProperties.xml -->
        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>

        <meta attribute="viewproperty-machineClassOID" inherit="false">
            type=string
            description=The machine class OID, of the entity source, when the entity source is a machine.
            expression=lookupResource.baseEvent.machineClassOID.query
        </meta>
        <meta attribute="viewproperty-machineClass_N" inherit="false">
            type=string
            description=The machine class name, of the entity source, when the entity source is a machine.
            expression=lookupResource.baseEvent.machineClass_N.query
        </meta>
        <meta attribute="viewproperty-interpolatedSMU" inherit="false">
            type=float
            description=The SMU as determined by the SMU Interpolation Service.   To be used when SMU value is not available directly from the event.
            unitType=service meter hours
            expression=lookupResource.baseEvent.interpolatedSMU.query
        </meta>

        <cache usage="nonstrict-read-write" region="eventInstances" />

        <id
                name="OID"
                type="java.lang.Long"
                column="EVENT_OID"
                >
            <meta attribute="description">The object identifier of the entity, unique within its manager.</meta>
            <generator class="com.mincom.env.base.persistence.TableHiLoGenerator"/>
        </id>

        <discriminator column="CLASS_ID" not-null="false" length="254"/>

        <property
                name="name"
                type="java.lang.String"
                column="NAME"
                length="254"
                not-null="true"
                >
            <meta attribute="description">The name of the event.</meta>
        </property>
        <property
                name="eventSource"
                type="java.lang.String"
                column="EVENTSOURCE"
                length="254"
                >
            <meta attribute="description">The object the event came from.</meta>
        </property>

        <property
                name="acknowledged"
                type="java.lang.Boolean"
                column="ACKNOWLEDGED"
                >
            <meta attribute="description">Whether the event has been acknowledged yet.</meta>
            <meta attribute="choices" inherit="false">choice:booleanValue</meta>
        </property>
        <many-to-one
                name="machineRef"
                column="MACHINE_OID"
                not-null="true"
                class="minestar.pitlink.domain.machine.MachineReference"
                access="field"
                >
            <meta attribute="alias">machine</meta>
            <meta attribute="description">The entity the event came from.</meta>
        </many-to-one>
        <property
                name="arrivalTime"
                type="TimestampType"
                column="ARRIVAL_TIME_UTC"
                >
            <meta attribute="utc-description">The utc time the event arrived in the office.</meta>
            <meta attribute="description">The time the event arrived in the office.</meta>
            <meta attribute="view-localtime">true</meta>
        </property>
        <property
                name="timestamp"
                type="TimestampType"
                >
            <meta attribute="utc-description">The utc time the event was created.</meta>
            <meta attribute="description">The time the event was created.</meta>
            <meta attribute="timestamp">true</meta>
            <meta attribute="view-localtime">true</meta>
            <column name="TIMESTAMP_UTC" not-null="true" default="01-JAN-1970"/>
        </property>
        <property
                name="sourceTimestamp"
                type="TimestampType"
                >
            <meta attribute="utc-description">The utc time the original source of the event says the event was created.</meta>
            <meta attribute="description">The time the original source of the event says the event was created.</meta>
            <meta attribute="timestamp">true</meta>
            <meta attribute="view-localtime">true</meta>
            <column name="SOURCE_TIMESTAMP_UTC" not-null="true" default="01-JAN-1970"/>
        </property>
        <property
                name="smu"
                column="SMU"
                >
            <meta attribute="description">The smu of the event.</meta>
            <meta attribute="unitType">service meter hours</meta>
            <type name="quantity">
                <param name="unitType">service meter hours</param>
            </type>
        </property>
        <property
                name="priority"
                type="java.lang.String"
                column="PRIORITY"
                length="254"
                >
            <meta attribute="description">The priority of the event</meta>
        </property>
        <property
                name="description"
                type="java.lang.String"
                column="DESCRIPTION"
                length="508"
                >
            <meta attribute="description">A description of the event in the reporting locale.</meta>
        </property>
        <property
                name="englishDescription"
                type="java.lang.String"
                column="ENGLISH_DESCRIPTION"
                length="254"
                >
            <meta attribute="description">A description of the event in English. Used for debugging by MineStar support staff.</meta>
        </property>
        <property
                name="type"
                type="java.lang.String"
                column="TYPE"
                length="254"
                >
            <meta attribute="description">The type of event</meta>
        </property>
        <many-to-one
                name="acknowledger"
                column="ACKNOWLEDGER_OID"
                class="minestar.machinetracking.domain.PersonReference"
                not-found="ignore"
                >
            <meta attribute="description">The entity which acknowledged the event.</meta>
        </many-to-one>
        <property
                name="flags"
                type="java.lang.Long"
                column="FLAGS"
                access="field"
                >
            <meta attribute="description">Extra flags.</meta>
        </property>
        <many-to-one
                name="entityDestination"
                class="minestar.pitlink.domain.machine.MachineReference"
                column="DESTINATION_OID"
                not-found="ignore"
                >
            <meta attribute="description">Unused</meta>
        </many-to-one>
        <property
                name="nodePublicationTime"
                type="TimestampType"
                column="NODE_PUBLICATION_TIME_UTC"
                >
            <meta attribute="utc-description">The node publication utc time for the event</meta>
            <meta attribute="description">The node publication time for the event</meta>
            <meta attribute="view-localtime">true</meta>
        </property>
        <property
                name="speed"
                column="SPEED"
                >
            <meta attribute="description">The speed value associated with the event.</meta>
            <meta attribute="unitType">speed</meta>
            <type name="quantity">
                <param name="unitType">speed</param>
            </type>
        </property>
        <property
                name="payload"
                column="PAYLOAD"
                >
            <meta attribute="description">The payload value associated with the event.</meta>
            <meta attribute="unitType">mass</meta>
            <type name="quantity">
                <param name="unitType">mass</param>
            </type>
        </property>
        <many-to-one
                name="operator"
                column="OPERATOR"
                class="minestar.machinetracking.domain.PersonReference"
                not-found="ignore"
                >
            <meta attribute="description">The equipment operator associated with the event.</meta>
        </many-to-one>

        <component name="location">
            <meta attribute="description">The equipment location information associated with the event.</meta>
            <property
                    name="timestamp"
                    type="TimestampType"
                    column ="LOCATION_TIMESTAMP_UTC"
                    >
                <meta attribute="view-localtime">true</meta>
                <meta attribute="utc-description">The location utc timestamp</meta>
                <meta attribute="description">The location timestamp</meta>
            </property>
            <property
                    name="accuracy" column="LOCATION_ACCURACY"
                    >
            </property>
            <property
                    name="heading" column="LOCATION_HEADING"
                    >
                <meta attribute="unitType">plane angle</meta>
                <type name="quantity">
                    <param name="unitType">plane angle</param>
                </type>
            </property>
            <component
                    name="LLE"
                    >
                <property name="latitude" column="LOCATION_LATITUDE" access="field">
                    <meta attribute="unitType">plane angle</meta>
                    <type name="quantity">
                        <param name="unitType">plane angle</param>
                    </type>
                </property>
                <property name="longitude" column="LOCATION_LONGITUDE" access="field">
                    <meta attribute="unitType">plane angle</meta>
                    <type name="quantity">
                        <param name="unitType">plane angle</param>
                    </type>
                </property>
                <property name="elevation" column="LOCATION_ELEVATION" access="field">
                    <meta attribute="unitType">length</meta>
                    <type name="quantity">
                        <param name="unitType">length</param>
                    </type>
                </property>
            </component>

            <property
                    name="XYZ"
                    type="XYZCoordinate"
                    >
                <meta attribute="export-nested" inherit="false">true</meta>
                <column name="LOCATION_X"/>
                <column name="LOCATION_Y"/>
                <column name="LOCATION_Z"/>
            </property>

        </component>

        <component name="state" class="minestar.domain.model.MachineState" access="field">
            <meta attribute="description">The equipment state information associated with the event.</meta>
            <property name="manualOverride" type="boolean" column="STATE_MANUAL_OVERRIDE" access="field">
                <meta attribute="description">Is a manual override in effect</meta>
            </property>
            <property name="loadStatus" type="minestar.domain.model.persistence.MachineLoadStatusUserType" column="STATE_LOADSTATUS" access="field">
                <meta attribute="description">The current load status.</meta>
                <meta attribute="choices" inherit="false">choice:truckCombinedStatus</meta>
            </property>
            <property name="oldLoadStatus" type="minestar.domain.model.persistence.MachineLoadStatusUserType" column="STATE_OLD_LOADSTATUS" access="field">
                <meta attribute="description">The previous load status.</meta>
                <meta attribute="choices" inherit="false">choice:truckCombinedStatus</meta>
            </property>
            <property name="oldStatus" type="minestar.domain.model.persistence.MachineStatusUserType" column="OLD_MACHINE_STATE" access="field">
                <meta attribute="alias">oldState</meta>
                <meta attribute="description">The previous machine status.</meta>
                <meta attribute="choices" inherit="false">choice:truckStatus</meta>
            </property>
            <property name="status" type="minestar.domain.model.persistence.MachineStatusUserType" column="MACHINE_STATE" access="field">
                <meta attribute="alias">state</meta>
                <meta attribute="description">The current machine status.</meta>
                <meta attribute="choices" inherit="false">choice:truckStatus</meta>
            </property>
        </component>
        <!-- End BaseEventProperties.xml -->

        <property
                name="level"
                type="java.lang.Byte"
                column="HELEVEL"
                access="field"
                >
            <meta attribute="alias" inherit="false">eventLevel</meta>
            <meta attribute="choices" inherit="false">choice:healthSeverityLevel</meta>
            <meta attribute="description">The health event level value associated with the event.</meta>
        </property>
        <property
                name="eventNumber"
                type="java.lang.Long"
                column="EVENT_NUMBER"
                >
            <meta attribute="description">The health event number value associated with the event.</meta>
        </property>
        <many-to-one
                name="eventDef"
                column="EVENT_DEF"
                class="minestar.health.domain.metadata.EventDef"
                not-found="ignore"
                >
            <meta attribute="alias" inherit="false">eventDefinition</meta>
            <meta attribute="description">The health event definition associated with the event.</meta>
        </many-to-one>
        <property
            name="alarmDescription"
            type="java.lang.String"
            column="ALARM_DESCRIPTION"
            length="254"
        >
            <meta attribute="description">The alarm description value associated with the event.</meta>
        </property>
        <property
                name="cid"
                type="java.lang.Long"
                column="CID"
                >
            <meta attribute="description">The component id associated with the event.</meta>
        </property>
        <property
                name="mid"
                type="java.lang.Long"
                column="MID"
                >
            <meta attribute="description">The module id associated with the event.</meta>
        </property>
        <property
                name="fmi"
                type="java.lang.Long"
                column="FMI"
                >
            <meta attribute="description">The failure mode indicator associated with the event.</meta>
        </property>

        <property
            name="additionalInfo"
            type="java.lang.String"
            column="STATE_ADDITIONAL_INFO"
            length="254"
            >
            <meta attribute="description">Additional info associated with the event.</meta>
        </property>

        <subclass name="minestar.health.domain.event.ActivateEvent"
                  dynamic-update="true"
                  discriminator-value="Activate">
            <meta attribute="description">Health Activate Event.</meta>
        </subclass>

        <subclass name="minestar.health.domain.event.DeactivateEvent"
                  dynamic-update="true"
                  discriminator-value="Deactivate">
            <meta attribute="description">Health Deactivate Event.</meta>
            <property
                    name="ackCount"
                    type="java.lang.Short"
                    column="ACKCOUNT"
                    >
                <meta attribute="universe-type-measure">true</meta>
                <meta attribute="description">The acknowledgement count value associated with the event.</meta>
            </property>
            <property
                    name="ackDuration"
                    column="ACKTIME"
                    >
                <meta attribute="unitType" inherit="false">duration</meta>
                <meta attribute="description">The acknowledgement time value associated with the event.</meta>
                <type name="quantity">
                    <param name="unitType">duration</param>
                </type>
            </property>
            <many-to-one name="measure" class="minestar.health.api.definition.Measure" column="MEASURE_OID" not-null="false" not-found="ignore" lazy="false">
            </many-to-one>
            <property
                    name="channelNumber"
                    type="java.lang.Integer"
                    column="CHANNEL_NUMBER"
                    >
                <meta attribute="description">The channel number value associated with the event.</meta>
            </property>
            <many-to-one
                    name="channelDef"
                    column="CHANNEL_DEF"
                    class="minestar.health.domain.metadata.ChannelDef"
                    cascade="all">
                <meta attribute="view-include">false</meta>
                <meta attribute="view-ignore">true</meta>
                <meta attribute="description">The channel definition value associated with the event.</meta>
            </many-to-one>
            <property
                    name="worstValue"
                    type="java.lang.Float"
                    column="WORST"
                    >
                <meta attribute="description">The worst value associated with the event.</meta>
            </property>
            <property
                    name="worstUnitType"
                    type="java.lang.String"
                    column="WORSTUNITS"
                    length="254"
                    >
                <meta attribute="description">The units associated with the worst value recorded for the event.</meta>
            </property>
            <property
                name="firstValue"
                type="java.lang.Float"
                column="FIRST"
            >
                <meta attribute="description">The first value associated with the event.</meta>
            </property>
            <property
                name="firstUnitType"
                type="java.lang.String"
                column="FIRSTUNITS"
                length="254"
            >
                <meta attribute="description">The units associated with the first value recorded for the event.</meta>
            </property>
            <property
                name="duration"
                column="DURATION"
            >
                <meta attribute="unitType" inherit="false">duration</meta>
                <meta attribute="description">The duration value associated with the event.</meta>
                <type name="quantity">
                    <param name="unitType">duration</param>
                </type>
            </property>
        </subclass>

        <subclass name="minestar.health.domain.event.TpiSampleDataEvent"
                  dynamic-update="true"
                  discriminator-value="TpiSampleData">
            <meta attribute="description">TPI Sample Data Event.</meta>
            <property
                    name="tpiInterfaceType"
                    type="java.lang.Integer"
                    column="TPI_INTERFACE_TYPE"
                    >
                <meta attribute="choices" inherit="false">choice:tpiInterfaceType</meta>
                <meta attribute="description">The interface associated with the event.</meta>
            </property>
            <map name="analogChannels"
                 lazy = "true"
                 table="TPI_ANALOG_DATA"
                 cascade="all-delete-orphan"
                    >
                <meta attribute="collection-table">
                    tablespace=MW_OBJ
                </meta>
                <meta attribute="collection-primary-key">
                    tablespace=MW_IDXOBJ
                </meta>
                <meta attribute="index-alias">spn</meta>
                <meta attribute="unitType" inherit="false">element-unitless</meta>
                <meta attribute="description">The analog channels associated with the event.</meta>
                <key column="EVENT_OID"/>
                <index type="java.lang.String" column="CHANNEL"/>
                <element type="java.lang.Double" column="SAMPLE"/>
            </map>
            <map name="digitalChannels"
                 lazy = "true"
                 table="TPI_DIGITAL_DATA"
                 cascade="all-delete-orphan"
                    >
                <meta attribute="collection-table">
                    tablespace=MW_OBJ
                </meta>
                <meta attribute="collection-primary-key">
                    tablespace=MW_IDXOBJ
                </meta>
                <meta attribute="index-alias">spn</meta>
                <meta attribute="description">The digital channels associated with the event.</meta>
                <key column="EVENT_OID"/>
                <index type="java.lang.String" column="CHANNEL"/>
                <element type="java.lang.Integer" column="SAMPLE"/>
            </map>
        </subclass>
        <subclass name="minestar.health.domain.event.VimsBroadcastEvent"
                  dynamic-update="true"
                  discriminator-value="VimsBroadcastEvent">
            <meta attribute="description">VIMS 3G Broadcast Data Event.</meta>
        </subclass>
    </class>

</hibernate-mapping>
