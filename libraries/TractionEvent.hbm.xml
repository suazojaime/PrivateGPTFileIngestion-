<?xml version="1.0"?>
<!--
  ~ Copyright (c) 2019 Caterpillar
  -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping default-access="field" default-lazy="false" schema="historical">

    <class name="minestar.mine.domain.minemodel.traction.TractionEventEntity"
           table="TRACTION_EVENT"
           schema="historical"
           dynamic-update="true">

        <meta attribute="view-master">true</meta>

        <meta attribute="table">
            tablespace=MW_ENT
            storage.initial=64K
            storage.next=64K
            storage.pctincrease=0
        </meta>

        <meta attribute="primary-key">
            tablespace=MW_IDXENT
            storage.initial=64k
            storage.next=64k
            storage.pctincrease=0
        </meta>

        <meta attribute="description">An instance of a loss of traction experience by a truck</meta>

        <cache usage="read-write" region="model-versioned"/>

        <id name="OID" type="long" column="TRACTION_EVENT_OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <many-to-one
                name="machineReference"
                class="minestar.pitlink.domain.machine.MachineReference"
                column="MACHINE_OID"
                not-null="true">
            <meta attribute="alias">machine</meta>
            <meta attribute="description">The machine that experienced the traction event.</meta>
        </many-to-one>

        <property name="tractionEventType"
                  type="minestar.mine.domain.minemodel.traction.TractionEventEnumUserType"
                  column="TRACTION_EVENT_TYPE"
                  not-null="true">
            <meta attribute="defaultValue">'LOSS_OF_TRACTION'</meta>
            <meta attribute="description">
                The type of the traction event, either LOSS_OF_TRACTION or EXCESSIVE_LOSS_OF_TRACTION.
            </meta>
        </property>

        <property name="startTime"
                  type="TimestampType"
                  column="START_TIME_UTC"
                  not-null="true">
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The time the traction event started - utc timestamp.</meta>
            <meta attribute="description">The time the traction event started</meta>
        </property>

        <property name="endTime"
                  type="TimestampType"
                  column="END_TIME_UTC"
                  not-null="true">
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The time the traction event ended - utc timestamp.</meta>
            <meta attribute="description">The time the traction event ended</meta>
        </property>

        <property name="startLocation" type="XYZCoordinate">
            <meta attribute="description">The xyz coordinate the traction event started.</meta>
            <column name="START_LOCATION_X" not-null="true"/>
            <column name="START_LOCATION_Y" not-null="true"/>
            <column name="START_LOCATION_Z"/>
        </property>

        <property name="endLocation" type="XYZCoordinate">
            <meta attribute="description">The xyz coordinate the traction event ended.</meta>
            <column name="END_LOCATION_X" not-null="true"/>
            <column name="END_LOCATION_Y" not-null="true"/>
            <column name="END_LOCATION_Z"/>
        </property>

        <property name="absoluteSpeedLimit"
                  column="ABSOLUTE">
            <meta attribute="description">Absolute speed limit</meta>
            <meta attribute="unitType">speed</meta>
            <type name="quantity">
                <param name="unitType">speed</param>
            </type>
        </property>

        <property name="proportionalDerate"
                  column="PROPORTIONAL">
            <meta attribute="description">Proportional derate</meta>
            <meta attribute="unitType">ratio</meta>
            <type name="quantity">
                <param name="unitType">ratio</param>
            </type>
        </property>

        <property name="proportionalDerateReason"
                  type="minestar.mine.persistence.minemodel.ReasonForDerateEnumUserType"
                  column="PROPORTIONAL_REASON">
            <meta attribute="description">Reason of proportional derate</meta>
        </property>

        <property name="tractionLevel"
                  column="TRACTION_LEVEL">
            <meta attribute="description">Traction level</meta>
            <meta attribute="unitType">ratio</meta>
            <type name="quantity">
                <param name="unitType">ratio</param>
            </type>
        </property>

        <set name="tractionEventLanes" table="TRACTION_EVENT_LANES" cascade="save-update" >
            <meta attribute="collection-table">tablespace=MW_ENT</meta>
            <meta attribute="collection-primary-key">tablespace=MW_IDXENT</meta>
            <meta attribute="index">
                name=TRACTION_EVENT_LANES_UIDX1
                unique=true
                columns=TRACTION_EVENT_OID,LANE_NAME
                tablespace=MW_IDXENT
            </meta>
            <meta attribute="description">The processors assigned to this destination blend</meta>
            <key column="TRACTION_EVENT_OID" />
            <composite-element class="minestar.mine.domain.minemodel.traction.TractionEventLane">
                <property name="laneName" type="string" column="LANE_NAME" length="254" not-null="true">
                    <meta attribute="description">lane name</meta>
                </property>

                <property name="speedLimit"
                          column="LANE_SPEED_LIMIT">
                    <meta attribute="description">Lane speed limit</meta>
                    <meta attribute="unitType">speed</meta>
                    <type name="quantity">
                        <param name="unitType">speed</param>
                    </type>
                </property>
            </composite-element>
        </set>

        <property name="tractionEventState"
                  type="string"
                  column="TRACTION_EVENT_STATE">
            <meta attribute="description">Traction state</meta>
        </property>
        <property name="action"
                  type="string"
                  column="ACTION">
            <meta attribute="description">Action took on traction event</meta>
        </property>
        <property name="externalInfluence"
                  type="string"
                  column="EXTERNAL_INFLUENCE">
            <meta attribute="description">external Influence on traction event</meta>
        </property>
        <property name="weatherCondition"
                  type="string"
                  column="WEATHER_CONDITION">
            <meta attribute="description">Weather condition on traction event</meta>
        </property>
        <property name="roadCondition"
                  type="string"
                  column="ROAD_CONDITION">
            <meta attribute="description">Road condition on traction event</meta>
        </property>

        <property name="userName"
                  type="string"
                  column="USER_NAME">
            <meta attribute="description">
                The name of the last user which edited the Traction event
            </meta>
        </property>

        <property name="notes" type="string" column="NOTES" length="2000">
            <meta attribute="description">A free form notes field for the traction event.</meta>
        </property>

        <set name="tractionEventZones" table="TRACTION_EVENT_ZONES"  cascade="save-update" >
            <meta attribute="collection-table">tablespace=MW_ENT</meta>
            <meta attribute="collection-primary-key">tablespace=MW_IDXENT</meta>
            <meta attribute="index">
                name=TRACTION_EVENT_ZONES_UIDX1
                unique=true
                columns=TRACTION_EVENT_OID,ZONE_NAME
                tablespace=MW_IDXENT
            </meta>
            <meta attribute="description">The traction on zones</meta>
            <key column="TRACTION_EVENT_OID"   />
            <composite-element class="minestar.mine.domain.minemodel.traction.TractionEventZone">
                <property name="zoneName" type="string" column="ZONE_NAME" length="254" not-null="true">
                    <meta attribute="description">zone name</meta>
                </property>

                <property name="tractionLevel"
                          column="TRACTION_LEVEL">
                    <meta attribute="description">Traction level</meta>
                    <meta attribute="unitType">ratio</meta>
                    <type name="quantity">
                        <param name="unitType">ratio</param>
                    </type>
                </property>

                <property name="speedLimit"
                          column="ZONE_SPEED_LIMIT">
                    <meta attribute="description">Zone speed limit</meta>
                    <meta attribute="unitType">speed</meta>
                    <type name="quantity">
                        <param name="unitType">speed</param>
                    </type>
                </property>
            </composite-element>
        </set>

        <property name="globalSpeedLimit"
                  column="GLOBAL_SPEED_LIMIT">
            <meta attribute="description">Absolute speed limit</meta>
            <meta attribute="unitType">speed</meta>
            <type name="quantity">
                <param name="unitType">speed</param>
            </type>
        </property>

        <property name="globalProportionalDerate"
                  column="GLOBAL_PROP_DERATE">
            <meta attribute="description">Proportional derate</meta>
            <meta attribute="unitType">ratio</meta>
            <type name="quantity">
                <param name="unitType">ratio</param>
            </type>
        </property>

        <property name="globalDerateReason"
                  type="minestar.mine.persistence.minemodel.ReasonForDerateEnumUserType"
                  column="GLOBAL_DERATE_REASON">
            <meta attribute="description">Reason of proportional derate</meta>
        </property>

        <property name="machineSpeedLimit"
                  column="MACH_SPEED_LIMIT">
            <meta attribute="description">Absolute speed limit</meta>
            <meta attribute="unitType">speed</meta>
            <type name="quantity">
                <param name="unitType">speed</param>
            </type>
        </property>

        <property name="machineProportionalDerate"
                  column="MACH_PROP_DERATE">
            <meta attribute="description">Proportional derate</meta>
            <meta attribute="unitType">ratio</meta>
            <type name="quantity">
                <param name="unitType">ratio</param>
            </type>
        </property>

        <property name="machineDerateReason"
                  type="minestar.mine.persistence.minemodel.ReasonForDerateEnumUserType"
                  column="MACH_DERATE_REASON">
            <meta attribute="description">Reason of proportional derate</meta>
        </property>

        <property name="machineClassSpeedLimit"
                  column="MACH_CL_SPEED_LIMIT">
            <meta attribute="description">Absolute speed limit</meta>
            <meta attribute="unitType">speed</meta>
            <type name="quantity">
                <param name="unitType">speed</param>
            </type>
        </property>

        <property name="machineClassProportionalDerate"
                  column="MACH_CL_PROP_DERATE">
            <meta attribute="description">Proportional derate</meta>
            <meta attribute="unitType">ratio</meta>
            <type name="quantity">
                <param name="unitType">ratio</param>
            </type>
        </property>

        <property name="machineClassDerateReason"
                  type="minestar.mine.persistence.minemodel.ReasonForDerateEnumUserType"
                  column="MACH_CL_DERATE_REASON">
            <meta attribute="description">Reason of proportional derate</meta>
        </property>

        <property name="payload"
                  column="PAYLOAD">
            <meta attribute="description">The  payload in the machine</meta>
            <type name="quantity">
                <param name="unitType">mass</param>
            </type>
        </property>


    </class>

</hibernate-mapping>
