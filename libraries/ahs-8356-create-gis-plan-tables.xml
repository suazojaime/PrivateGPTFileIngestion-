<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet author="MineStar" id="8d181f7c-b687-43f2-8f97-30fdd1804e45"
               context="Machine_Tracking/Machine_Tracking_Management"
               objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <preConditions onFailMessage="Ignored DropTable for gis_plans as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="gis_plans"/>
        </preConditions>
        <comment>AHS-8356: DropTable gis_plans</comment>
        <dropTable tableName="gis_plans" cascadeConstraints="true"/>
        <rollback>
            <comment>@EmptyRollback</comment>
        </rollback>
    </changeSet>

    <changeSet author="MineStar" id="e8a0b584-1ef8-4703-821b-4460ff1f1702"
               context="Machine_Tracking/Machine_Tracking_Management">
        <preConditions onFailMessage="Ignored CreateTable for GIS_PLANS as table already exists." onFail="MARK_RAN">
            <not>
                <tableExists tableName="GIS_PLANS"/>
            </not>
        </preConditions>
        <comment>AHS-8356: CreateTable GIS_PLANS</comment>
        <createTable tableName="GIS_PLANS">
            <column name="PLAN_OID" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="GIS_PLANS_PK"/>
            </column>
            <column name="PLANNAME" type="VARCHAR(64)" >
                <constraints nullable="false"/>
            </column>
            <column name="PLANTYPE" type="VARCHAR(32)">
                <constraints nullable="false"/>
            </column>
            <column name="GEOM" type="GEOMETRY(PolygonZ, 0)">
                <constraints nullable="false"/>
            </column>
            <column name="IS_ACTIVE" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="LAYER_UPDATE_VERSION" type="BIGINT" remarks="The layer update version of the plan">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <!-- Index on GIS_PLANS.IS_ACTIVE used to support ACTIVE and INACTIVE views -->
        <createIndex tableName="GIS_PLANS" indexName="GIS_PLANS_ACTIVE">
            <column name="IS_ACTIVE"/>
        </createIndex>
        <!-- Index on GIS_PLANS.LAYER_UPDATE_VERSION used to support queries for version changes -->
        <createIndex tableName="GIS_PLANS" indexName="GIS_PLANS_VERSION">
            <column name="LAYER_UPDATE_VERSION"/>
        </createIndex>
        <!-- Spatial index on GIS_PLANS.GEOM -->
        <sql>CREATE INDEX GIS_PLANS_GEOM ON GIS_PLANS USING gist (GEOM)</sql>
        <rollback>
            <dropTable tableName="GIS_PLANS"/>
        </rollback>
    </changeSet>

</databaseChangeLog>
