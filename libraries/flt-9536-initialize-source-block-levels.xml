<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="83753d8c-d15a-44a4-a7c0-9ac7840e224e" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored initialization of historical source block levels as table or view does not exist." onFail="MARK_RAN">
            <tableExists tableName="CYCLE"/>
            <columnExists tableName="CYCLE" columnName="SOURCEBLOCK"/>
            <columnExists tableName="CYCLE" columnName="SOURCEBLOCKLEVEL"/>
            <viewExists viewName="V_MININGBLOCK"/>
        </preConditions>
        <comment>FLT-9536: Initialize SOURCEBLOCKLEVEL in CYCLE</comment>
        <customChange class="minestar.db.customchange.InitializeHistoricalSourceBlockLevels" />
        <rollback>
            <sql>UPDATE CYCLE SET SOURCEBLOCKLEVEL = null WHERE SOURCEBLOCK is null</sql>
        </rollback>
    </changeSet>
</databaseChangeLog>
