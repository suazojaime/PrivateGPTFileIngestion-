<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="b17f7e5a-7b90-45ee-96e0-ba0d13935859" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for ALARM_GROUP_ELEMENT as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="ALARM_GROUP_ELEMENT"/>
        </preConditions>
        <comment>AHS-7096: DropTable ALARM_GROUP_ELEMENT</comment>
        <dropTable tableName="ALARM_GROUP_ELEMENT"/>
        <rollback>
            <createTable tablespace="MW_ENT" remarks="The elements of the Alarm Group" tableName="ALARM_GROUP_ELEMENT">
                <column name="OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="ALARM_TYPE_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
            </createTable>
            <addPrimaryKey columnNames="OID,ALARM_TYPE_OID" constraintName="ALARM_GROUP_ELEMENT_PK" tablespace="MW_IDXENT" tableName="ALARM_GROUP_ELEMENT"/>
            <addForeignKeyConstraint baseTableName="ALARM_GROUP_ELEMENT" baseColumnNames="OID" constraintName="ALARM_GROUP_ELEMENT_OID_FK" referencedTableName="ALARM_GROUP" referencedColumnNames="ALARM_GROUP_OID" onDelete="NO ACTION"/>
            <addForeignKeyConstraint baseTableName="ALARM_GROUP_ELEMENT" baseColumnNames="ALARM_TYPE_OID" constraintName="ALARM_GROUP_ELEMENT_ALARM_T_FK" referencedTableName="ALARMTYPE" referencedColumnNames="ALARMTYPE_OID" onDelete="NO ACTION"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

    <changeSet id="e417784f-4276-4734-bd21-069101f71108" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for ALARM_GROUP_SUBDIR as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="ALARM_GROUP_SUBDIR"/>
        </preConditions>
        <comment>AHS-7096: DropTable ALARM_GROUP_SUBDIR</comment>
        <dropTable tableName="ALARM_GROUP_SUBDIR"/>
        <rollback>
            <createTable tablespace="MW_ENT" remarks="The subdirectories of the Alarm Group" tableName="ALARM_GROUP_SUBDIR">
                <column name="OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="ALARM_GROUP_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
            </createTable>
            <addPrimaryKey columnNames="OID,ALARM_GROUP_OID" constraintName="ALARM_GROUP_SUBDIR_PK" tablespace="MW_IDXENT" tableName="ALARM_GROUP_SUBDIR"/>
            <addForeignKeyConstraint baseTableName="ALARM_GROUP_SUBDIR" baseColumnNames="ALARM_GROUP_OID" constraintName="ALARM_GROUP_SUBDIR_ALARM_GR_FK" referencedTableName="ALARM_GROUP" referencedColumnNames="ALARM_GROUP_OID" onDelete="NO ACTION"/>
            <addForeignKeyConstraint baseTableName="ALARM_GROUP_SUBDIR" baseColumnNames="OID" constraintName="ALARM_GROUP_SUBDIR_OID_FK" referencedTableName="ALARM_GROUP" referencedColumnNames="ALARM_GROUP_OID" onDelete="NO ACTION"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

    <changeSet id="6d787aef-cbe6-42cf-9ba3-3a8f828e64c9" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for ALARM_GROUP as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="ALARM_GROUP"/>
        </preConditions>
        <comment>AHS-7096: DropTable ALARM_GROUP</comment>
        <dropTable tableName="ALARM_GROUP"/>
        <rollback>
            <createTable tablespace="MW_ENT" remarks="Groups alarms." tableName="ALARM_GROUP">
                <column name="ALARM_GROUP_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="NAME" type="VARCHAR(254)" remarks="The name of the Alarm Group">
                    <constraints nullable="false"/>
                </column>
            </createTable>
            <addPrimaryKey columnNames="ALARM_GROUP_OID" constraintName="ALARM_GROUP_PK" tablespace="MW_IDXENT" tableName="ALARM_GROUP"/>
            <createIndex unique="true" tablespace="MW_IDXENT" tableName="ALARM_GROUP" indexName="ALARM_GROUP_NAME">
                <column name="NAME"/>
            </createIndex>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

</databaseChangeLog>
