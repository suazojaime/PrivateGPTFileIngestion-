<?xml version="1.0"?>
<!-- Copyright (c) 2023 Caterpillar -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping schema="model" default-access="field" default-lazy="false">

    <class
        name="minestar.assignment.domain.planning.ProductionRequestTemplateImpl"
        proxy="minestar.assignment.domain.planning.ProductionRequestTemplate"
        table="PROD_REQUEST_TMPL"
        >
        <meta attribute="alias" inherit="false">ProdRqstTmpl</meta>

        <meta attribute="table">
    		tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
    		tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=PROD_REQUEST_TMPL_NAME
            unique=true
            columns=NAME
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=PROD_REQUEST_TMPL_1R
            columns=NAME ASC, PROD_REQUEST_TMPL_OID ASC
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="description">A production request template</meta>
        
        <id
            name="OID"
            type="java.lang.Long"
            column="PROD_REQUEST_TMPL_OID"
            >
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <property
            name="name"
            type="java.lang.String"
            column="NAME"
            length="254"
            not-null="true"
            >
            <meta attribute="description">The name value of the production request template.</meta>
        </property>
        <property
            name="description"
            type="java.lang.String"
            column="DESCRIPTION"
            length="254"
            >
            <meta attribute="description">The description value of the production request template.</meta>
        </property>

        <!-- associations -->
        <list name="goals" table="PROD_REQUEST_TMPL_GOAL" cascade="all-delete-orphan">
            <meta attribute="description">The goals details associated with the production request template.</meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <key column="PROD_REQUEST_TMPL_OID"/>
            <list-index column="LIST_INDEX"/>
            <composite-element class="minestar.assignment.domain.planning.ProductionRequestGoal">
                <property
                    name="minRate"
                    column="MIN_RATE"
                    >
                    <meta attribute="description">What is the minimum rate for this goal.</meta>
                    <meta attribute="unitType">rate</meta>
                    <type name="quantity">
                        <param name="unitType">rate</param>
                    </type>
                </property>

                <property
                    name="maxRate"
                    column="MAX_RATE"
                    >
                    <meta attribute="description">What is the maximum rate for this goal.</meta>
                    <meta attribute="unitType">rate</meta>
                    <type name="quantity">
                        <param name="unitType">rate</param>
                    </type>
                </property>

                <many-to-one
                    name="fromServer"
                    class="minestar.pitlink.domain.machine.MachineReference"
                    column="FROM_SERVER"
                >
                    <meta attribute="description">The Loading Tool to obtain material from for the production request goal.</meta>
                </many-to-one>

                <many-to-one
                    name="toServer"
                    class="minestar.pitlink.domain.machine.MachineReference"
                    column="TO_SERVER"
                    access="field"
                >
                    <meta attribute="description">The Processor to dump material at for the production request goal.</meta>
                </many-to-one>

                <many-to-one
                    name="material"
                    class="minestar.machinetracking.domain.MaterialReference"
                    column="MATERIAL"
                >
                    <meta attribute="description">The material for the production request goal.</meta>
                </many-to-one>

                <many-to-one
                    name="blend"
                    class="minestar.mine.domain.material.BlendReference"
                    column="BLEND_OID"
                >
                    <meta attribute="description">The blend for the production request goal.</meta>
                </many-to-one>
            </composite-element>
        </list>

        <set name="priorityMaterials"  table="PROD_RQST_TMPL_PTY_MATERIAL">
            <meta attribute="description">The materials to be considered a priority for this production request template.</meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <key column="OID"/>
            <many-to-many class="minestar.machinetracking.domain.MaterialReference" column="MATERIAL_OID"/>
        </set>

        <map name="serverPriorities"
            table="PROD_RTMPL_SVR_PRIORITY">
            <meta attribute="description">The priority associated with each server in this production request template.</meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <meta attribute="index" inherit="false">
                name=PROD_RTMPL_SVR_PRIORITY_12U
                columns=OID
                tablespace=MW_IDXENT
            </meta>

            <key column="OID"/>
            <map-key-many-to-many class="minestar.pitlink.domain.machine.MachineReference" column="MACHINE_OID"/>
            <element type="minestar.domain.model.persistence.ServerPriorityUserType" column="PRIORITY"/>
        </map>

    </class>
</hibernate-mapping>
