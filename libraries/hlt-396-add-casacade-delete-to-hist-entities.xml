<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <changeSet id="8b920e3d-0a4a-46f8-85f5-4b48139a7e4f" author="MineStar" failOnError="true">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for HIST_CELL_DEF_HIST_ID_FK of table HIST_CELL_DEF as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="HIST_CELL_DEF" foreignKeyName="HIST_CELL_DEF_HIST_ID_FK"/>
        </preConditions>
        <comment>{JIRA}: DropForeignKeyConstraint HIST_CELL_DEF_HIST_ID_FK from HIST_CELL_DEF (HIST_ID)</comment>
        <dropForeignKeyConstraint baseTableName="HIST_CELL_DEF" constraintName="HIST_CELL_DEF_HIST_ID_FK"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="HIST_CELL_DEF" baseColumnNames="HIST_ID" constraintName="HIST_CELL_DEF_HIST_ID_FK" referencedTableName="HIST_DEF" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="07c7a782-b9b8-4047-a63c-4f2aa8c43bdb" author="MineStar" failOnError="true">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for HIST_TARGETS_HISTOGRAM_FK of table HIST_TARGETS as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="HIST_TARGETS" foreignKeyName="HIST_TARGETS_HISTOGRAM_FK"/>
        </preConditions>
        <comment>{JIRA}: DropForeignKeyConstraint HIST_TARGETS_HISTOGRAM_FK from HIST_TARGETS (HISTOGRAM)</comment>
        <dropForeignKeyConstraint baseTableName="HIST_TARGETS" constraintName="HIST_TARGETS_HISTOGRAM_FK"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="HIST_TARGETS" baseColumnNames="HISTOGRAM" constraintName="HIST_TARGETS_HISTOGRAM_FK" referencedTableName="HIST_DEF" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="a6f08f72-d4a8-4e3f-8737-e29a2619b5f6" author="MineStar" context="Health/Health_Management" failOnError="true">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for HIST_CELL_DEF_HIST_ID_FK to table HIST_CELL_DEF as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="HIST_CELL_DEF"/>
            <tableExists tableName="HIST_DEF"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="HIST_CELL_DEF" foreignKeyName="HIST_CELL_DEF_HIST_ID_FK"/>
            </not>
        </preConditions>
        <comment>{JIRA}: AddForeignKeyConstraint HIST_CELL_DEF_HIST_ID_FK to HIST_CELL_DEF (HIST_ID)</comment>
        <sql>DELETE FROM HIST_CELL_DEF WHERE HIST_ID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM HIST_DEF WHERE HIST_DEF.OID = HIST_CELL_DEF.HIST_ID)</sql>
        <addForeignKeyConstraint baseTableName="HIST_CELL_DEF" baseColumnNames="HIST_ID" constraintName="HIST_CELL_DEF_HIST_ID_FK" referencedTableName="HIST_DEF" referencedColumnNames="OID" onDelete="CASCADE"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="HIST_CELL_DEF" constraintName="HIST_CELL_DEF_HIST_ID_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="ff510628-b7af-4e38-8bb3-0e85a973a2cb" author="MineStar" context="Health/Health_Management" failOnError="true">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for HIST_TARGETS_HISTOGRAM_FK to table HIST_TARGETS as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="HIST_TARGETS"/>
            <tableExists tableName="HIST_DEF"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="HIST_TARGETS" foreignKeyName="HIST_TARGETS_HISTOGRAM_FK"/>
            </not>
        </preConditions>
        <comment>{JIRA}: AddForeignKeyConstraint HIST_TARGETS_HISTOGRAM_FK to HIST_TARGETS (HISTOGRAM)</comment>
        <sql>DELETE FROM HIST_TARGETS WHERE HISTOGRAM IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM HIST_DEF WHERE HIST_DEF.OID = HIST_TARGETS.HISTOGRAM)</sql>
        <addForeignKeyConstraint baseTableName="HIST_TARGETS" baseColumnNames="HISTOGRAM" constraintName="HIST_TARGETS_HISTOGRAM_FK" referencedTableName="HIST_DEF" referencedColumnNames="OID" onDelete="CASCADE"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="HIST_TARGETS" constraintName="HIST_TARGETS_HISTOGRAM_FK"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
