<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (c) 2023 Caterpillar -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:condbean="http://www.minestar.au.cat.com/springbeans/condbean"
       xsi:schemaLocation="http://www.minestar.au.cat.com/springbeans/condbean http://www.minestar.au.cat.com/springbeans/condbean/condbeans.xsd
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <import resource="../gis/GisLayerContext.xml"/>

    <!-- Only synchronise with the GeoServer if _GEOSERVER_SYNC=true -->
    <condbean:cond option="_GEOSERVER_SYNC">
        <!-- This is eagerly initialized! -->
        <bean id="gisFullSync" class="minestar.mine.service.gis.sync.GISSynchronizer" lazy-init="false">
            <property name="WFSManager" ref="gisIntegration"/>
        </bean>
    </condbean:cond>

    <!-- JdbcTemplate for accessing the "postgis" database -->
    <bean id="postgisJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate" lazy-init="true">
        <constructor-arg ref="pooledGisDataSource"/>
    </bean>

    <!-- TransactionManager for accessing the "postgis" database -->
    <bean id="postgisTransactionManager"
          class="org.springframework.jdbc.datasource.DataSourceTransactionManager" lazy-init="true">
        <property name="dataSource" ref="pooledGisDataSource"/>
    </bean>

    <!-- Feature Builder -->

    <bean id="geometryUtil" class="minestar.geometry.util.CrsCodeAwareGeometryUtil">
        <constructor-arg name="crsCodeAware" ref="crsCodeResolver"/>
    </bean>

    <bean id="abstractMineStarFeatureBuilder" abstract="true"
          class="minestar.mine.service.gis.featurebuilder.AbstractMinestarFeatureBuilder">
        <property name="geometryUtil" ref="geometryUtil"/>
    </bean>


    <bean id="abstractMinestarFeatureBuilderNoGeometry" abstract="true"
          class="minestar.mine.service.gis.featurebuilder.AbstractMinestarFeatureBuilderNoGeometry">
    </bean>

    <bean id="gradeBlockFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.GradeBlockFeatureBuilder">
        <property name="layerDef" ref="gradeBlockGISLayer"/>
        <constructor-arg name="materialManagementService" ref="materialManagementServiceImpl"/>
    </bean>

    <bean id="hazardsFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.HazardsFeatureBuilder">
        <property name="layerDef" ref="hazardGISLayer"/>
    </bean>

    <bean id="laneFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.LaneFeatureBuilder">
        <property name="layerDef" ref="laneGISLayer"/>
    </bean>

    <bean id="archivedLaneFeatureBuilder" parent="abstractMinestarFeatureBuilderNoGeometry"
          class="minestar.mine.service.gis.featurebuilder.ArchivedLaneFeatureBuilder">
        <property name="layerDef" ref="archivedLaneGISLayer"/>
    </bean>

    <bean id="obstacleFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.ObstacleFeatureBuilder">
        <property name="layerDef" ref="obstaclesGISLayer"/>
    </bean>

    <bean id="regionFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.RegionFeatureBuilder">
        <property name="layerDef" ref="regionGISLayer"/>
    </bean>

    <bean id="roadFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.RoadFeatureBuilder">
        <property name="layerDef" ref="roadGISLayer"/>
    </bean>

    <bean id="waypointFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.WaypointFeatureBuilder">
        <property name="layerDef" ref="waypointGISLayer"/>
    </bean>

    <bean id="zonesFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.ZonesFeatureBuilder">
        <property name="layerDef" ref="zoneGISLayer"/>
        <property name="dimensionManagementService" ref="dimensionManagementServiceImpl"/>
    </bean>

    <bean id="plansFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.PlansFeatureBuilder">
        <property name="layerDef" ref="planGISLayer"/>
    </bean>

    <bean id="processorFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.ProcessorFeatureBuilder">
        <property name="layerDef" ref="processorGISLayer"/>
    </bean>

    <bean id="stockpileFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.StockpileFeatureBuilder">
        <constructor-arg name="materialManagementService" ref="materialManagementServiceImpl"/>
        <property name="layerDef" ref="stockpileGISLayer"/>
    </bean>

    <bean id="materialFeatureBuilder" parent="abstractMinestarFeatureBuilderNoGeometry"
          class="minestar.mine.service.gis.featurebuilder.MaterialFeatureBuilder">
        <property name="layerDef" ref="materialGISLayer"/>
    </bean>

    <bean id="dxfPointFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.DxfPointFeatureBuilder">
        <property name="crsCodeResolver" ref="crsCodeResolver"/>
        <property name="layerDef" ref="dxfPointsLayer"/>
    </bean>

    <bean id="dxfLineFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.DxfLineFeatureBuilder">
        <property name="crsCodeResolver" ref="crsCodeResolver"/>
        <property name="layerDef" ref="dxfLinesLayer"/>
    </bean>

    <bean id="dxfPolygonFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.DxfPolygonFeatureBuilder">
        <property name="crsCodeResolver" ref="crsCodeResolver"/>
        <property name="layerDef" ref="dxfPolygonsLayer"/>
    </bean>

    <bean id="locationFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.LocationFeatureBuilder">
        <property name="layerDef" ref="locationGISLayer" />
    </bean>

    <!-- JDBC Export Provider -->
    <bean id="gisJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <property name="dataSource">
            <bean parent="pooledGisDataSource">
                <property name="poolName" value="gis-autocommit"/>
                <property name="autoCommit" value="true"/>
            </bean>
        </property>
    </bean>

    <bean id="crsCodeResolver" class="com.mincom.util.geometry.jts.CrsCodeResolver">
        <property name="storageCrs" value="${minestar.pitlink.util.gps.Config@STORAGE_COORDINATE_SYSTEM}"/>
    </bean>

    <bean id="minestarJdbcExportProvider" class="minestar.mine.service.gis.export.MinestarJdbcExportProvider" abstract="true">
        <property name="jdbcTemplate" ref="gisJdbcTemplate"/>
        <property name="chunkSize" value="500"/>
        <property name="crsCodeResolver" ref="crsCodeResolver"/>
    </bean>

    <bean id="laneJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="laneGISLayer"/>
        <property name="featureBuilder" ref="laneFeatureBuilder"/>
    </bean>

    <bean id="archivedLaneJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="archivedLaneGISLayer"/>
        <property name="featureBuilder" ref="archivedLaneFeatureBuilder"/>
    </bean>

    <bean id="obstacleJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="obstaclesGISLayer"/>
        <property name="featureBuilder" ref="obstacleFeatureBuilder"/>
    </bean>

    <bean id="regionJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="regionGISLayer"/>
        <property name="featureBuilder" ref="regionFeatureBuilder"/>
    </bean>

    <bean id="roadJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="roadGISLayer"/>
        <property name="featureBuilder" ref="roadFeatureBuilder"/>
    </bean>

    <bean id="gradeBlockJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="gradeBlockGISLayer"/>
        <property name="featureBuilder" ref="gradeBlockFeatureBuilder"/>
    </bean>

    <bean id="waypointJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="waypointGISLayer"/>
        <property name="featureBuilder" ref="waypointFeatureBuilder"/>
    </bean>

    <bean id="zonesJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="zoneGISLayer"/>
        <property name="featureBuilder" ref="zonesFeatureBuilder"/>
    </bean>

    <bean id="plansJdbcExportProvider" parent="minestarJdbcExportProvider"
          class="minestar.mine.service.gis.export.PlansJdbcExportProvider">
        <property name="layer" ref="planGISLayer"/>
        <property name="featureBuilder" ref="plansFeatureBuilder"/>
        <property name="quoteIdentifiers" value="false"/>
    </bean>

    <bean id="hazardJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="hazardGISLayer"/>
        <property name="featureBuilder" ref="hazardsFeatureBuilder"/>
    </bean>

    <bean id="abstractDxfJdbcExportProvider" class="minestar.mine.service.gis.export.DxfJdbcExportProvider" abstract="true">
        <property name="jdbcTemplate" ref="gisJdbcTemplate"/>
        <property name="chunkSize" value="500"/>
        <property name="crsCodeResolver" ref="crsCodeResolver"/>
    </bean>

    <bean id="dxfPointJdbcExportProvider" parent="abstractDxfJdbcExportProvider">
        <property name="layer" ref="dxfPointsLayer"/>
        <property name="featureBuilder" ref="dxfPointFeatureBuilder"/>
    </bean>

    <bean id="dxfLineJdbcExportProvider" parent="abstractDxfJdbcExportProvider">
        <property name="layer" ref="dxfLinesLayer"/>
        <property name="featureBuilder" ref="dxfLineFeatureBuilder"/>
    </bean>

    <bean id="dxfPolygonJdbcExportProvider" parent="abstractDxfJdbcExportProvider">
        <property name="layer" ref="dxfPolygonsLayer"/>
        <property name="featureBuilder" ref="dxfPolygonFeatureBuilder"/>
    </bean>

    <bean id="locationJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="locationGISLayer"/>
        <property name="featureBuilder" ref="locationFeatureBuilder"/>
    </bean>

    <bean id="processorJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="processorGISLayer"/>
        <property name="featureBuilder" ref="processorFeatureBuilder"/>
    </bean>

    <bean id="stockpileJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="stockpileGISLayer"/>
        <property name="featureBuilder" ref="stockpileFeatureBuilder"/>
    </bean>

    <bean id="gradeBlockGroupExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="gradeBlockGISLayer"/>
        <property name="featureBuilder" ref="gradeBlockFeatureBuilder"/>
    </bean>

    <bean id="materialJdbcExportProvider" parent="minestarJdbcExportProvider">
        <property name="layer" ref="materialGISLayer"/>
        <property name="featureBuilder" ref="materialFeatureBuilder"/>
    </bean>

    <bean id="userLayerGroupExportProviderImpl" class="minestar.mine.service.gis.export.UserLayerGroupExportProvider">
        <property name="userLayerService" ref="userLayerServiceImpl"/>
        <property name="gisAdministraor" ref="gisAdministrator"/>
    </bean>

    <!-- JDBC Exporter -->

    <bean id="laneJdbcExporter" class="minestar.mine.service.gis.export.LaneJdbcExporter">
        <constructor-arg name="exportProvider" ref="laneJdbcExportProvider"/>
        <property name="laneLayoutService" ref="laneLayoutServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="archivedLaneJdbcExporter" class="minestar.mine.service.gis.export.ArchivedLaneJdbcExporter">
        <constructor-arg name="exportProvider" ref="archivedLaneJdbcExportProvider"/>
        <property name="laneLayoutService" ref="laneLayoutServiceImpl"/>
    </bean>

    <bean id="obstacleJdbcExporter" class="minestar.mine.service.gis.export.ObstacleJdbcExporter">
        <constructor-arg name="exportProvider" ref="obstacleJdbcExportProvider"/>
        <property name="obstacleService" ref="obstacleServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="regionJdbcExporter" class="minestar.mine.service.gis.export.RegionJdbcExporter">
        <constructor-arg name="exportProvider" ref="regionJdbcExportProvider"/>
        <property name="regionService" ref="regionServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="roadJdbcExporter" class="minestar.mine.service.gis.export.RoadJdbcExporter">
        <constructor-arg name="exportProvider" ref="roadJdbcExportProvider"/>
        <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="gradeBlockJdbcExporter" class="minestar.mine.service.gis.export.GradeBlockJdbcExporter">
        <constructor-arg name="exportProvider" ref="gradeBlockJdbcExportProvider"/>
        <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="gradeBlockGroupJdbcExporter" class="minestar.mine.service.gis.export.GradeBlockGroupJdbcExporter">
        <constructor-arg name="exportProvider" ref="gradeBlockGroupExportProvider"/>
        <property name="gradeBlockJdbcExporter" ref="gradeBlockJdbcExporter"/>
        <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="waypointJdbcExporter" class="minestar.mine.service.gis.export.WaypointJdbcExporter">
        <constructor-arg name="exportProvider" ref="waypointJdbcExportProvider"/>
        <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="zonesJdbcExporter" class="minestar.mine.service.gis.export.ZonesJdbcExporter">
        <constructor-arg name="exportProvider" ref="zonesJdbcExportProvider"/>
        <property name="zoneLayoutService" ref="zoneLayoutServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInAllZonesLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="plansJdbcExporter" class="minestar.mine.service.gis.export.PlansJdbcExporter">
        <constructor-arg name="exportProvider" ref="plansJdbcExportProvider"/>
        <property name="dumpPlanningService" ref="dumpPlanningServiceImpl"/>
        <property name="loadPlanningService" ref="loadPlanningServiceImpl"/>
    </bean>

    <bean id="processorJdbcExporter" class="minestar.mine.service.gis.export.ProcessorJdbcExporter">
        <constructor-arg name="exportProvider" ref="processorJdbcExportProvider"/>
        <property name="pitModelService" ref="pitModelServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="stockpileJdbcExporter" class="minestar.mine.service.gis.export.StockpileJdbcExporter">
        <constructor-arg name="exportProvider" ref="stockpileJdbcExportProvider"/>
        <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="materialJdbcExporter" class="minestar.mine.service.gis.export.MaterialJdbcExporter">
        <constructor-arg name="exportProvider" ref="materialJdbcExportProvider"/>
        <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="hazardJdbcExporter" class="minestar.mine.service.gis.export.HazardsJdbcExporter">
        <constructor-arg name="exportProvider" ref="hazardJdbcExportProvider"/>
        <property name="hazardLayoutService" ref="hazardLayoutServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInAllZonesLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="dxfPointExporter" class="minestar.mine.service.gis.export.DxfExporter">
        <constructor-arg name="exportProvider" ref="dxfPointJdbcExportProvider"/>
    </bean>

    <bean id="dxfLineExporter" class="minestar.mine.service.gis.export.DxfExporter">
        <constructor-arg name="exportProvider" ref="dxfLineJdbcExportProvider"/>
    </bean>


    <bean id="dxfPolygonExporter" class="minestar.mine.service.gis.export.DxfExporter">
        <constructor-arg name="exportProvider" ref="dxfPolygonJdbcExportProvider"/>
    </bean>

    <bean id="locationJdbcExporter" class="minestar.mine.service.gis.export.LocationJdbcExporter">
        <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
        <constructor-arg name="exportProvider" ref="locationJdbcExportProvider"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="userLayerGroupExporterImpl" class="minestar.mine.service.gis.export.UserLayerGroupExporter">
        <constructor-arg name="exportProvider" ref="userLayerGroupExportProviderImpl"/>
        <property name="userLayerService" ref="userLayerServiceImpl"/>
        <property name="listeners">
            <list>
                <ref bean="layerInModelLayerGroupEventListener"/>
            </list>
        </property>
    </bean>

    <bean id="gisHelper" class="minestar.mine.service.gis.sync.SystemSettingsGisHelper"/>

    <condbean:cond option="_GEOSERVER_SYNC">
        <bean id="gisIntegration" class="minestar.mine.service.gis.sync.GISIntegrationManager" lazy-init="true"
              init-method="init">
            <property name="publisher" ref="updatePublisher"/>
            <property name="zonesExporter" ref="zonesJdbcExporter"/>
            <property name="plansExporter" ref="plansJdbcExporter"/>
            <property name="laneExporter" ref="laneJdbcExporter"/>
            <property name="archivedLaneExporter" ref="archivedLaneJdbcExporter"/>
            <property name="hazardExporter" ref="hazardJdbcExporter"/>
            <property name="waypointExporter" ref="waypointJdbcExporter"/>
            <property name="gradeBlockExporter" ref="gradeBlockJdbcExporter"/>
            <property name="gradeBlockGroupExporter" ref="gradeBlockGroupJdbcExporter"/>
            <property name="obstacleExporter" ref="obstacleJdbcExporter"/>
            <property name="regionExporter" ref="regionJdbcExporter"/>
            <property name="roadExporter" ref="roadJdbcExporter"/>
            <property name="processorExporter" ref="processorJdbcExporter"/>
            <property name="stockpileExporter" ref="stockpileJdbcExporter"/>
            <property name="materialExporter" ref="materialJdbcExporter"/>
            <property name="locationExporter" ref="locationJdbcExporter" />
            <property name="gisHelper" ref="gisHelper"/>
        </bean>
    </condbean:cond>

    <condbean:cond option="_GEOSERVER_SYNC">
        <bean id="gisInterceptor" class="minestar.mine.service.gis.sync.GISInterceptor" init-method="init">
            <property name="integrationManager" ref="gisIntegration"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="hibernateEventListener" ref="hibernateEventListener"/>
            <property name="notification" ref="notification"/>
        </bean>
    </condbean:cond>

    <bean id="cacheInvalidationThrottlingConfig" class="minestar.mine.service.gis.sync.Throttler.Config">
        <property name="minimumProcessingInterval" value="${minestar.mine.service.gis.Config@MINIMUM_CACHE_UPDATE_INTERVAL}"/>
        <property name="quietInterval" value="${minestar.mine.service.gis.syc.Config@CACHE_UPDATE_QUIET_TIME}"/>
    </bean>

    <bean id="layerInModelLayerGroupEventListener" class="minestar.mine.service.gis.LayerInModelLayerGroupEventListener" init-method="init"
          lazy-init="true">
        <constructor-arg ref="cacheInvalidationThrottlingConfig"/>
        <property name="gisAdministrator" ref="gisAdministrator"/>
    </bean>

    <bean id="layerInAllZonesLayerGroupEventListener" class="minestar.mine.service.gis.LayerInAllZonesLayerGroupEventListener" init-method="init"
          lazy-init="true">
        <constructor-arg ref="cacheInvalidationThrottlingConfig"/>
        <property name="gisAdministrator" ref="gisAdministrator"/>
    </bean>

    <bean id="gradeBlockSource" class="minestar.mine.service.gis.export.GradeBlockWithExportGroupFinder">
        <property name="materialManagementService" ref="materialManagementServiceImpl"/>
    </bean>

    <bean id="gradeBlockWithExportGroupFeatureBuilder" parent="abstractMineStarFeatureBuilder"
          class="minestar.mine.service.gis.featurebuilder.GradeBlockWithExportGroupFeatureBuilder">
        <property name="layerDef" ref="gradeBlockGISLayer"/>
        <property name="materialManagementService" ref="materialManagementServiceImpl"/>
    </bean>

    <bean id="wfsAdapters" class="minestar.mine.service.gis.gt.MineStarAdapters" depends-on="gisAdministrator">
        <property name="gisUtil">
            <bean class="minestar.mine.service.gis.GISAdministrator" factory-method="getGISUtil"/>
        </property>
        <property name="crsCodeResolver" ref="crsCodeResolver"/>
        <property name="adapterSources">
            <list>
                <!-- GradeBlocks -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="gradeBlockGISLayer"/>
                    <constructor-arg name="exporter" ref="gradeBlockJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="gradeBlockFeatureBuilder"/>
                </bean>
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="gradeBlockGISLayer"/>
                    <constructor-arg name="dataFinder" ref="gradeBlockSource"/>
                    <constructor-arg name="featureBuilder" ref="gradeBlockWithExportGroupFeatureBuilder"/>
                </bean>
                <!-- Hazards -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="hazardGISLayer"/>
                    <constructor-arg name="exporter" ref="hazardJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="hazardsFeatureBuilder"/>
                </bean>
                <!-- Lanes -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="laneGISLayer"/>
                    <constructor-arg name="exporter" ref="laneJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="laneFeatureBuilder"/>
                </bean>
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="archivedLaneGISLayer"/>
                    <constructor-arg name="exporter" ref="archivedLaneJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="archivedLaneFeatureBuilder"/>
                </bean>
                <!-- Materials -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="materialGISLayer"/>
                    <constructor-arg name="exporter" ref="materialJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="materialFeatureBuilder"/>
                </bean>
                <!-- Plans -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="planGISLayer"/>
                    <constructor-arg name="exporter" ref="plansJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="plansFeatureBuilder"/>
                </bean>
                <!-- Processors -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="processorGISLayer"/>
                    <constructor-arg name="exporter" ref="processorJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="processorFeatureBuilder"/>
                </bean>
                <!-- Regions -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="regionGISLayer"/>
                    <constructor-arg name="exporter" ref="regionJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="regionFeatureBuilder"/>
                </bean>
                <!-- Stockpiles -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="stockpileGISLayer"/>
                    <constructor-arg name="exporter" ref="stockpileJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="stockpileFeatureBuilder"/>
                </bean>
                <!-- Zones -->
                <bean class="minestar.mine.service.gis.gt.MineStarAdapters.Source">
                    <constructor-arg name="layer" ref="zoneGISLayer"/>
                    <constructor-arg name="exporter" ref="zonesJdbcExporter"/>
                    <constructor-arg name="featureBuilder" ref="zonesFeatureBuilder"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="gt-dataStoreFactory" class="minestar.mine.service.gis.gt.MineStarDataStoreFactory" lazy-init="false">
        <description>This is here so that when the SPI creates the factory the spring configured beans can be used</description>
        <property name="adapters" ref="wfsAdapters"/>
    </bean>

    <bean id="webFeatureServiceFacadeImpl" class="minestar.mine.service.wfs.WebFeatureServiceFacadeImpl" depends-on="wfsAdapters, gt-dataStoreFactory" />

    <bean id="webFeatureServiceFacadeProxy" class="org.springframework.aop.framework.ProxyFactoryBean">
        <property name="targetSource">
            <bean class="org.springframework.aop.target.LazyInitTargetSource">
                <property name="targetBeanName" value="webFeatureServiceFacadeImpl"/>
            </bean>
        </property>
    </bean>

    <bean parent="rmiServiceExporter">
        <property name="serviceName" value="wfsServiceFacade"/>
        <property name="service" ref="webFeatureServiceFacadeProxy"/>
        <property name="serviceInterface" value="minestar.mine.service.wfs.WebFeatureServiceFacade"/>
    </bean>

    <bean id="registerWebFeatureServiceFacade" parent="registrationInstance">
        <constructor-arg value="Web Feature Service"/>
        <constructor-arg value="minestar.mine.service.wfs.WebFeatureServiceFacade"/>
        <constructor-arg ref="webFeatureServiceFacadeImpl"/>
    </bean>

</beans>
