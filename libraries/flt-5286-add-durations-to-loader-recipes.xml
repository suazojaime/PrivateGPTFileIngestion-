<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!-- Copyright (c) 2016, Caterpillar, Brisbane Australia. All rights reserved. -->

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
                    http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    <changeSet id="0c6dbc4b-afb1-463f-bc29-a193d388bcdf" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddColumn for ISDYNAMIC to table LOADER_RECIPE as table does not exist or column already exists."
                onFail="MARK_RAN">
            <tableExists tableName="LOADER_RECIPE"/>
            <not>
                <columnExists tableName="LOADER_RECIPE" columnName="ISDYNAMIC"/>
            </not>
        </preConditions>
        <comment>FLT-5286: AddColumn LOADER_RECIPE.ISDYNAMIC</comment>
        <addColumn tableName="LOADER_RECIPE">
            <column name="ISDYNAMIC" type="BOOLEAN" defaultValueBoolean="false" remarks="This loader recipe is dynamic and depends on blending requirements not static."/>
        </addColumn>
    </changeSet>
    <changeSet id="76c5e306-8f54-408e-85f5-cccf09f02cf9" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddColumn for EMPTYDURATION to table LOADER_RECIPE_STOCKPILES as table does not exist or column already exists."
                onFail="MARK_RAN">
            <tableExists tableName="LOADER_RECIPE_STOCKPILES"/>
            <not>
                <columnExists tableName="LOADER_RECIPE_STOCKPILES" columnName="EMPTYDURATION"/>
            </not>
        </preConditions>
        <comment>FLT-5286: AddColumn LOADER_RECIPE_STOCKPILES.EMPTYDURATION</comment>
        <addColumn tableName="LOADER_RECIPE_STOCKPILES">
            <column name="EMPTYDURATION" type="DOUBLE"/>
        </addColumn>
    </changeSet>
    <changeSet id="4a6ceb83-634e-45b8-8139-995d7a9707db" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for DIGFULLDUMPDURATION to table LOADER_RECIPE_STOCKPILES as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="LOADER_RECIPE_STOCKPILES"/>
            <not>
                <columnExists tableName="LOADER_RECIPE_STOCKPILES" columnName="DIGFULLDUMPDURATION"/>
            </not>
        </preConditions>
        <comment>FLT-5286: AddColumn LOADER_RECIPE_STOCKPILES.DIGFULLDUMPDURATION</comment>
        <addColumn tableName="LOADER_RECIPE_STOCKPILES">
            <column name="DIGFULLDUMPDURATION" type="DOUBLE"/>
        </addColumn>
    </changeSet>
    <changeSet id="57eff01a-78ea-410a-a5e8-ab7c70657a8a" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for LOADER_RECIPE.ISDYNAMIC as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="LOADER_RECIPE" columnName="ISDYNAMIC"/>
        </preConditions>
        <comment>FLT-5286: AddNotNullConstraint to LOADER_RECIPE.ISDYNAMIC</comment>
        <sql>UPDATE LOADER_RECIPE SET ISDYNAMIC = 0 WHERE ISDYNAMIC IS NULL</sql>
        <addNotNullConstraint columnName="ISDYNAMIC" columnDataType="BOOLEAN" tableName="LOADER_RECIPE"/>
        <rollback>
            <dropNotNullConstraint tableName="LOADER_RECIPE" columnName="ISDYNAMIC" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
