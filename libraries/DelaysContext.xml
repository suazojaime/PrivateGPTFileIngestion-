<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (c) 2022 Caterpillar -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
       ">

    <bean id="delayActivityTypeDao" class="minestar.mine.persistence.production.DelayActivityTypeDaoImpl" parent="minestarDao" lazy-init="true"/>

    <bean id="delayActivityManagementServiceImpl" class="minestar.production.service.delay.DelayActivityManagementServiceImpl"
          lazy-init="true" init-method="init">
        <property name="delayActivityClassDao">
            <bean class="minestar.mine.persistence.production.DelayActivityClassDaoImpl" parent="minestarDao"/>
        </property>
        <property name="delayActivityTypeDao" ref="delayActivityTypeDao"/>
        <property name="delayManagementService" ref="delayManagementServiceImpl"/>
        <property name="notification" ref="notification"/>
        <property name="hibernateEventListener" ref="hibernateEventListener"/>
        <property name="txManager" ref="minestarTransactionManager"/>
    </bean>

    <bean id="delayInContactOutOfContactMonitor" init-method="init"
          class="minestar.production.service.delay.contact.InContactOutOfContactMonitor" lazy-init="true">
    </bean>

    <bean id="delayManagementServiceImpl"
          class="minestar.production.service.delay.DelayManagementServiceImpl"
          lazy-init="true"
          init-method="init"
          depends-on="registerSequenceValueService, hibernateMetadataService">
        <property name="delayDao">
            <bean class="minestar.mine.persistence.production.DelayDaoImpl" parent="minestarDao">
                <property name="personDao" ref="personDao"/>
                <property name="userDao" ref="userDao"/>
            </bean>
        </property>
        <property name="eventDao" ref="eventDao"/>
        <property name="delayGroupDao">
            <bean class="minestar.mine.persistence.production.DelayGroupDaoImpl" parent="minestarDao"/>
        </property>
        <property name="delayClassDao">
            <bean class="minestar.mine.persistence.production.DelayClassDaoImpl" parent="minestarDao">
                <constructor-arg name="sequenceValueService" ref="sequenceValueServiceImpl"/>
            </bean>
        </property>
        <property name="delayCategoryDao">
            <bean class="minestar.mine.persistence.production.DelayCategoryDaoImpl" parent="minestarDao"/>
        </property>
        <property name="notification" ref="notification"/>
        <property name="mineFleetService" ref="mineFleetServiceImpl"/>
        <property name="shiftService" ref="shiftServiceImpl"/>
        <property name="timeUsageModelManagementService" ref="timeUsageModelManagementServiceImpl"/>
        <property name="inContactOutOfContactMonitor" ref ="delayInContactOutOfContactMonitor"/>
        <property name="hibernateEventListener" ref="hibernateEventListener"/>
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        <property name="auditLogger" ref="auditLogger"/>
        <property name="dimensionManagementService" ref="dimensionManagementServiceImpl"/>
        <property name="fleetAssignmentService" ref="fleetAssignmentServiceImpl"/>
        <property name="pitModelService" ref="pitModelServiceImpl"/>
        <property name="txManager" ref="minestarTransactionManager"/>
        <property name="scheduledAssignmentService" ref="scheduledAssignmentServiceImpl"/>
    </bean>

    <bean id="cycleDelayManagementServiceImpl" class="minestar.production.service.cycledelay.CycleDelayManagementServiceImpl"
          lazy-init="true" init-method="init">
        <property name="cycleService" ref="cycleServiceImpl"/>
        <property name="delayManagementService" ref="delayManagementServiceImpl"/>
        <property name="cycleActivityArchiveService" ref="cycleActivityArchiveServiceImpl"/>
        <property name="notification" ref="notification"/>
        <property name="txManager" ref="minestarTransactionManager"/>
    </bean>

    <bean id="registerCycleDelayManagementServiceImpl" parent="registrationInstance" lazy-init="true">
        <constructor-arg value="Cycle Delay Management Service"/>
        <constructor-arg value="minestar.production.service.cycledelay.CycleDelayManagementService"/>
        <constructor-arg ref="cycleDelayManagementServiceImpl"/>
    </bean>

    <bean id="registerDelayManagementServiceImpl" parent="registrationInstance" lazy-init="true">
        <constructor-arg value="Delay Management Service"/>
        <constructor-arg value="minestar.production.service.delay.DelayManagementService"/>
        <constructor-arg ref="delayManagementServiceImpl"/>
    </bean>

    <bean id="registerDelayActivityManagementServiceImpl" parent="registrationInstance" lazy-init="true">
        <constructor-arg value="Delay Activity Management Service"/>
        <constructor-arg value="minestar.production.service.delay.DelayActivityManagementService"/>
        <constructor-arg ref="delayActivityManagementServiceImpl"/>
    </bean>

    <bean id="delayFieldNotifier" class="minestar.production.service.delay.DelayFieldNotifier" lazy-init="true" init-method="init" destroy-method="stop">
        <constructor-arg name="delayManagementService" ref="delayManagementServiceImpl"/>
        <constructor-arg name="mineFleetService" ref="mineFleetServiceImpl"/>
        <constructor-arg name="notification" ref="notification"/>
    </bean>

    <util:constant id="delayEventStream" static-field="minestar.production.service.delay.DelayManagementService.COLLECTION_ALL_DELAYS"/>

    <bean id="delayEmailListener" class="minestar.production.service.delay.DelayNotificationEventListener" lazy-init="true" init-method="init">
        <property name="emailNotification" ref="emailNotification"/>
        <property name="safetyMessageUtil" ref="safetyMessageUtil"/>
        <property name="streamName" ref="delayEventStream"/>
    </bean>

    <!-- In a full MineStar system, this is what's in the Delays subsystem -->
    <bean id="fullDelayManagementService" class="java.lang.Object" lazy-init="true"
          depends-on="delayEmailListener, delayFieldNotifier,
          registerCycleDelayManagementServiceImpl, registerDelayManagementServiceImpl,
          registerDelayActivityManagementServiceImpl">
    </bean>
</beans>
