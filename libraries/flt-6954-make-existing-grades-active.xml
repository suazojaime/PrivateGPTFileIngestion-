<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!-- Copyright (c) 2016, Caterpillar, Brisbane Australia. All rights reserved. -->

<!-- This was added as part of Fleet 5.3, and will need to be backported. -->

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">

    <changeSet id="e93b1f4d-8ee5-439e-88e2-58253b6473a1" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored set grades to active upon adding is_active column as feature already in use"
                onFail="MARK_RAN">
            <and>
                <columnExists tableName="GRADE" columnName="NAME"/>
                <sqlCheck expectedResult="0">SELECT COUNT(*) FROM GRADE WHERE IS_ACTIVE = 1</sqlCheck>
            </and>
        </preConditions>
        <comment>FLT-6954: Set grades to active upon adding is_active column</comment>
        <sql>UPDATE GRADE SET IS_ACTIVE = 1 WHERE IS_ACTIVE IS NULL OR IS_ACTIVE = 0</sql>
        <rollback>
            <comment>@EmptyRollback</comment>
        </rollback>
    </changeSet>

</databaseChangeLog>
