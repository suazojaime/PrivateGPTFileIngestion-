<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    <changeSet id="41ed167c-4bd7-40f7-8e90-a93c76a0f9a0" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for AUTONOMOUS to table LANE as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="LANE"/>
            <not>
                <columnExists tableName="LANE" columnName="AUTONOMOUS"/>
            </not>
        </preConditions>
        <comment>AHS-3671: AddColumn LANE.AUTONOMOUS</comment>
        <addColumn tableName="LANE">
            <column name="AUTONOMOUS" type="BOOLEAN" defaultValueBoolean="true" remarks="Lane used for autonomous traffic.">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="a5f1a85c-ece1-41c0-84ae-67ef7fc9af56" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for MANNED to table LANE as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="LANE"/>
            <not>
                <columnExists tableName="LANE" columnName="MANNED"/>
            </not>
        </preConditions>
        <comment>AHS-3671: AddColumn LANE.MANNED</comment>
        <addColumn tableName="LANE">
            <column name="MANNED" type="BOOLEAN" defaultValueBoolean="false" remarks="Lane used for manned traffic.">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <rollback>
            <sql>
                DELETE FROM LANE_LEFT_POINT WHERE LANE_OID IN (SELECT LANE.LANE_OID FROM LANE WHERE LANE.MANNED = 1 AND LANE.AUTONOMOUS = 0);
                DELETE FROM LANE_PATH_POINT WHERE LANE_OID IN (SELECT LANE.LANE_OID FROM LANE WHERE LANE.MANNED = 1 AND LANE.AUTONOMOUS = 0);
                DELETE FROM LANE_RIGHT_POINT WHERE LANE_OID IN (SELECT LANE.LANE_OID FROM LANE WHERE LANE.MANNED = 1 AND LANE.AUTONOMOUS = 0);
                DELETE FROM LANE WHERE LANE.MANNED = 1 AND LANE.AUTONOMOUS = 0;
            </sql>
            <dropColumn tableName="LANE" columnName="MANNED"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
