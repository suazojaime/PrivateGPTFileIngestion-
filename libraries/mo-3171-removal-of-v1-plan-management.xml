<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    <changeSet id="279e6943-39bd-4722-b408-e60d26c4caa9" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_COMMENT as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_COMMENT"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_COMMENT</comment>
        <dropTable tableName="PROD_PLAN_COMMENT"/>
        <rollback>
            <createTable tableName="PROD_PLAN_COMMENT">
                <column name="PLAN_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="COMMENT_NR" type="INT">
                    <constraints nullable="false"/>
                </column>
                <column name="PRIORITY" type="INT"/>
                <column name="DESCRIPTION" type="VARCHAR(1000)"/>
                <column name="IMPORTANT" type="BOOLEAN">
                    <constraints nullable="false"/>
                </column>
            </createTable>
            <addPrimaryKey columnNames="PLAN_OID,COMMENT_NR" constraintName="PROD_PLAN_COMMENT_PK" tableName="PROD_PLAN_COMMENT"/>
            <addForeignKeyConstraint baseTableName="PROD_PLAN_COMMENT" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_COMMENT_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="b6b7c848-73b4-4317-95a3-af9b748b622a" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_FEED_OPTION as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_FEED_OPTION"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_FEED_OPTION</comment>
        <dropTable tableName="PROD_PLAN_FEED_OPTION"/>
        <rollback>
            <createTable tableName="PROD_PLAN_FEED_OPTION">
                <column name="PLAN_DUMP_ORDER_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="OPTION_NR" type="INT">
                    <constraints nullable="false"/>
                </column>
                <column name="SOURCE_REFERENCE" type="VARCHAR(254)"/>
                <column name="MAX_ALLOWABLE_PERCENTAGE" type="DOUBLE"/>
            </createTable>
            <addPrimaryKey columnNames="PLAN_DUMP_ORDER_OID,OPTION_NR" constraintName="PROD_PLAN_FEED_OPTION_PK" tableName="PROD_PLAN_FEED_OPTION"/>
        </rollback>
    </changeSet>
    <changeSet id="8405a01e-5249-4d60-bf04-760b12acf84e" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_DUMP_ORDER as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_DUMP_ORDER"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_DUMP_ORDER</comment>
        <dropTable tableName="PROD_PLAN_DUMP_ORDER"/>
        <rollback>
            <createTable remarks="Store Plan Dump Order details" tableName="PROD_PLAN_DUMP_ORDER">
                <column name="OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="PRIORITY" type="INT"/>
                <column name="DUMP_REFERENCE" type="VARCHAR(254)"/>
                <column name="PLANNED_MASS" type="DOUBLE" remarks="Planned Mass"/>
                <column name="PLAN_OID" type="BIGINT"/>
                <column name="ORDER_NR" type="INT"/>
            </createTable>
            <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_DUMP_ORDER_PK" tableName="PROD_PLAN_DUMP_ORDER"/>
            <addForeignKeyConstraint baseTableName="PROD_PLAN_DUMP_ORDER" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_DUMP_ORDER_PLAN_O_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="9b040f10-5dcd-4be8-8b7e-7b398d0e571b" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_JOB as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_JOB"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_JOB</comment>
        <dropTable tableName="PROD_PLAN_JOB"/>
        <rollback>
            <createTable tableName="PROD_PLAN_JOB">
                <column name="PLAN_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="JOB_NR" type="INT">
                    <constraints nullable="false"/>
                </column>
                <column name="EQUIPMENT_REFERENCE" type="VARCHAR(254)"/>
                <column name="SOURCE_REFERENCE" type="VARCHAR(254)"/>
                <column name="MATERIAL_REFERENCE" type="VARCHAR(254)"/>
                <column name="DUMP_REFERENCE" type="VARCHAR(254)"/>
                <column name="PROD_PLAN_JOB_OID" type="BIGINT"/>
                <column name="MATERIAL_OID" type="BIGINT"/>
                <column name="SOURCE_OID" type="BIGINT"/>
                <column name="DUMP_OID" type="BIGINT"/>
                <column name="EQUIPMENT_OID" type="BIGINT"/>
                <column name="PLANNED_MASS" type="DOUBLE"/>
                <column name="ACTUAL_MASS" type="DOUBLE"/>
                <column name="CREATED_DATE_UTC" type="DATETIME2"/>
                <column name="UPDATED_DATE_UTC" type="DATETIME2"/>
            </createTable>
            <addPrimaryKey columnNames="PLAN_OID,JOB_NR" constraintName="PROD_PLAN_JOB_PK" tableName="PROD_PLAN_JOB"/>
            <addForeignKeyConstraint baseTableName="PROD_PLAN_JOB" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_JOB_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="907b1be6-88c1-472f-8455-936aca2a5fe9" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_METRIC as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_METRIC"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_METRIC</comment>
        <dropTable tableName="PROD_PLAN_METRIC"/>
        <rollback>
            <createTable remarks="Store Plan Metric details" tableName="PROD_PLAN_METRIC">
                <column name="OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="METRIC_TYPE" type="VARCHAR(254)" remarks="Priority">
                    <constraints nullable="false"/>
                </column>
                <column name="REFERENCE" type="VARCHAR(254)"/>
                <column name="PLANNED_MASS" type="DOUBLE" remarks="Planned Mass"/>
                <column name="ACTUAL_MASS" type="DOUBLE" remarks="Actual Mass"/>
                <column name="CREATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of created"/>
                <column name="UPDATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of created"/>
                <column name="PLAN_OID" type="BIGINT"/>
                <column name="METRIC_NR" type="INT"/>
            </createTable>
            <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_METRIC_PK" tableName="PROD_PLAN_METRIC"/>
            <addForeignKeyConstraint baseTableName="PROD_PLAN_METRIC" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_METRIC_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="ff5db818-7bbb-4d36-987b-9ba9546f561b" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_SCHEDULED_OUTAGE as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_SCHEDULED_OUTAGE"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_SCHEDULED_OUTAGE</comment>
        <dropTable tableName="PROD_PLAN_SCHEDULED_OUTAGE"/>
        <rollback>
            <createTable tableName="PROD_PLAN_SCHEDULED_OUTAGE">
                <column name="PLAN_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="OUTAGE_NR" type="INT">
                    <constraints nullable="false"/>
                </column>
                <column name="REFERENCE" type="VARCHAR(254)"/>
                <column name="DELAY_TYPE" type="VARCHAR(254)"/>
                <column name="PLANNED_START_TIMESTAMP_UTC" type="DATETIME2"/>
                <column name="PLANNED_END_TIMESTAMP_UTC" type="DATETIME2"/>
                <column name="ACTUAL_START_TIMESTAMP_UTC" type="DATETIME2"/>
                <column name="ACTUAL_END_TIMESTAMP_UTC" type="DATETIME2"/>
            </createTable>
            <addPrimaryKey columnNames="PLAN_OID,OUTAGE_NR" constraintName="PROD_PLAN_SCHEDULED_OUTAGE_PK" tableName="PROD_PLAN_SCHEDULED_OUTAGE"/>
            <addForeignKeyConstraint baseTableName="PROD_PLAN_SCHEDULED_OUTAGE" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_SCHEDULED_OUTAGE_FK1" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="59f4380c-2309-4369-bfb2-00aad20420b6" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_BACKUP_DUMP as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_BACKUP_DUMP"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_BACKUP_DUMP</comment>
        <dropTable tableName="PROD_PLAN_BACKUP_DUMP"/>
        <rollback>
            <createTable tableName="PROD_PLAN_BACKUP_DUMP">
                <column name="PLAN_SOURCE_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="DUMP_NR" type="INT">
                    <constraints nullable="false"/>
                </column>
                <column name="DUMP_REFERENCE" type="VARCHAR(254)"/>
                <column name="PRIORITY" type="INT"/>
            </createTable>
            <addPrimaryKey columnNames="PLAN_SOURCE_OID,DUMP_NR" constraintName="PROD_PLAN_BACKUP_DUMP_PK" tableName="PROD_PLAN_BACKUP_DUMP"/>
            <addForeignKeyConstraint baseTableName="PROD_PLAN_BACKUP_DUMP" baseColumnNames="PLAN_SOURCE_OID" constraintName="PROD_PLAN_BACKUP_DUMP_PLAN_FK" referencedTableName="PROD_PLAN_SOURCE" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="3c3e2c07-d235-46a8-a7d3-cffc4f44dd03" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_SOURCE as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_SOURCE"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_SOURCE</comment>
        <dropTable tableName="PROD_PLAN_SOURCE"/>
        <rollback>
            <createTable remarks="Store Plan Source details" tableName="PROD_PLAN_SOURCE">
                <column name="OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="PRIORITY" type="INT"/>
                <column name="SOURCE_REFERENCE" type="VARCHAR(254)"/>
                <column name="EQUIPMENT_REFERENCE" type="VARCHAR(254)"/>
                <column name="MAX_ALLOWABLE_MASS" type="DOUBLE" remarks="Max Allowable Mass"/>
                <column name="MAX_AVAILABLE_MASS" type="DOUBLE" remarks="Max Available Mass"/>
                <column name="PLAN_OID" type="BIGINT"/>
                <column name="SOURCE_NR" type="INT"/>
            </createTable>
            <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_SOURCE_PK" tableName="PROD_PLAN_SOURCE"/>
            <createIndex unique="false" indexName="PLAN_OID" tableName="PROD_PLAN_SOURCE">
                <column name="PLAN_OID"/>
            </createIndex>
            <addForeignKeyConstraint baseTableName="PROD_PLAN_SOURCE" baseColumnNames="PLAN_OID" constraintName="PROD_PLAN_SOURCE_PLAN_OID_FK" referencedTableName="PROD_PLAN" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="46b88953-3372-4d1b-8d14-543f763db139" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN_VALIDATION_ERROR as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN_VALIDATION_ERROR"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN_VALIDATION_ERROR</comment>
        <dropTable tableName="PROD_PLAN_VALIDATION_ERROR"/>
        <rollback>
            <createTable tableName="PROD_PLAN_VALIDATION_ERROR">
                <column name="PLAN_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="ERROR_NR" type="INT">
                    <constraints nullable="false"/>
                </column>
                <column name="REFERENCE" type="VARCHAR(254)"/>
            </createTable>
            <addPrimaryKey columnNames="PLAN_OID,ERROR_NR" constraintName="PROD_PLAN_VALIDATION_ERROR_PK" tableName="PROD_PLAN_VALIDATION_ERROR"/>
        </rollback>
    </changeSet>
    <changeSet id="bc19602a-d0be-4258-9433-ee19fc87fe58" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropTable for PROD_PLAN as table does not exist." onFail="MARK_RAN">
            <tableExists tableName="PROD_PLAN"/>
        </preConditions>
        <comment>MO-3171: DropTable PROD_PLAN</comment>
        <dropTable tableName="PROD_PLAN"/>
        <rollback>
            <createTable remarks="Store Plan details" tableName="PROD_PLAN">
                <column name="OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
                <column name="VERSION" type="INT">
                    <constraints nullable="false"/>
                </column>
                <column name="EXTERNAL_REF" type="VARCHAR(254)">
                    <constraints nullable="false"/>
                </column>
                <column name="SITE_NAME" type="VARCHAR(254)"/>
                <column name="PLANNED_START_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan starting">
                    <constraints nullable="false"/>
                </column>
                <column name="PLANNED_END_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan ending">
                    <constraints nullable="false"/>
                </column>
                <column name="ACTUAL_START_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan starting"/>
                <column name="ACTUAL_END_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of plan ending"/>
                <column name="MESSAGE_TIMESTAMP_UTC" type="DATETIME2" remarks="The timestamp of message"/>
                <column name="CREATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of plan created"/>
                <column name="UPDATED_DATE_UTC" type="DATETIME2" remarks="The timestamp of plan created"/>
                <column name="STATUS" type="VARCHAR(254)" remarks="Status">
                    <constraints nullable="false"/>
                </column>
            </createTable>
            <addPrimaryKey columnNames="OID" constraintName="PROD_PLAN_PK" tableName="PROD_PLAN"/>
            <addUniqueConstraint columnNames="EXTERNAL_REF" constraintName="PROD_PLAN_EXTERNAL_REF_UK" tableName="PROD_PLAN"/>
            <createIndex unique="false" indexName="PLANNED_START_TIMESTAMP" tableName="PROD_PLAN">
                <column name="PLANNED_START_TIMESTAMP_UTC"/>
            </createIndex>
            <createIndex unique="false" indexName="PLANNED_END_TIMESTAMP" tableName="PROD_PLAN">
                <column name="PLANNED_END_TIMESTAMP_UTC"/>
            </createIndex>
            <createIndex unique="false" indexName="ACTUAL_START_TIMESTAMP" tableName="PROD_PLAN">
                <column name="ACTUAL_START_TIMESTAMP_UTC"/>
            </createIndex>
            <createIndex unique="false" indexName="ACTUAL_END_TIMESTAMP" tableName="PROD_PLAN">
                <column name="ACTUAL_END_TIMESTAMP_UTC"/>
            </createIndex>
            <createIndex unique="false" indexName="CREATED_DATE" tableName="PROD_PLAN">
                <column name="CREATED_DATE_UTC"/>
            </createIndex>
        </rollback>
    </changeSet>
</databaseChangeLog>
