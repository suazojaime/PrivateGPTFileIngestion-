<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    <changeSet id="8e6cf07b-47ce-4eb4-8aca-446144ae125c" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropIndex for EXPANDING_BUBBLE_SUMM_IDX1 of table EXPANDING_BUBBLE_SUMMARY as index does not exist." onFail="MARK_RAN">
            <indexExists indexName="EXPANDING_BUBBLE_SUMM_IDX1" tableName="EXPANDING_BUBBLE_SUMMARY"/>
        </preConditions>
        <comment>AHS-6701: DropIndex EXPANDING_BUBBLE_SUMMARY.EXPANDING_BUBBLE_SUMM_IDX1</comment>
        <dropIndex indexName="EXPANDING_BUBBLE_SUMM_IDX1" tableName="EXPANDING_BUBBLE_SUMMARY"/>
        <rollback>
            <createIndex unique="false" tablespace="MW_IDXENT" indexName="EXPANDING_BUBBLE_SUMM_IDX1" tableName="EXPANDING_BUBBLE_SUMMARY">
                <column name="MACHINE"/>
                <column name="ACTIVE_TIME"/>
                <column name="INACTIVE_TIME"/>
            </createIndex>
        </rollback>
    </changeSet>
    <changeSet id="4d44f509-93b5-425a-8305-0615c7eb1b4a"
               author="MineStar"
               context="Machine_Tracking/Machine_Tracking_Management"
               failOnError="false">
        <preConditions onFailMessage="Ignored DropColumn for ACTIVE_TIME of table EXPANDING_BUBBLE_SUMMARY as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="EXPANDING_BUBBLE_SUMMARY" columnName="ACTIVE_TIME"/>
        </preConditions>
        <comment>AHS-6701: DropColumn EXPANDING_BUBBLE_SUMMARY.ACTIVE_TIME</comment>
        <dropColumn columnName="ACTIVE_TIME" tableName="EXPANDING_BUBBLE_SUMMARY"/>
        <rollback>
            <addColumn tableName="EXPANDING_BUBBLE_SUMMARY">
                <column name="ACTIVE_TIME" type="DATETIME2" remarks="The time the event became active.">
                    <constraints nullable="false"/>
                </column>
            </addColumn>
        </rollback>
    </changeSet>
    <changeSet id="6c600cd6-48c1-4ecc-ab3f-18ff23486f7a" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropColumn for INACTIVE_TIME of table EXPANDING_BUBBLE_SUMMARY as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="EXPANDING_BUBBLE_SUMMARY" columnName="INACTIVE_TIME"/>
        </preConditions>
        <comment>AHS-6701: DropColumn EXPANDING_BUBBLE_SUMMARY.INACTIVE_TIME</comment>
        <dropColumn columnName="INACTIVE_TIME" tableName="EXPANDING_BUBBLE_SUMMARY"/>
        <rollback>
            <addColumn tableName="EXPANDING_BUBBLE_SUMMARY">
                <column name="INACTIVE_TIME" type="DATETIME2" remarks="The time the event became inactive.">
                    <constraints nullable="false"/>
                </column>
            </addColumn>
        </rollback>
    </changeSet>
    <changeSet id="cbadc375-b520-46f9-b545-7ba1be8d4dba" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for ACTIVE_TIME_UTC to table EXPANDING_BUBBLE_SUMMARY as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="EXPANDING_BUBBLE_SUMMARY"/>
            <not>
                <columnExists tableName="EXPANDING_BUBBLE_SUMMARY" columnName="ACTIVE_TIME_UTC"/>
            </not>
        </preConditions>
        <comment>AHS-6701: AddColumn EXPANDING_BUBBLE_SUMMARY.ACTIVE_TIME_UTC</comment>
        <addColumn tableName="EXPANDING_BUBBLE_SUMMARY">
            <column name="ACTIVE_TIME_UTC" type="DATETIME2">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="7ebe7887-6cfb-4396-ad07-f3257cf7fb1c" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for INACTIVE_TIME_UTC to table EXPANDING_BUBBLE_SUMMARY as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="EXPANDING_BUBBLE_SUMMARY"/>
            <not>
                <columnExists tableName="EXPANDING_BUBBLE_SUMMARY" columnName="INACTIVE_TIME_UTC"/>
            </not>
        </preConditions>
        <comment>AHS-6701: AddColumn EXPANDING_BUBBLE_SUMMARY.INACTIVE_TIME_UTC</comment>
        <addColumn tableName="EXPANDING_BUBBLE_SUMMARY">
            <column name="INACTIVE_TIME_UTC" type="DATETIME2">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>
    <changeSet id="97d4ec68-91d1-46ca-a7b9-8d20114b23eg" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored createIndex for EXPANDING_BUBBLE_SUMM_IDX1 of table EXPANDING_BUBBLE_SUMMARY as index already exists." onFail="MARK_RAN">
            <not>
                <indexExists indexName="EXPANDING_BUBBLE_SUMM_IDX1" tableName="EXPANDING_BUBBLE_SUMMARY"/>
            </not>
        </preConditions>
        <comment>AHS-6701: CreateIndex EXPANDING_BUBBLE_SUMMARY.EXPANDING_BUBBLE_SUMM_IDX1</comment>
        <createIndex unique="false" tablespace="MW_IDXENT" indexName="EXPANDING_BUBBLE_SUMM_IDX1" tableName="EXPANDING_BUBBLE_SUMMARY">
            <column name="MACHINE"/>
            <column name="ACTIVE_TIME_UTC"/>
            <column name="INACTIVE_TIME_UTC"/>
        </createIndex>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
</databaseChangeLog>
