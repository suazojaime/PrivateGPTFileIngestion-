<?xml version="1.0"?>
<!-- Copyright (c) 2019 Caterpillar -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" default-lazy="false" schema="model">

    <class name="minestar.platform.domain.calendar.ShiftRoster" table="SHIFT_ROSTER">

        <meta attribute="table">
            tablespace=MW_OBJ
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXOBJ
        </meta>
        <meta attribute="index">
            name=SHIFTROSTER_NAME
            unique=true
            columns=NAME
            tablespace=MW_IDXOBJ
        </meta>

        <meta attribute="description">An instance of a shift roster pattern.</meta>

        <id name="OID" type="java.lang.Long" column="OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <property name="name" type="string" column="NAME" length="254" not-null="true">
            <meta attribute="description">The name of the shift roster.</meta>
        </property>

        <property name="patternDate" type="TimestampType">
            <meta attribute="timestamp">true</meta>
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The utc time that the pattern reoccurs.</meta>
            <meta attribute="description">The time that the pattern reoccurs.</meta>
            <column name="PATTERN_DATE_UTC"/>
        </property>

        <property name="daysInPattern" type="int">
            <meta attribute="description">The number of days in this shift roster pattern.</meta>
            <column name="DAYS_IN_PATTERN" not-null="true" default="0"/>
        </property>

        <set name="shiftRosterItems" table="SHIFT_ROSTER_ITEM" fetch="select" batch-size="100" sort="natural">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>
            <meta attribute="index-alias">startOffset</meta>
            <meta attribute="description">The start offset for the shift.</meta>

            <key column="OID" not-null="true"/>
            <composite-element class="minestar.platform.domain.calendar.ShiftRosterItem">
                <property name="startOffset" column="START_OFFSET" type="java.lang.Long" not-null="true">
                    <meta attribute="description">The start offset in milliseconds relative to pattern time</meta>
                </property>
                <many-to-one name="crew" class="minestar.platform.domain.roster.CrewReference" column="CREW" not-null="false">
                    <meta attribute="alias">crew</meta>
                </many-to-one>
                <property name="shiftType" type="minestar.platform.persistence.calendar.ShiftType$ByteUserType"
                          column="SHIFT_TYPE" not-null="true">
                    <meta attribute="choices" inherit="false">choice:shiftType</meta>
                </property>
            </composite-element>
        </set>


    </class>


</hibernate-mapping>
