<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    
    <changeSet id="7ab54995-1fa3-45b3-9dcd-02c422ec7516" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddNotNullConstraint for MACHINECLASS.USEFUEL as column does not exist or is already not-nullable"
                onFail="MARK_RAN">
            <ext:columnIsNullable tableName="MACHINECLASS" columnName="USEFUEL"/>
        </preConditions>
        <comment>AHS-7789: AddNotNullConstraint to MACHINECLASS.USEFUEL</comment>
        <sql>UPDATE MACHINECLASS SET USEFUEL = 0 WHERE USEFUEL IS NULL</sql>
        <addNotNullConstraint columnName="USEFUEL" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <dropNotNullConstraint tableName="MACHINECLASS" columnName="USEFUEL" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>

    <changeSet id="44f0c526-f355-44fb-a0c3-ad08de9d2933" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINECLASS.ALLOWALLMATERIALS as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINECLASS" columnName="ALLOWALLMATERIALS"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINECLASS.ALLOWALLMATERIALS</comment>
        <dropDefaultValue columnName="ALLOWALLMATERIALS" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <addDefaultValue columnName="ALLOWALLMATERIALS" columnDataType="BOOLEAN" defaultValueBoolean="false" tableName="MACHINECLASS"/>
        </rollback>
    </changeSet>

    <changeSet id="6c43055e-2455-46de-b8b3-b6d8a799870a" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINECLASS.USEDYNAMICFUELBURNRATE as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINECLASS" columnName="USEDYNAMICFUELBURNRATE"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINECLASS.USEDYNAMICFUELBURNRATE</comment>
        <dropDefaultValue columnName="USEDYNAMICFUELBURNRATE" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <addDefaultValue columnName="USEDYNAMICFUELBURNRATE" columnDataType="BOOLEAN" defaultValueBoolean="false" tableName="MACHINECLASS"/>
        </rollback>
    </changeSet>

    <changeSet id="21e5f404-0fa8-492a-bd52-b62c53eb70dc" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINECLASS.FUELBURNALGORITHM as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINECLASS" columnName="FUELBURNALGORITHM"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINECLASS.FUELBURNALGORITHM</comment>
        <dropDefaultValue columnName="FUELBURNALGORITHM" columnDataType="INT" tableName="MACHINECLASS"/>
        <rollback>
            <addDefaultValue columnName="FUELBURNALGORITHM" columnDataType="INT" defaultValueNumeric="0" tableName="MACHINECLASS"/>
        </rollback>
    </changeSet>

    <changeSet id="afa1c62a-18b7-4299-91b1-a7554c4f0932" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINECLASS.IGNORE_VIMS_FUEL_SENSOR as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINECLASS" columnName="IGNORE_VIMS_FUEL_SENSOR"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINECLASS.IGNORE_VIMS_FUEL_SENSOR</comment>
        <dropDefaultValue columnName="IGNORE_VIMS_FUEL_SENSOR" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <addDefaultValue columnName="IGNORE_VIMS_FUEL_SENSOR" columnDataType="BOOLEAN" defaultValueBoolean="false" tableName="MACHINECLASS"/>
        </rollback>
    </changeSet>

    <changeSet id="3b1203df-a4ae-497c-b463-a65f8c750261" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddNotNullConstraint for MACHINECLASS.ONBOARD_PLATFORM_ID as column does not exist or is already not-nullable"
                onFail="MARK_RAN">
            <ext:columnIsNullable tableName="MACHINECLASS" columnName="ONBOARD_PLATFORM_ID"/>
        </preConditions>
        <comment>AHS-7789: AddNotNullConstraint to MACHINECLASS.ONBOARD_PLATFORM_ID</comment>
        <sql>UPDATE MACHINECLASS SET ONBOARD_PLATFORM_ID = 0 WHERE ONBOARD_PLATFORM_ID IS NULL</sql>
        <addNotNullConstraint columnName="ONBOARD_PLATFORM_ID" columnDataType="INT" tableName="MACHINECLASS"/>
        <rollback>
            <dropNotNullConstraint tableName="MACHINECLASS" columnName="ONBOARD_PLATFORM_ID" columnDataType="INT"/>
        </rollback>
    </changeSet>

    <changeSet id="a6491e11-aec1-4990-b594-b605b190c907" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddNotNullConstraint for MACHINECLASS.OPERATOR_INTERFACE as column does not exist or is already not-nullable"
                onFail="MARK_RAN">
            <ext:columnIsNullable tableName="MACHINECLASS" columnName="OPERATOR_INTERFACE"/>
        </preConditions>
        <comment>AHS-7789: AddNotNullConstraint to MACHINECLASS.OPERATOR_INTERFACE</comment>
        <sql>UPDATE MACHINECLASS SET OPERATOR_INTERFACE = 0 WHERE OPERATOR_INTERFACE IS NULL</sql>
        <addNotNullConstraint columnName="OPERATOR_INTERFACE" columnDataType="INT" tableName="MACHINECLASS"/>
        <rollback>
            <dropNotNullConstraint tableName="MACHINECLASS" columnName="OPERATOR_INTERFACE" columnDataType="INT"/>
        </rollback>
    </changeSet>

    <changeSet id="6e9f6f8c-9707-4ee5-a651-c3ccbc75e2f5" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddNotNullConstraint for MACHINECLASS.CAMERAS as column does not exist or is already not-nullable"
                onFail="MARK_RAN">
            <ext:columnIsNullable tableName="MACHINECLASS" columnName="CAMERAS"/>
        </preConditions>
        <comment>AHS-7789: AddNotNullConstraint to MACHINECLASS.CAMERAS</comment>
        <sql>UPDATE MACHINECLASS SET CAMERAS = 0 WHERE CAMERAS IS NULL</sql>
        <addNotNullConstraint columnName="CAMERAS" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <dropNotNullConstraint tableName="MACHINECLASS" columnName="CAMERAS" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>

    <changeSet id="4d59c137-bb0f-43a7-af35-0ba3bec54737" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddNotNullConstraint for MACHINECLASS.CAMERAS_AND_RADAR as column does not exist or is already not-nullable"
                onFail="MARK_RAN">
            <ext:columnIsNullable tableName="MACHINECLASS" columnName="CAMERAS_AND_RADAR"/>
        </preConditions>
        <comment>AHS-7789: AddNotNullConstraint to MACHINECLASS.CAMERAS_AND_RADAR</comment>
        <sql>UPDATE MACHINECLASS SET CAMERAS_AND_RADAR = 0 WHERE CAMERAS_AND_RADAR IS NULL</sql>
        <addNotNullConstraint columnName="CAMERAS_AND_RADAR" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <dropNotNullConstraint tableName="MACHINECLASS" columnName="CAMERAS_AND_RADAR" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>

    <changeSet id="f6704acf-19cc-4f0a-9d3b-30c6e4f9f51b" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddNotNullConstraint for MACHINECLASS.PROXIMITY_AWARENESS as column does not exist or is already not-nullable"
                onFail="MARK_RAN">
            <ext:columnIsNullable tableName="MACHINECLASS" columnName="PROXIMITY_AWARENESS"/>
        </preConditions>
        <comment>AHS-7789: AddNotNullConstraint to MACHINECLASS.PROXIMITY_AWARENESS</comment>
        <sql>UPDATE MACHINECLASS SET PROXIMITY_AWARENESS = 0 WHERE PROXIMITY_AWARENESS IS NULL</sql>
        <addNotNullConstraint columnName="PROXIMITY_AWARENESS" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <dropNotNullConstraint tableName="MACHINECLASS" columnName="PROXIMITY_AWARENESS" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>

    <changeSet id="13cd1278-fb67-404b-b746-acbfb0e3eccc" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINECLASS.HEALTH_PLATFORM as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINECLASS" columnName="HEALTH_PLATFORM"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINECLASS.HEALTH_PLATFORM</comment>
        <dropDefaultValue columnName="HEALTH_PLATFORM" columnDataType="INT" tableName="MACHINECLASS"/>
        <rollback>
            <addDefaultValue columnName="HEALTH_PLATFORM" columnDataType="INT" defaultValueNumeric="0" tableName="MACHINECLASS"/>
        </rollback>
    </changeSet>

    <changeSet id="ef9a2161-cf60-45a4-bdd1-1896d4b48d31" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropNotNullConstraint for MACHINECLASS.USELOADERPAYLOAD as column does not exist or is already nullable"
                onFail="MARK_RAN">
            <ext:columnIsNotNullable tableName="MACHINECLASS" columnName="USELOADERPAYLOAD"/>
        </preConditions>
        <comment>AHS-7789: DropNotNullConstraint from MACHINECLASS.USELOADERPAYLOAD</comment>
        <dropNotNullConstraint tableName="MACHINECLASS" columnName="USELOADERPAYLOAD" columnDataType="BOOLEAN"/>
    </changeSet>

    <changeSet id="578add01-f087-4c91-9cb4-698483e9d14c" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINECLASS.USELOADERPAYLOAD as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINECLASS" columnName="USELOADERPAYLOAD"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINECLASS.USELOADERPAYLOAD</comment>
        <dropDefaultValue columnName="USELOADERPAYLOAD" columnDataType="BOOLEAN" tableName="MACHINECLASS"/>
        <rollback>
            <addDefaultValue columnName="USELOADERPAYLOAD" columnDataType="BOOLEAN" defaultValueBoolean="false" tableName="MACHINECLASS"/>
        </rollback>
    </changeSet>

    <changeSet id="43dad76a-faac-44e0-86ff-01d6317ceda7" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropNotNullConstraint for MACHINE_ONBOARD_HARDWARE.ONBOARD_PLATFORM_ID as column does not exist or is already nullable"
                onFail="MARK_RAN">
            <ext:columnIsNotNullable tableName="MACHINE_ONBOARD_HARDWARE" columnName="ONBOARD_PLATFORM_ID"/>
        </preConditions>
        <comment>AHS-7789: DropNotNullConstraint from MACHINE_ONBOARD_HARDWARE.ONBOARD_PLATFORM_ID</comment>
        <dropNotNullConstraint tableName="MACHINE_ONBOARD_HARDWARE" columnName="ONBOARD_PLATFORM_ID" columnDataType="INT"/>
    </changeSet>

    <changeSet id="f53e321c-962b-43d3-a7eb-b31bd2224f2b" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINE_ONBOARD_HARDWARE.OPERATOR_INTERFACE as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINE_ONBOARD_HARDWARE" columnName="OPERATOR_INTERFACE"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINE_ONBOARD_HARDWARE.OPERATOR_INTERFACE</comment>
        <dropDefaultValue columnName="OPERATOR_INTERFACE" columnDataType="INT" tableName="MACHINE_ONBOARD_HARDWARE"/>
        <rollback>
            <addDefaultValue columnName="OPERATOR_INTERFACE" columnDataType="INT" defaultValueNumeric="0" tableName="MACHINE_ONBOARD_HARDWARE"/>
        </rollback>
    </changeSet>

    <changeSet id="c6608db2-e4c0-47e0-ab9a-c0e6a4b7a283" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINE_ONBOARD_HARDWARE.CAMERAS as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINE_ONBOARD_HARDWARE" columnName="CAMERAS"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINE_ONBOARD_HARDWARE.CAMERAS</comment>
        <dropDefaultValue columnName="CAMERAS" columnDataType="BOOLEAN" tableName="MACHINE_ONBOARD_HARDWARE"/>
        <rollback>
            <addDefaultValue columnName="CAMERAS" columnDataType="BOOLEAN" defaultValueBoolean="false" tableName="MACHINE_ONBOARD_HARDWARE"/>
        </rollback>
    </changeSet>

    <changeSet id="a9b56279-babc-416f-83bc-9761c27f991a" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINE_ONBOARD_HARDWARE.CAMERAS_AND_RADAR as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINE_ONBOARD_HARDWARE" columnName="CAMERAS_AND_RADAR"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINE_ONBOARD_HARDWARE.CAMERAS_AND_RADAR</comment>
        <dropDefaultValue columnName="CAMERAS_AND_RADAR" columnDataType="BOOLEAN" tableName="MACHINE_ONBOARD_HARDWARE"/>
        <rollback>
            <addDefaultValue columnName="CAMERAS_AND_RADAR" columnDataType="BOOLEAN" defaultValueBoolean="false" tableName="MACHINE_ONBOARD_HARDWARE"/>
        </rollback>
    </changeSet>

    <changeSet id="84fd49c2-0fcc-4283-b4a4-c669d4be3f89" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropDefaultValue for MACHINE_ONBOARD_HARDWARE.PROXIMITY_AWARENESS as column does not exist or column does not have a default value"
                onFail="MARK_RAN">
            <ext:columnHasDefaultValue tableName="MACHINE_ONBOARD_HARDWARE" columnName="PROXIMITY_AWARENESS"/>
        </preConditions>
        <comment>AHS-7789: DropDefaultValue '0' from MACHINE_ONBOARD_HARDWARE.PROXIMITY_AWARENESS</comment>
        <dropDefaultValue columnName="PROXIMITY_AWARENESS" columnDataType="BOOLEAN" tableName="MACHINE_ONBOARD_HARDWARE"/>
        <rollback>
            <addDefaultValue columnName="PROXIMITY_AWARENESS" columnDataType="BOOLEAN" defaultValueBoolean="false" tableName="MACHINE_ONBOARD_HARDWARE"/>
        </rollback>
    </changeSet>

    <changeSet id="b895826c-d2ad-4acb-9a0e-7d18d3ecb34b" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropPrimaryKey for ONBOARD_FILE_VERSION_PK of table ONBOARD_FILE_VERSION as primaryKey does not exist."
                onFail="MARK_RAN">
            <primaryKeyExists primaryKeyName="ONBOARD_FILE_VERSION_PK" tableName="ONBOARD_FILE_VERSION"/>
        </preConditions>
        <comment>AHS-7789: DropPrimaryKey ONBOARD_FILE_VERSION_PK from ONBOARD_FILE_VERSION (HARDWARE_OID,LIST_INDEX)</comment>
        <dropPrimaryKey constraintName="ONBOARD_FILE_VERSION_PK" tableName="ONBOARD_FILE_VERSION"/>
        <rollback>
            <addPrimaryKey columnNames="HARDWARE_OID,LIST_INDEX" constraintName="ONBOARD_FILE_VERSION_PK" tableName="ONBOARD_FILE_VERSION"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

    <changeSet id="8fa84836-9233-47a3-998a-b495bd137b16" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropColumn for LIST_INDEX of table ONBOARD_FILE_VERSION as column does not exist."
                onFail="MARK_RAN">
            <columnExists tableName="ONBOARD_FILE_VERSION" columnName="LIST_INDEX"/>
        </preConditions>
        <comment>AHS-7789: DropColumn ONBOARD_FILE_VERSION.LIST_INDEX</comment>
        <dropColumn columnName="LIST_INDEX" tableName="ONBOARD_FILE_VERSION"/>
        <rollback>
            <addColumn tableName="ONBOARD_FILE_VERSION">
                <column name="LIST_INDEX" type="INT">
                    <constraints nullable="false"/>
                </column>
            </addColumn>
        </rollback>
    </changeSet>

    <changeSet id="91dadd47-f757-4d3f-8759-689c923c9186" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddPrimaryKey for ONBOARD_FILE_VERSION_PK to table ONBOARD_FILE_VERSION as table does not exist or primaryKey already exists."
                onFail="MARK_RAN">
            <tableExists tableName="ONBOARD_FILE_VERSION"/>
            <not>
                <primaryKeyExists primaryKeyName="ONBOARD_FILE_VERSION_PK" tableName="ONBOARD_FILE_VERSION"/>
            </not>
        </preConditions>
        <comment>AHS-7789: AddPrimaryKey ONBOARD_FILE_VERSION_PK to ONBOARD_FILE_VERSION (HARDWARE_OID,FILE_TYPE)</comment>
        <sql dbms="oracle">DELETE FROM ONBOARD_FILE_VERSION WHERE ROWID IN (SELECT RID FROM (SELECT ROWID RID, ROW_NUMBER() OVER (PARTITION BY HARDWARE_OID, FILE_TYPE ORDER BY ROWID) RN FROM ONBOARD_FILE_VERSION) WHERE RN &lt;&gt; 1)</sql>
        <sql dbms="mssql">WITH CTE AS (SELECT ROW_NUMBER() OVER (PARTITION BY HARDWARE_OID, FILE_TYPE ORDER BY %%physloc%%) AS ROW_NUM FROM ONBOARD_FILE_VERSION) DELETE FROM CTE WHERE ROW_NUM &gt; 1</sql>
        <addPrimaryKey columnNames="HARDWARE_OID,FILE_TYPE" constraintName="ONBOARD_FILE_VERSION_PK" tablespace="MW_IDXENT" tableName="ONBOARD_FILE_VERSION"/>
        <rollback>
            <dropPrimaryKey constraintName="ONBOARD_FILE_VERSION_PK" tableName="ONBOARD_FILE_VERSION"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

    <changeSet id="4bba4b8b-9ebd-4414-a2cb-0e19a8c5759c" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for MACHINECLASS_SETMATERIAL_FK of table MACHINECLASS as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="MACHINECLASS" foreignKeyName="MACHINECLASS_SETMATERIAL_FK"/>
        </preConditions>
        <comment>AHS-7789: DropForeignKeyConstraint MACHINECLASS_SETMATERIAL_FK from MACHINECLASS (SETMATERIAL)</comment>
        <dropForeignKeyConstraint baseTableName="MACHINECLASS" constraintName="MACHINECLASS_SETMATERIAL_FK"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="MACHINECLASS" baseColumnNames="SETMATERIAL" constraintName="MACHINECLASS_SETMATERIAL_FK" referencedTableName="MATERIAL" referencedColumnNames="MATERIAL_OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>

    <changeSet id="4cb27d6c-e36e-4c74-bd79-9d91c19d10b8" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropColumn for SETMATERIAL of table MACHINECLASS as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="MACHINECLASS" columnName="SETMATERIAL"/>
        </preConditions>
        <comment>AHS-7789: DropColumn MACHINECLASS.SETMATERIAL</comment>
        <dropColumn columnName="SETMATERIAL" tableName="MACHINECLASS"/>
        <rollback>
            <addColumn tableName="MACHINECLASS">
                <column name="SETMATERIAL" type="BIGINT" remarks="The OID of the set material for the truck class."/>
            </addColumn>
        </rollback>
    </changeSet>

</databaseChangeLog>
