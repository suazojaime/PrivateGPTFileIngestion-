<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" schema="historical">

    <class name="minestar.production.domain.drawcard.HistoricalDrawCardImpl"
           proxy="minestar.production.domain.drawcard.HistoricalDrawCard"
           table="HISTORICAL_DRAW_CARD"
           dynamic-update="true">

        <meta attribute="alias" inherit="false">HISTORICALDRAWCARD</meta>
        <meta attribute="view-master">true</meta>
        <meta attribute="description">A draw card for a period in the past.</meta>
        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>

        <id name="OID"
            type="java.lang.Long"
            column="HDC_OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <property name="createdDate" type="TimestampType">
            <meta attribute="timestamp">true</meta>
            <meta attribute="utc-description">The utc time the cycle was last updated.</meta>
            <meta attribute="description">The utc time the cycle was last updated.</meta>
            <meta attribute="view-localtime">true</meta>
            <column name="CREATED_DATE_UTC"/>
        </property>

        <property name="lastModified" type="TimestampType">
            <meta attribute="timestamp">true</meta>
            <meta attribute="utc-description">The utc time the cycle was last updated.</meta>
            <meta attribute="description">The utc time the cycle was last updated.</meta>
            <meta attribute="view-localtime">true</meta>
            <column name="LAST_MODIFIED_UTC"/>
        </property>

        <property name="drawCardDate"
                  type="java.util.Date"
                  column="DRAW_CARD_DATE"
                  not-null="true">
            <meta attribute="description">The date that the information in this draw card applies to.</meta>
        </property>

        <many-to-one name="shift"
                     class="minestar.platform.domain.calendar.ShiftImpl"
                     column="SHIFT"
                     not-null="false"
                     lazy="false"
                     unique="true">
            <meta attribute="description">
                A reference to the shift (MSMODEL.SHIFT) that the information in this draw card applies to.
                (Not applicable if this draw card is for the entire day.)
            </meta>
        </many-to-one>

        <map name="importedFileData" table="HDC_IMPORTED_FILE_DATA" lazy="false" cascade="all-delete-orphan">
            <meta attribute="index-alias">importedFileName</meta>
            <meta attribute="description">
                The details of the CSV files that were imported for draw cards for past periods.
            </meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <key column="HDC_OID"/>
            <index column="IMPORTED_FILE_NAME" type="java.lang.String"/>
            <element column="IMPORTED_DATE_UTC" type="TimestampType"/>
        </map>

        <map name="areaData" lazy="false" inverse="true" cascade="all-delete-orphan">
            <meta attribute="description">The entries in this draw card grouped by underground area.</meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <key column="HDC_OID"/>
            <map-key-many-to-many class="minestar.mine.domain.minemodel.underground.area.UndergroundAreaReference"
                                  column="AREA"/>
            <one-to-many class="minestar.production.domain.drawcard.HistoricalDrawCardEntryList"/>
        </map>
    </class>

    <class name="minestar.production.domain.drawcard.HistoricalDrawCardEntryList"
           table="HDC_ENTRY_LIST"
           dynamic-update="true">

        <meta attribute="view-master">true</meta>
        <meta attribute="description">
            A list of entries in a draw card for a past period that are for draw points within the same underground
            area.
        </meta>
        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>

        <id name="OID"
            type="java.lang.Long"
            column="HDCL_OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <many-to-one name="parent"
                     column="HDC_OID"
                     class="minestar.production.domain.drawcard.HistoricalDrawCardImpl"
                     not-null="true">
            <meta attribute="description">
                A reference to the draw card (MSHIST.HISTORICAL_DRAW_CARD) that contains this entry list.
            </meta>
        </many-to-one>

        <many-to-one name="area"
                     class="minestar.mine.domain.minemodel.underground.area.UndergroundAreaReference"
                     column="AREA"
                     not-null="true">
            <meta attribute="description">
                A reference to the underground area (MSMODEL.UNDERGROUND_AREA) that the draw points belong to.
            </meta>
        </many-to-one>

        <map name="entryMap" lazy="false" inverse="true" cascade="all-delete-orphan">
            <meta attribute="description">The entries for draw points within the underground area.</meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <key column="HDCL_OID"/>
            <map-key-many-to-many class="minestar.mine.domain.minemodel.underground.drawpoint.DrawPointReference"
                                  column="DRAW_POINT"/>
            <one-to-many class="minestar.production.domain.drawcard.HistoricalDrawCardEntry"/>
        </map>
    </class>

    <class name="minestar.production.domain.drawcard.HistoricalDrawCardEntry"
           table="HDC_ENTRY"
           dynamic-update="true">

        <meta attribute="alias" inherit="false">HISTORICALDRAWCARDENTRY</meta>
        <meta attribute="view-master">true</meta>
        <meta attribute="description">An entry for a draw point in a draw card for a past period.</meta>
        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>

        <id name="OID"
            type="java.lang.Long"
            column="HDCE_OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <many-to-one name="parent"
                     column="HDCL_OID"
                     class="minestar.production.domain.drawcard.HistoricalDrawCardEntryList"
                     not-null="true">
            <meta attribute="description">
                A reference to the entry list (MSHIST.HDC_ENTRY_LIST) in the draw card that contains this entry.
            </meta>
        </many-to-one>

        <many-to-one name="drawPoint"
                     column="DRAW_POINT"
                     class="minestar.mine.domain.minemodel.underground.drawpoint.DrawPointReference">
            <meta attribute="description">
                A reference to the draw point (MSMODEL.DRAW_POINT) that this entry applies to.
            </meta>
        </many-to-one>

        <many-to-one name="drawPointOperatingStatus"
                     column="OPERATING_STATUS"
                     class="minestar.mine.domain.minemodel.underground.operatingstatus.DrawPointOperatingStatusImpl"
                     lazy="false">
            <meta attribute="description">
                A reference to the operating conditions (MSMODEL.OPERATING_STATUS) of the draw point at the end of the
                draw card's period.
            </meta>
        </many-to-one>

        <many-to-one name="drawPointStatus"
                     column="DP_STATUS"
                     class="minestar.mine.domain.minemodel.underground.drawpoint.DrawPointStatus"
                     lazy="false">
            <meta attribute="description">
                A reference to the status (MSMODEL.DP_STATUS) of the draw point at the end of the draw card's period.
            </meta>
        </many-to-one>

        <property name="loadTakenCount"
                  column="LOAD_TAKEN_COUNT"
                  type="java.lang.Integer">
            <meta attribute="description">The number of loads that were taken from the draw point.</meta>
        </property>

        <property name="taken"
                  column="TAKEN_TONS">
            <meta attribute="description">The amount of ore that was taken from the draw point.</meta>
            <type name="quantity">
                <param name="unitType">mass</param>
            </type>
        </property>

        <property name="target"
                  column="TARGET_TONS">
            <meta attribute="description">The amount of ore that should have been taken from the draw point.</meta>
            <type name="quantity">
                <param name="unitType">mass</param>
            </type>
        </property>

        <property name="extras"
                  column="EXTRA_TONS">
            <meta attribute="description">
                The amount of ore that could have be taken from the draw point above the target.
            </meta>
            <type name="quantity">
                <param name="unitType">mass</param>
            </type>
        </property>

        <map name="continuousGrades" table="DRAW_CARD_GRADES" cascade="all-delete-orphan" lazy="false">
            <meta attribute="element-unitType">ratio</meta>
            <meta attribute="alias">grade_name</meta>
            <meta attribute="description">
                The details of the draw points' ore grades at the end of a historical draw card's period.
            </meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <key column="HDCE_OID"/>
            <map-key column="GRADE_NAME" type="java.lang.String"/>
            <element column="GRADE_QUALITY">
                <type name="quantity">
                    <param name="unitType">ratio</param>
                </type>
            </element>
        </map>

        <map name="discreteGrades" table="DRAW_CARD_DISCRETE_GRADES" cascade="all-delete-orphan" lazy="false">
            <meta attribute="alias">discrete_grade_name</meta>
            <meta attribute="description">
                The details of the draw points' ore discrete grades at the end of a historical draw card's period.
            </meta>
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <key column="HDCE_OID"/>
            <map-key column="GRADE_NAME" type="java.lang.String"/>
            <element type="java.lang.String" length="255" column="GRADE_VALUE"/>
        </map>

    </class>

</hibernate-mapping>
