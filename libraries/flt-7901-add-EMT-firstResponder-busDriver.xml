<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--
  ~ Copyright (c) 2018, Caterpillar
  -->

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="e004b101-4af0-4da4-bb5e-fc576825234a" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddColumn for EMT to table PERSON as table does not exist or column already exists."
                onFail="MARK_RAN">
            <tableExists tableName="PERSON"/>
            <not>
                <columnExists tableName="PERSON" columnName="EMT"/>
            </not>
        </preConditions>
        <comment>FLT-7901: AddColumn PERSON.EMT</comment>
        <!-- Add the column as nullable, the default value is null -->
        <addColumn tableName="PERSON">
            <column name="EMT" type="BOOLEAN"/>
        </addColumn>
        <!-- put a value in the column -->
        <sql>UPDATE PERSON SET EMT = 0 WHERE EMT IS NULL</sql>
        <!-- change the column to not be nullable -->
        <addNotNullConstraint columnName="EMT" columnDataType="BOOLEAN" tableName="PERSON"/>
        <!-- Define explicit rollback since there are multiple steps in the change set. -->
        <rollback>
            <dropColumn tableName="PERSON" columnName="EMT"/>
        </rollback>
    </changeSet>

    <changeSet id="c8508c3d-00e2-452a-84a6-987ee540ddb5" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddColumn for FIRST_RESPONDER to table PERSON as table does not exist or column already exists."
                onFail="MARK_RAN">
            <tableExists tableName="PERSON"/>
            <not>
                <columnExists tableName="PERSON" columnName="FIRST_RESPONDER"/>
            </not>
        </preConditions>
        <comment>FLT-7901: AddColumn PERSON.FIRST_RESPONDER</comment>
        <!-- Add the column as nullable, the default value is null -->
        <addColumn tableName="PERSON">
            <column name="FIRST_RESPONDER" type="BOOLEAN"/>
        </addColumn>
        <!-- put a value in the column -->
        <sql>UPDATE PERSON SET FIRST_RESPONDER = 0 WHERE FIRST_RESPONDER IS NULL</sql>
        <!-- change the column to not be nullable -->
        <addNotNullConstraint columnName="FIRST_RESPONDER" columnDataType="BOOLEAN" tableName="PERSON"/>
        <!-- Define explicit rollback since there are multiple steps in the change set. -->
        <rollback>
            <dropColumn tableName="PERSON" columnName="FIRST_RESPONDER"/>
        </rollback>
    </changeSet>

    <changeSet id="a5971f12-8328-486f-a279-84ff0bed7756" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddColumn for BUS_DRIVER to table PERSON as table does not exist or column already exists."
                onFail="MARK_RAN">
            <tableExists tableName="PERSON"/>
            <not>
                <columnExists tableName="PERSON" columnName="BUS_DRIVER"/>
            </not>
        </preConditions>
        <comment>FLT-7901: AddColumn PERSON.BUS_DRIVER</comment>
        <!-- Add the column as nullable, the default value is null -->
        <addColumn tableName="PERSON">
            <column name="BUS_DRIVER" type="BOOLEAN"/>
        </addColumn>
        <!-- put a value in the column -->
        <sql>UPDATE PERSON SET BUS_DRIVER = 0 WHERE BUS_DRIVER IS NULL</sql>
        <!-- change the column to not be nullable -->
        <addNotNullConstraint columnName="BUS_DRIVER" columnDataType="BOOLEAN" tableName="PERSON"/>
        <!-- Define explicit rollback since there are multiple steps in the change set. -->
        <rollback>
            <dropColumn tableName="PERSON" columnName="BUS_DRIVER"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
