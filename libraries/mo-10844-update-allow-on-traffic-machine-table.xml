<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">

    <changeSet id="6a4bef57-e0d9-4228-b556-8891c2a8323f" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored add not null constraint for ALLOW_ON_TRAFFIC of table MACHINE as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="MACHINE" columnName="ALLOW_ON_TRAFFIC"/>
            <ext:columnIsNullable tableName="MACHINE" columnName="ALLOW_ON_TRAFFIC"/>
        </preConditions>
        <comment>MO-10844: add not null constraint MACHINE.ALLOW_ON_TRAFFIC</comment>
        <addNotNullConstraint defaultNullValue="0" columnName="ALLOW_ON_TRAFFIC" columnDataType="BOOLEAN" tableName="MACHINE"/>
        <rollback/>
    </changeSet>
    <changeSet id="0f9906ab-0f46-427c-a1d4-a6f2ad7d1964" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored add default value for ALLOW_ON_TRAFFIC of table MACHINE as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="MACHINE" columnName="ALLOW_ON_TRAFFIC"/>
            <not>
                <ext:columnHasDefaultValue tableName="MACHINE" columnName="ALLOW_ON_TRAFFIC"/>
            </not>
        </preConditions>
        <comment>MO-10844: Add Default Value MACHINE.ALLOW_ON_TRAFFIC</comment>
        <addDefaultValue tableName="MACHINE" columnName="ALLOW_ON_TRAFFIC" defaultValueNumeric="0"/>
        <rollback/>
    </changeSet>

    <changeSet id="f10b804c-e60f-4302-8952-124ac71c860a" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored SQL update default value 0 if it is null for ALLOW_ON_TRAFFIC to table Machine , if Column does not exist." onFail="MARK_RAN">
            <tableExists tableName="MACHINE"/>
            <columnExists tableName="MACHINE" columnName="ALLOW_ON_TRAFFIC"/>
        </preConditions>
        <comment>MO-10844: Update ALLOW_ON_TRAFFIC column to default value 0 if it is null </comment>
        <sql>UPDATE MACHINE SET ALLOW_ON_TRAFFIC = 0 WHERE ALLOW_ON_TRAFFIC IS NULL AND ECF_CLASS_ID = 'XAEntity.Machine.FixedPlant.PayloadService'</sql>
        <rollback/>
    </changeSet>

</databaseChangeLog>
