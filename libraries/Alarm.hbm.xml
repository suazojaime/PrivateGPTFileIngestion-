<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" default-lazy="false">

    <class name="minestar.platform.domain.alarm.AlarmType" schema="model" table="ALARMTYPE">

        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=ALARMTYPE_NAME
            unique=true
            columns=NAME
            tablespace=MW_IDXENT
        </meta>

        <meta attribute="description">Information about the type of alarm.</meta>

        <!-- View properties to make the V_ALARMTYPE view backwards compatible -->
        <meta attribute="viewproperty-description" inherit="false">
            type=string
            description=The description of the alarm type (same as MESSAGE_FORMAT)
            expression=lookupResource.alarmtype.description.query
        </meta>
        <meta attribute="viewproperty-priorityName" inherit="false">
            type=string
            description=The priority of the alarm type (same as PRIORITY_D)
            expression=lookupResource.alarmtype.priorityName.query
        </meta>
        <meta attribute="viewproperty-severityName" inherit="false">
            type=string
            description=The severity of the alarm type (same as SEVERITY_D)
            expression=lookupResource.alarmtype.severityName.query
        </meta>

        <id name="OID" type="long" column="ALARMTYPE_OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <property name="name" type="string" column="NAME" length="254" not-null="true">
            <meta attribute="description">The name of this alarm type.</meta>
        </property>

        <property name="messageFormat" type="string" column="MESSAGE_FORMAT" length="4000" not-null="true">
            <meta attribute="description">A free form description of the alarm type.</meta>
        </property>

        <property name="priority" type="minestar.platform.domain.alarm.AlarmPriority$UserType" column="PRIORITY" not-null="true">
            <meta attribute="description">Priority indicates how important it is to action this type of alarm.</meta>
            <meta attribute="choices" inherit="false">choice:alarmPriority</meta>
        </property>

        <property name="severity" type="minestar.platform.domain.alarm.AlarmSeverity$UserType" column="SEVERITY" not-null="true">
            <meta attribute="description">The impact of this type of alarm on the system.</meta>
            <meta attribute="choices" inherit="false">choice:alarmSeverity</meta>
        </property>

        <property name="ackType" type="minestar.platform.domain.alarm.AlarmTypeAckType$UserType" column="ACK_TYPE" not-null="true">
            <meta attribute="description">The type of acknowledgement that alarms of this type require.</meta>
            <meta attribute="choices" inherit="false">choice:alarmAckType</meta>
        </property>

        <property name="closeOnEndOfShift" type="boolean" column="CLOSE_SHIFT" not-null="true">
            <meta attribute="description">Whether this alarm should be automatically closed at end of shift.</meta>
        </property>

        <property name="endOfShiftCloseDuration" type="string" column="CLOSE_DURATION" length="64">
            <meta attribute="description">How long this alarm has to be open before it will be closed at the end of shift.</meta>
        </property>

        <property name="resolveCategory" type="minestar.platform.domain.alarm.AlarmResolveCategory$UserType" column="RESOLVE_CATEGORY" not-null="true">
            <meta attribute="choices">choice:alarmResolveCategory</meta>
            <meta attribute="description">The resolve category for the alarm</meta>
        </property>

        <property name="resolveAction" type="string" column="RESOLVE_ACTION" length="254">
            <meta attribute="description">The custom action to be taken in the UI to resolve the alarm.</meta>
        </property>

        <property name="resolvePage" type="string" column="RESOLVE_PAGE" length="254">
            <meta attribute="description">The page accessed to resolve the alarm.</meta>
        </property>

        <property name="resolvePageParameters" type="string" column="RESOLVE_PAGE_PARAMETERS" length="254">
            <meta attribute="description">Advanced parameters to pass to the page.</meta>
        </property>
        
        <property name="lastOccurrenceTime" type="TimestampType" column="LAST_OCCUR_TIME_UTC">
            <meta attribute="utc-description">The date and utc time that an alarm of this type last occurred.</meta>
            <meta attribute="description">The date and time that an alarm of this type last occurred.</meta>
            <meta attribute="export-marshall" inherit="false">false</meta>
            <meta attribute="view-localtime">true</meta>
        </property>
    </class>

    <class name="minestar.platform.domain.alarm.Alarm" table="ALARM" schema="historical">
        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>
        <!-- The ALARM_END_TIME_UTC index is designed to support a query for "END_TIME_UTC IS NULL".
             The ', 1' is required as Oracle does not index null values unless there is a non-null
             element as part of the index -->
        <meta attribute="index">
            createOnInstanceType=oracle
            name=ALARM_END_TIME
            columns=END_TIME_UTC, 1
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            createOnInstanceType=sqlserver
            name=ALARM_END_TIME
            columns=END_TIME_UTC
        </meta>

        <meta attribute="description">Describes exceptional events in the system, what caused them, and if they have been resolved.</meta>

        <!-- These view properties are only here to make BO reports backwards compatible -->
        <meta attribute="viewproperty-name" inherit="false">
            type=string
            description=The name of the alarm type (same as ALARM_TYPE_NAME)
            expression=lookupResource.alarm.name.query
        </meta>
        <meta attribute="viewproperty-description" inherit="false">
            type=string
            description=The description of the alarm (same as MESSAGE)
            expression=lookupResource.alarm.description.query
        </meta>
        <meta attribute="viewproperty-mineControllerName" inherit="false">
            type=string
            description=Not used
            expression=lookupResource.null.query
        </meta>
        <meta attribute="viewproperty-creationTime" inherit="false">
            type=string
            description=The time at which the alarm was created (same as START_TIME)
            expression=lookupResource.alarm.creationTime.query
        </meta>
        <meta attribute="viewproperty-priorityName" inherit="false">
            type=string
            description=The priority of the alarm (same as PRIORITY_D)
            expression=lookupResource.alarm.priorityName.query
        </meta>
        <meta attribute="viewproperty-severityName" inherit="false">
            type=string
            description=The severity of the alarm (same as SEVERITY_D)
            expression=lookupResource.alarm.severityName.query
        </meta>
        <meta attribute="viewproperty-sourceSystem" inherit="false">
            type=string
            description=The source system of the alarm (same as SOURCETYPE_D)
            expression=lookupResource.alarm.sourceSystem.query
        </meta>

        <id name="OID" type="long" column="ALARM_OID">
            <!-- Assigned in AlarmServiceImpl.executeSaveAlarm() -->
            <generator class="assigned"/>
        </id>

        <property name="alarmTypeOID" type="long" column="ALARM_TYPE_OID" not-null="true">
            <meta attribute="description">OID of the alarm type</meta>
        </property>

        <property name="alarmTypeName" type="string" column="ALARM_TYPE_NAME" length="254" not-null="true">
            <meta attribute="description">Name of the alarm type</meta>
        </property>

        <property name="message" type="string" column="MESSAGE" length="4000" not-null="true"/>

        <property name="localizableMessage" type="LocalisableString" column="LOCALIZABLE_MESSAGE" length="4000"/>

        <property name="priority" type="minestar.platform.domain.alarm.AlarmPriority$UserType" column="PRIORITY" not-null="true">
            <meta attribute="choices" inherit="false">choice:alarmPriority</meta>
        </property>

        <property name="severity" type="minestar.platform.domain.alarm.AlarmSeverity$UserType" column="SEVERITY" not-null="true">
            <meta attribute="choices" inherit="false">choice:alarmSeverity</meta>
        </property>

        <property name="operatorOID" type="long" column="OPERATOR_OID">
            <meta attribute="description">OID of the operator</meta>
        </property>

        <property name="operatorName" type="string" column="OPERATOR_NAME" length="254">
            <meta attribute="description">Name of the operator</meta>
        </property>

        <property name="startTime" type="TimestampType" column="START_TIME_UTC" not-null="true">
            <meta attribute="timestamp">true</meta>
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The start utc timestamp</meta>
        	<meta attribute="description">The start timestamp</meta>
        </property>

        <property name="lastOccurrenceTime" type="TimestampType" column ="LAST_OCCUR_TIME_UTC" not-null="true">
            <meta attribute="timestamp">true</meta>
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The utc time that was last occurred</meta>
        	<meta attribute="description">The time that was last occurred</meta>
        </property>

        <property name="ackTime" type="TimestampType" column ="ACK_TIME_UTC">
            <meta attribute="timestamp">true</meta>
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The utc time that was acknowledged</meta>
        	<meta attribute="description">The time that was acknowledged</meta>
        </property>

        <property name="endTime" type="TimestampType" column ="END_TIME_UTC">
            <meta attribute="timestamp">true</meta>
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The end utc timestamp</meta>
        	<meta attribute="description">The end timestamp</meta>
        </property>

        <property name="ackType" type="minestar.platform.domain.alarm.AlarmAckType$UserType" column="ACK_TYPE" not-null="true">
            <meta attribute="choices" inherit="false">choice:alarmAckType</meta>
        </property>

        <property name="userName" type="string" column="USER_NAME" length="254">
            <meta attribute="description">Name of the user done a action on Alarm</meta>
        </property>

        <property name="sourceType" type="minestar.platform.domain.alarm.AlarmSourceType$UserType" column="SOURCE_TYPE" not-null="true">
            <meta attribute="choices" inherit="false">choice:alarmSourceType</meta>
        </property>

        <property name="sourceOID" type="long" column="SOURCE_OID">
            <meta attribute="description">OID of the source entity.  May be null for 'SYSTEM' generated alarms</meta>
        </property>

        <property name="sourceName" type="string" column="SOURCE_NAME" length="254">
            <meta attribute="description">Name of the source entity.  May be null for 'SYSTEM' generated alarms</meta>
        </property>

        <property name="alarmComment" type="string" column="ALARM_COMMENT" length="4000"/>

        <property name="occurrenceCount" type="int" column="OCCURRENCE_COUNT" not-null="true">
            <meta attribute="universe-type-measure">true</meta>
            <meta attribute="description">The number of times an alarm has been raised for a (source, alarmType) combination which the alarm was open</meta>
        </property>
    </class>

</hibernate-mapping>
