<?xml version="1.0"?>
<!-- Copyright (c) 2020 Caterpillar -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping default-access="field" default-lazy="false" schema="model">

    <class name="minestar.mine.domain.minemodel.LocationImpl"
           table="LOCATION">

        <meta attribute="alias" inherit="false">Destination</meta>

        <meta attribute="table">
            tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
            tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=LOCATION_NAME
            unique=true
            columns=NAME
            tablespace=MW_IDXENT
        </meta>

        <meta attribute="description">A place in the mine where you might find machines.</meta>

        <cache usage="read-write" region="model"/>

        <id name="OID" type="long" column="LOCATION_OID">
            <generator class="assigned"/>
        </id>

        <property name="active" type="boolean" column="IS_ACTIVE" not-null="true">
            <meta attribute="description">Is this destination active</meta>
        </property>

        <property name="name" type="string" column="NAME" length="254" not-null="true">
            <meta attribute="description">The name of this location.</meta>
        </property>

        <property name="description" type="string" column="DESCRIPTION" length="254">
            <meta attribute="description">A description of this location.</meta>
        </property>

        <property name="reHandle" type="boolean" column="REHANDLE" not-null="true">
            <meta attribute="description">When true, specifies that this location is for rehandling material, eg a stockpile.</meta>
        </property>

        <property name="isSource" type="boolean" column="ISSOURCE" not-null="true">
            <meta attribute="description">This location is a source.</meta>
        </property>

        <property name="isSink" type="boolean" column="ISSINK" not-null="true">
            <meta attribute="description">This location is a sink.</meta>
        </property>

        <property name="isStation" type="boolean" column="ISSTATION" not-null="true">
            <meta attribute="description">This location is a station.</meta>
        </property>

        <property name="allowAllMaterials" type="boolean" column="ALLOWALLMATERIALS" not-null="true">
            <meta attribute="description">When true, all materials are found at this Location.</meta>
        </property>

        <property name="allowThroughTraffic" type="boolean" column="ALLOWTHORUGHTRAFFIC" not-null="true">
            <meta attribute="description">This location allows through traffic not to cause off-course assignments.</meta>
        </property>

        <property name="truckCapacity" type="int" column="TRUCKCAPACITY" not-null="true">
            <meta attribute="description">
                The maximum number of trucks that can be at the destination at the same time.
                This is only valid for stations.
            </meta>
        </property>

        <property name="queuingAllowed" type="boolean" column="QUEUINGALLOWED" not-null="true">
            <meta attribute="description">
                When true, specifies that queuing is allowed. This is only valid for stations.
            </meta>
        </property>

        <property name="taxClass" type="string" column="TAXCLASS" length="254">
            <meta attribute="description">The tax class value for the location.</meta>
        </property>

        <property name="isParent" type="boolean" column="ISPARENT" not-null="true">
            <meta attribute="description">This location is a parent location containing child locations.</meta>
        </property>

        <property name="badCommsArea" type="boolean" column="BADCOMMSAREA" not-null="true">
            <meta attribute="description">When true, specifies that this location may have bad communications.</meta>
        </property>

        <property name="stationLoadState" type="minestar.domain.model.persistence.LoadStateUserType" column="LOADSTATE">
            <meta attribute="choices" inherit="false">choice:scheduledAssignmentLS</meta>
            <meta attribute="description">The load state for a location that is a station</meta>
        </property>

        <property name="externalRef" type="string" column="EXTERNALREF" length="254">
            <meta attribute="description">The external system reference of this location</meta>
        </property>

        <property name="externalDesc" type="string" column="EXTERNALDESC" length="254">
            <meta attribute="description">The External System Description</meta>
        </property>

        <many-to-one name="shiftChangeGroup" class="minestar.assignment.domain.AssGroupReference" column="SHIFTCHANGEGROUP">
            <meta attribute="description">The Shift Change group that this destination belongs to.</meta>
        </many-to-one>

        <!-- associations -->

        <set name="materials" table="LOCATION_MATERIAL" fetch="select" batch-size="100">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <meta attribute="description">All of the materials that are found at this Location.</meta>
            <meta attribute="view-reference">minestar.machinetracking.domain.MaterialImpl</meta>

            <key column="OID" not-null="true"/>
            <many-to-many class="minestar.machinetracking.domain.MaterialReference" column="MATERIAL_OID"/>
        </set>

        <set name="boundingBeacons" table="LOCATION_WAYPOINT" fetch="select" batch-size="100">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>
            <meta attribute="description">
                A list of all waypoints which, when entered, cause a change in to or out of this location.
            </meta>
            <meta attribute="view-reference">minestar.mine.domain.minemodel.WaypointImpl</meta>

            <cache usage="read-write" region="model"/>

            <key column="OID" not-null="true"/>
            <many-to-many class="minestar.mine.domain.minemodel.WaypointReference" column="WAYPOINT_OID" />
        </set>

        <set name="childLocations" table="LOCATION_CHILD_LOCATION" fetch="select" batch-size="100">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <meta attribute="description">A list of all locations which are considered part of this location.</meta>
            <meta attribute="view-reference">minestar.mine.domain.minemodel.LocationImpl</meta>

            <cache usage="read-write" region="model"/>

            <key column="OID" not-null="true"/>
            <many-to-many class="minestar.mine.domain.minemodel.LocationReference" column="LOCATION_OID" not-found="ignore" />
        </set>

        <property name="layerUpdateVersion" type="long" column="LAYER_UPDATE_VERSION" not-null="true">
            <meta attribute="description">The layer update version when the waypoint was created/modified.</meta>
        </property>

    </class>

    <!-- A lightweight reference to a Location -->
    <class name="minestar.mine.domain.minemodel.LocationReference" table="LOCATION" mutable="false" lazy="false">

        <meta attribute="alias" inherit="false">LOCATION_REFERENCE</meta>
        <meta attribute="description">A minimal reference to a location.</meta>
        <meta attribute="view-create-order">1</meta>

        <cache usage="read-only" region="model"/>

        <id name="OID" type="long" column="LOCATION_OID"/>
        <property name="name" type="string" column="NAME" length="254" not-null="true"/>
    </class>

</hibernate-mapping>
