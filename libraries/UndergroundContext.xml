<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (c) 2022 Caterpillar -->

<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="http://www.springframework.org/schema/beans"
       xmlns:condbean="http://www.minestar.au.cat.com/springbeans/condbean"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.minestar.au.cat.com/springbeans/condbean http://www.minestar.au.cat.com/springbeans/condbean/condbeans.xsd
       ">

    <bean id="undergroundCapability" class="com.mincom.util.permission.license.UndergroundCapability"
          lazy-init="false" init-method="init"/>

    <condbean:cond privilege="Underground">
        <bean id="undergroundAuditLogger" class="minestar.auditing.consumption.AuditLoggerImpl"
              destroy-method="close">
            <constructor-arg index="0"
                             value="${minestar.production.application.underground.auditing.Config@auditFileLocation}"/>
            <constructor-arg index="1"
                             value="${minestar.production.application.underground.auditing.Config@auditFileDuration}"/>
            <constructor-arg index="2"
                             value="${minestar.production.application.underground.auditing.Config@auditFileStorage}"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="xmlExternalSystemAuditLogger" class="minestar.auditing.consumption.AuditLoggerImpl"
              destroy-method="close">
            <constructor-arg index="0"
                             value="${minestar.production.application.underground.auditing.externalsystem.Config@auditFileLocation}"/>
            <constructor-arg index="1"
                             value="${minestar.production.application.underground.auditing.externalsystem.Config@auditFileDuration}"/>
            <constructor-arg index="2"
                             value="${minestar.production.application.underground.auditing.externalsystem.Config@auditFileStorage}"/>
        </bean>
    </condbean:cond>

    <!--
        Logs to both the main audit log and the underground-specific audit log.
      -->
    <condbean:cond privilege="Underground">
        <bean id="undergroundAuditLoggerWrapper" class="minestar.auditing.consumption.MultipleAuditLoggerImpl">
            <property name="auditLoggers">
                <list>
                    <ref bean="auditLogger"/>
                    <ref bean="undergroundAuditLogger"/>
                    <ref bean="xmlExternalSystemAuditLogger"/>
                </list>
            </property>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="futureEventPublisher" class="minestar.production.application.underground.FutureEventPublisher">
            <property name="notification" ref="notification"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundLayoutDeletionComponent"
              class="minestar.mine.service.minemodel.UndergroundLayoutDeletionComponent">
            <property name="drawCardAssignmentService" ref="drawCardAssignmentServiceImpl"/>
            <property name="drawCardManagementService" ref="drawCardManagementServiceImpl"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="undergroundStatusTimelineService" ref="undergroundStatusTimelineServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundLayoutArchivalComponent"
              class="minestar.mine.service.minemodel.UndergroundLayoutArchivalComponent">
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundLayoutRetrievalServiceImpl"
              class="minestar.mine.service.minemodel.UndergroundLayoutRetrievalServiceImpl"
              lazy-init="true">
            <property name="areaMapDao" ref="areaMapDao"/>
            <property name="drawPointDao" ref="drawPointDao"/>
            <property name="dumpGoalDao" ref="dumpGoalDao"/>
            <property name="loadGoalDao" ref="loadGoalDao"/>
            <property name="inversionGoalDao" ref="inversionGoalDao"/>
            <property name="orePassDao" ref="orePassDao"/>
            <property name="undergroundAreaDao" ref="undergroundAreaDao"/>
            <property name="joinedUndergroundAreaDao" ref="joinedUndergroundAreaDao"/>
            <property name="drawPointStatusDao" ref="drawPointStatusDao"/>
            <property name="operatingStatusDao" ref="operatingStatusDao"/>
            <property name="positionOfInterestDao" ref="positionOfInterestDao"/>
            <property name="drawPointConditionBuilder" ref="drawPointConditionBuilder"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundLayoutRetrievalService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Layout Retrieval Service"/>
            <constructor-arg value="minestar.mine.service.minemodel.UndergroundLayoutRetrievalService"/>
            <constructor-arg ref="undergroundLayoutRetrievalServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundLayoutServiceImpl"
              class="minestar.mine.service.minemodel.UndergroundLayoutServiceImpl"
              lazy-init="true">
            <property name="areaMapDao" ref="areaMapDao"/>
            <property name="drawPointDao" ref="drawPointDao"/>
            <property name="dumpGoalDao" ref="dumpGoalDao"/>
            <property name="loadGoalDao" ref="loadGoalDao"/>
            <property name="inversionGoalDao" ref="inversionGoalDao"/>
            <property name="macroDao" ref="macroDao"/>
            <property name="orePassDao" ref="orePassDao"/>
            <property name="undergroundAreaDao" ref="undergroundAreaDao"/>
            <property name="joinedUndergroundAreaDao" ref="joinedUndergroundAreaDao"/>
            <property name="drawPointStatusDao" ref="drawPointStatusDao"/>
            <property name="operatingStatusDao" ref="operatingStatusDao"/>
            <property name="positionOfInterestDao" ref="positionOfInterestDao"/>
            <property name="pinDao" ref="pinDao"/>
            <property name="signDao" ref="signDao"/>
            <property name="notification" ref="notification"/>
            <property name="hibernateEventListener" ref="hibernateEventListener"/>
            <property name="drawCardConfig" ref="drawCardConfig"/>
            <property name="deletionComponent" ref="undergroundLayoutDeletionComponent"/>
            <property name="archivalComponent" ref="undergroundLayoutArchivalComponent"/>
            <property name="orePassAssociator" ref="orePassAssociator"/>
            <property name="drawPointConditionBuilder" ref="drawPointConditionBuilder"/>
            <property name="drawCardAssignmentService" ref="drawCardAssignmentServiceImpl"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
            <property name="sensorService" ref="sensorServiceImpl"/>
            <property name="undergroundLayoutRetrievalService" ref="undergroundLayoutRetrievalServiceImpl"/>
            <property name="undergroundMachineService" ref="undergroundMachineServiceImpl"/>
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
            <property name="auditLogger" ref="undergroundAuditLoggerWrapper"/>
            <property name="undergroundAutomaticDelayTypeCache" ref="undergroundAutomaticDelayTypeCacheImpl"/>
            <property name="delayManagementService" ref="delayManagementServiceImpl"/>
            <property name="undergroundAssignmentService" ref="undergroundAssignmentServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundLayoutService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Layout Service"/>
            <constructor-arg value="minestar.mine.service.minemodel.UndergroundLayoutService"/>
            <constructor-arg ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundAlarmRecordServiceImpl"
              class="minestar.mine.service.minemodel.UndergroundAlarmRecordServiceImpl"
              lazy-init="true">
            <property name="undergroundAlarmRecordDao" ref="undergroundAlarmRecordDao"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundAlarmRecordService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Alarm Record Service"/>
            <constructor-arg value="minestar.mine.service.minemodel.UndergroundAlarmRecordService"/>
            <constructor-arg ref="undergroundAlarmRecordServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundMachineServiceImpl"
              class="minestar.production.service.underground.machine.UndergroundMachineServiceImpl"
              lazy-init="true">
            <property name="chuteLevelUpdater" ref="chuteLevelUpdater"/>
            <property name="dailyServiceScheduler" ref="dailyServiceScheduler"/>
            <property name="drawCardAlarmer" ref="drawCardAlarmer"/>
            <property name="undergroundMachineLostTracker" ref="undergroundMachineLostTracker"/>
            <property name="undergroundMachineStartupConfigurator" ref="undergroundMachineStartupConfigurator"/>
            <property name="undergroundOperationModeTracker" ref="undergroundOperationModeTracker"/>
            <property name="undergroundSensorHealthTracker" ref="undergroundSensorHealthTracker"/>
            <property name="undergroundOperationModeStatusCalculator" ref="undergroundOperationModeStatusCalculator"/>
            <property name="undergroundChuteDao" ref="undergroundChuteDao"/>
            <property name="undergroundRockBreakerDao" ref="undergroundRockBreakerDao"/>
            <property name="rockBreakerOverrideDao" ref="rockBreakerOverrideDao"/>
            <property name="undergroundEntryDao" ref="undergroundEntryDao"/>
            <property name="machineLostRecordDao" ref="machineLostRecordDao"/>
            <property name="activeDailyServiceScheduleDao" ref="activeDailyServiceScheduleDao"/>
            <property name="historicalDailyServiceScheduleDao" ref="historicalDailyServiceScheduleDao"/>
            <property name="historicalChuteDataDao" ref="historicalChuteDataDao"/>
            <property name="historicalChuteOverrideDao" ref="historicalChuteOverrideDao"/>
            <property name="chuteHazardStatusDao" ref="chuteHazardStatusDao"/>
            <property name="undergroundOperationModeChangeRecordDao" ref="undergroundOperationModeChangeRecordDao"/>
            <property name="notification" ref="notification"/>
            <property name="mineMessageService" ref="mineMessageServiceImpl"/>
            <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="delayManagementService" ref="delayManagementServiceImpl"/>
            <property name="drawCardAssignmentRetrievalService" ref="drawCardAssignmentRetrievalServiceImpl"/>
            <property name="sensorService" ref="sensorServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="dimensionManagementService" ref="dimensionManagementServiceImpl"/>
            <property name="undergroundRFRNodeHealthTracker" ref="undergroundRFRNodeHealthTracker"/>
            <property name="undergroundAssignmentService" ref="undergroundAssignmentServiceImpl"/>
            <property name="deletionComponent" ref="undergroundLayoutDeletionComponent"/>
            <property name="standardMessageLoader" ref="standardMessageLoader"/>
            <property name="undergroundAutomaticDelayTypeCache" ref="undergroundAutomaticDelayTypeCacheImpl"/>
            <property name="machineAtAreaCache" ref="machineAtAreaCache"/>
            <property name="machineAtZoneCache" ref="machineAtZoneCache"/>
            <property name="userService" ref="userServiceImpl"/>
            <property name="futureEventPublisher" ref="futureEventPublisher"/>
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="hibernateEventListener" ref="hibernateEventListener"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundMachineService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Machine Service"/>
            <constructor-arg value="minestar.production.service.underground.machine.UndergroundMachineService"/>
            <constructor-arg ref="undergroundMachineServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardAssignmentRetrievalServiceImpl"
              class="minestar.production.service.drawcard.DrawCardAssignmentRetrievalServiceImpl"
              lazy-init="true">
            <property name="undergroundAssignmentEngineConfig" ref="undergroundAssignmentEngineConfig"/>
            <property name="drawCardAssignmentDao" ref="drawCardAssignmentDao"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="hibernateEventListener" ref="hibernateEventListener"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerDrawCardAssignmentRetrievalService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Draw Card Assignment Retrieval Service"/>
            <constructor-arg value="minestar.production.service.drawcard.DrawCardAssignmentRetrievalService"/>
            <constructor-arg ref="drawCardAssignmentRetrievalServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardAssignmentServiceImpl"
              class="minestar.production.service.drawcard.DrawCardAssignmentServiceImpl"
              lazy-init="true">
            <property name="drawCardAssignmentDao" ref="drawCardAssignmentDao"/>
            <property name="auditLogger" ref="undergroundAuditLoggerWrapper"/>
            <property name="notification" ref="notification"/>
            <property name="undergroundShiftChangeConfig" ref="undergroundShiftChangeConfig"/>
            <property name="drawCardAssignmentRetrievalService" ref="drawCardAssignmentRetrievalServiceImpl"/>
            <property name="drawCardEventProcessorService" ref="drawCardEventProcessorServiceImpl"/>
            <property name="mineLayoutService" ref="mineLayoutServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="undergroundShiftChangeService" ref="undergroundShiftChangeServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerDrawCardAssignmentService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Draw Card Assignment Service"/>
            <constructor-arg value="minestar.production.service.drawcard.DrawCardAssignmentService"/>
            <constructor-arg ref="drawCardAssignmentServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardRetrievalServiceImpl"
              class="minestar.production.service.drawcard.DrawCardRetrievalServiceImpl"
              lazy-init="true">
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="drawCardDTOPopulator" ref="drawCardDTOPopulator"/>
            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerDrawCardRetrievalService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Draw Card Retrieval Service"/>
            <constructor-arg value="minestar.production.service.drawcard.DrawCardRetrievalService"/>
            <constructor-arg ref="drawCardRetrievalServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardManagementServiceImpl"
              class="minestar.production.service.drawcard.DrawCardManagementServiceImpl"
              lazy-init="true">
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="notification" ref="notification"/>
            <property name="futureDrawCardActivator" ref="futureDrawCardActivator"/>
            <property name="activeDrawCardImporter" ref="activeDrawCardImporter"/>
            <property name="futureDrawCardImporter" ref="futureDrawCardImporter"/>
            <property name="historicalDrawCardImporter" ref="historicalDrawCardImporter"/>
            <property name="undergroundAuditor" ref="undergroundAuditor"/>
            <property name="undergroundProductionDataArchiver" ref="undergroundProductionDataArchiver"/>
            <property name="drawCardRejigger" ref="drawCardRejigger"/>
            <property name="drawCardImportChecker" ref="drawCardImportChecker"/>
            <property name="drawCardEventProcessorService" ref="drawCardEventProcessorServiceImpl"/>
            <property name="drawCardRetrievalService" ref="drawCardRetrievalServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerDrawCardManagementService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Draw Card Management Service"/>
            <constructor-arg value="minestar.production.service.drawcard.DrawCardManagementService"/>
            <constructor-arg ref="drawCardManagementServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardEventProcessorServiceImpl"
              class="minestar.production.service.drawcard.DrawCardEventProcessorServiceImpl"
              lazy-init="true">
            <property name="newCycleDrawCardUpdater" ref="newCycleDrawCardUpdater"/>
            <property name="changedCycleDrawCardUpdater" ref="changedCycleDrawCardUpdater"/>
            <property name="assignedAreaRequestResponder" ref="assignedAreaRequestResponder"/>
            <property name="drawCardRequestResponder" ref="drawCardRequestResponder"/>
            <property name="drawCardStartupHandler" ref="drawCardStartupHandler"/>
            <property name="operatingStatusUpdateHandler" ref="operatingStatusUpdateHandler"/>
            <property name="drawCardMessageSender" ref="drawCardMessageSender"/>
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
            <property name="chuteLevelUpdater" ref="chuteLevelUpdater"/>
            <property name="transferLevelUpdater" ref="transferLevelUpdater"/>
            <property name="undergroundChuteMessagingHandler" ref="undergroundChuteMessagingHandler"/>
            <property name="undergroundMachineService" ref="undergroundMachineServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="cycleService" ref="cycleServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="processorDumpedAmountUpdater" ref="processorDumpedAmountUpdater"/>
            <property name="notification" ref="notification"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="drawCardRecalculator" ref="drawCardRecalculator"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerDrawCardEventProcessorService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Draw Card Event Processor Service"/>
            <constructor-arg value="minestar.production.service.drawcard.DrawCardEventProcessorService"/>
            <constructor-arg ref="drawCardEventProcessorServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="undergroundReportingServiceImpl"
              class="minestar.production.service.underground.reporting.UndergroundReportingServiceImpl"
              lazy-init="true">
            <property name="undergroundReportExporter" ref="undergroundReportExporter"/>
            <property name="productionSummaryByDrawPointReportGenerator"
                      ref="productionSummaryByDrawPointReportGenerator"/>
            <property name="productionSummaryByPanelReportGenerator" ref="productionSummaryByPanelReportGenerator"/>
            <property name="lhdProductionDetailReportGenerator" ref="lhdProductionDetailReportGenerator"/>
            <property name="equipmentPerformanceReportGenerator" ref="equipmentPerformanceReportGenerator"/>
            <property name="equipmentStatusSummaryReportGenerator" ref="equipmentStatusSummaryReportGenerator"/>
            <property name="shiftPerformanceReportGenerator" ref="shiftPerformanceReportGenerator"/>
            <property name="drawPointAvailabilityReportGenerator" ref="drawPointAvailabilityReportGenerator"/>
            <property name="equipmentCycleTimeReportGenerator" ref="equipmentCycleTimeReportGenerator"/>
            <property name="dailyServiceScheduleComplianceReportGenerator"
                      ref="dailyServiceScheduleComplianceReportGenerator"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="registerUndergroundReportingService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Reporting Service"/>
            <constructor-arg value="minestar.production.service.underground.reporting.UndergroundReportingService"/>
            <constructor-arg ref="undergroundReportingServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundShiftChangeServiceImpl"
              class="minestar.production.service.underground.shiftchange.UndergroundShiftChangeServiceImpl"
              lazy-init="true">
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="shiftChangeService" ref="shiftChangeServiceImpl"/>
            <property name="personnelService" ref="personnelServiceImpl"/>
            <property name="undergroundMachineService" ref="undergroundMachineServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="undergroundShiftHelper" ref="undergroundShiftHelper"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundShiftChangeService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Shift Change Service"/>
            <constructor-arg value="minestar.production.service.underground.shiftchange.UndergroundShiftChangeService"/>
            <constructor-arg ref="undergroundShiftChangeServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundStatusTimelineServiceImpl"
              class="minestar.mine.service.minemodel.UndergroundStatusTimelineServiceImpl"
              lazy-init="true">
            <property name="drawPointTimeLineRecordDao" ref="drawPointTimeLineRecordDao"/>
            <property name="orePassTimeLineRecordDao" ref="orePassTimeLineRecordDao"/>
            <property name="chuteTimeLineRecordDao" ref="chuteTimeLineRecordDao"/>
            <property name="undergroundAreaTimeLineRecordDao" ref="undergroundAreaTimeLineRecordDao"/>
            <property name="drawPointStatusCalculator" ref="drawPointStatusCalculator"/>
            <property name="orePassStatusCalculator" ref="orePassStatusCalculator"/>
            <property name="areaStatusCalculator" ref="areaStatusCalculator"/>
            <property name="notification" ref="notification"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundStatusTimelineService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Status Timeline Service"/>
            <constructor-arg value="minestar.mine.service.minemodel.UndergroundStatusTimelineService"/>
            <constructor-arg ref="undergroundStatusTimelineServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardConfig" class="minestar.production.application.drawcard.DrawCardConfig"
              lazy-init="true"/>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawPointConditionBuilder" class="minestar.production.application.drawpoint.DrawPointConditionBuilder"
              lazy-init="true">
            <property name="drawCardConfig" ref="drawCardConfig"/>
            <property name="drawPointDao" ref="drawPointDao"/>
            <property name="drawPointStatusDao" ref="drawPointStatusDao"/>
            <property name="undergroundAreaDao" ref="undergroundAreaDao"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawPointSortIndexCalculator"
              class="minestar.production.application.drawcard.DrawPointSortIndexCalculator"
              lazy-init="true">
            <property name="undergroundNameParser" ref="undergroundNameParser"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardPeriodHelper" class="minestar.production.application.drawcard.util.DrawCardPeriodHelper"
              lazy-init="true">
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardRejigger" class="minestar.production.application.drawcard.DrawCardRejigger"
              lazy-init="true">
            <property name="drawCardBuilderFactory" ref="drawCardBuilderFactory"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardAlarmer" class="minestar.production.service.drawcard.DrawCardAlarmer"
              lazy-init="true">
            <property name="alarmService" ref="alarmServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="undergroundAlarmRecordService" ref="undergroundAlarmRecordServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundCycleHelper" class="minestar.production.application.drawcard.util.UndergroundCycleHelper"
              lazy-init="true">
            <property name="cycleService" ref="cycleServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundLayoutConfig"
              class="minestar.mine.application.minemodel.underground.UndergroundLayoutConfig"
              lazy-init="true"/>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundShiftChangeConfig"
              class="com.mincom.works.shiftchange.underground.UndergroundShiftChangeConfig"
              lazy-init="true"/>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundShiftHelper"
              class="minestar.production.application.underground.util.UndergroundShiftHelper"
              lazy-init="true">
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="drawCardConfig" ref="drawCardConfig"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawPointStatusCalculator"
              class="minestar.mine.application.minemodel.underground.DrawPointStatusCalculator"
              lazy-init="true">
            <property name="drawPointTimeLineRecordDao" ref="drawPointTimeLineRecordDao"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="orePassStatusCalculator"
              class="minestar.mine.application.minemodel.underground.OrePassStatusCalculator"
              lazy-init="true">
            <property name="orePassTimeLineRecordDao" ref="orePassTimeLineRecordDao"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="areaStatusCalculator" class="minestar.mine.application.minemodel.underground.AreaStatusCalculator"
              lazy-init="true">
            <property name="areaTimeLineRecordDao" ref="undergroundAreaTimeLineRecordDao"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundAuditor"
              class="minestar.production.application.underground.UndergroundAuditor"
              lazy-init="true">
            <property name="auditLogger" ref="undergroundAuditLoggerWrapper"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardBuilderFactory"
              class="minestar.production.application.drawcard.DrawCardBuilderFactory"
              lazy-init="true">
            <property name="drawCardAlarmer" ref="drawCardAlarmer"/>
            <property name="drawPointSortIndexCalculator" ref="drawPointSortIndexCalculator"/>

            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardPersistentStore"
              class="minestar.production.application.drawcard.DrawCardPersistentStoreImpl"
              lazy-init="true">
            <property name="notification" ref="notification"/>
            <property name="txManager" ref="minestarTransactionManager"/>

            <property name="activeDrawCardDao" ref="activeDrawCardDao"/>
            <property name="activeDrawCardEntryListDao" ref="activeDrawCardEntryListDao"/>
            <property name="activeDrawCardEntryDao" ref="activeDrawCardEntryDao"/>

            <property name="historicalDrawCardDao" ref="historicalDrawCardDao"/>
            <property name="historicalDrawCardEntryListDao" ref="historicalDrawCardEntryListDao"/>
            <property name="historicalDrawCardEntryDao" ref="historicalDrawCardEntryDao"/>

            <property name="futureDrawCardDao" ref="futureDrawCardDao"/>
            <property name="futureDrawCardEntryDao" ref="futureDrawCardEntryDao"/>
            <property name="futureDrawCardEntryListDao" ref="futureDrawCardEntryListDao"/>

            <property name="activeOrePassDataDao" ref="activeOrePassDataDao"/>
            <property name="historicalOrePassDataDao" ref="historicalOrePassDataDao"/>
            <property name="historicalOrePassDataEntryDao" ref="historicalOrePassDataEntryDao"/>

            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="drawCardBuilderFactory" ref="drawCardBuilderFactory"/>

            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardRecalculator"
              class="minestar.production.application.drawcard.DrawCardRecalculator"
              lazy-init="true">
            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="undergroundStatusTimelineService" ref="undergroundStatusTimelineServiceImpl"/>
            <property name="drawCardEventProcessorService" ref="drawCardEventProcessorServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundProductionDataArchiver"
              class="minestar.production.application.underground.UndergroundProductionDataArchiver"
              lazy-init="true">
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="historicalChuteDataDao" ref="historicalChuteDataDao"/>
            <property name="historicalProcessorDataDao" ref="historicalProcessorDataDao"/>
            <property name="chuteLevelUpdater" ref="chuteLevelUpdater"/>
            <property name="drawCardBuilderFactory" ref="drawCardBuilderFactory"/>
            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="undergroundAuditor" ref="undergroundAuditor"/>
            <property name="undergroundShiftHelper" ref="undergroundShiftHelper"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="futureDrawCardActivator" class="minestar.production.application.drawcard.FutureDrawCardActivator"
              lazy-init="true">
            <property name="drawCardConfig" ref="drawCardConfig"/>
            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="drawCardBuilderFactory" ref="drawCardBuilderFactory"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="drawCardRecalculator" ref="drawCardRecalculator"/>
            <property name="undergroundAuditor" ref="undergroundAuditor"/>
            <property name="undergroundProductionDataArchiver" ref="undergroundProductionDataArchiver"/>
            <property name="alarmService" ref="alarmServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="materialManagementService" ref="materialManagementService"/>
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardImportChecker" class="minestar.production.application.drawcard.DrawCardImportChecker"
              lazy-init="true">
            <property name="drawCardConfig" ref="drawCardConfig"/>
            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="undergroundShiftHelper" ref="undergroundShiftHelper"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="abstractDrawCardImporter" abstract="true">
            <property name="drawCardConfig" ref="drawCardConfig"/>
            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="drawCardBuilderFactory" ref="drawCardBuilderFactory"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="drawPointConditionBuilder" ref="drawPointConditionBuilder"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="activeDrawCardImporter" class="minestar.production.application.drawcard.ActiveDrawCardImporter"
              lazy-init="true" parent="abstractDrawCardImporter">
            <property name="drawCardRecalculator" ref="drawCardRecalculator"/>
            <property name="undergroundProductionDataArchiver" ref="undergroundProductionDataArchiver"/>
            <property name="drawCardEventProcessorService" ref="drawCardEventProcessorServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="futureDrawCardImporter" class="minestar.production.application.drawcard.FutureDrawCardImporter"
              lazy-init="true" parent="abstractDrawCardImporter"/>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="historicalDrawCardImporter"
              class="minestar.production.application.drawcard.HistoricalDrawCardImporter"
              lazy-init="true" parent="abstractDrawCardImporter">
            <property name="drawCardRecalculator" ref="drawCardRecalculator"/>
            <property name="undergroundStatusTimelineService" ref="undergroundStatusTimelineServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundNameParser"
              class="minestar.production.application.drawcard.UndergroundNameParser"
              lazy-init="true">
            <property name="drawCardConfig" ref="drawCardConfig"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardDTOPopulator"
              class="minestar.production.application.drawcard.DrawCardDTOPopulator"
              lazy-init="true">
            <property name="undergroundShiftHelper" ref="undergroundShiftHelper"/>
            <property name="undergroundNameParser" ref="undergroundNameParser"/>
            <property name="drawCardAssignmentRetrievalService" ref="drawCardAssignmentRetrievalServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="newCycleDrawCardUpdater"
              class="minestar.production.application.drawcard.NewCycleDrawCardUpdater"
              lazy-init="true">
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="drawCardMessageSender" ref="drawCardMessageSender"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="changedCycleDrawCardUpdater"
              class="minestar.production.application.drawcard.ChangedCycleDrawCardUpdater"
              lazy-init="true">
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="chuteLevelUpdater"
              class="minestar.production.application.chute.ChuteLevelUpdater"
              lazy-init="true">
            <property name="notification" ref="notification"/>
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="historicalChuteOverrideDao" ref="historicalChuteOverrideDao"/>
            <property name="undergroundChuteDao" ref="undergroundChuteDao"/>
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="transferLevelUpdater"
              class="minestar.production.application.underground.transferlevel.TransferLevelUpdater"
              lazy-init="true">
            <property name="notification" ref="notification"/>
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="processorDumpedAmountUpdater"
              class="minestar.production.application.processor.ProcessorDumpedAmountUpdater"
              lazy-init="true">
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="dailyServiceScheduler"
              class="minestar.production.application.underground.scheduling.DailyServiceSchedulerImpl"
              lazy-init="true">
            <property name="standardMessageLoader" ref="standardMessageLoader"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="mineMessageService" ref="mineMessageServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardMessageBuilder"
              class="minestar.production.application.underground.messaging.DrawCardMessageBuilder"
              lazy-init="true">
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardMessageSender"
              class="minestar.production.application.underground.messaging.DrawCardMessageSender"
              lazy-init="true">
            <property name="messageBuilder" ref="drawCardMessageBuilder"/>
            <property name="drawCardAssignmentRetrievalService" ref="drawCardAssignmentRetrievalServiceImpl"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="drawPointSortIndexCalculator" ref="drawPointSortIndexCalculator"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="assignedAreaRequestResponder"
              class="minestar.production.application.underground.messaging.AssignedAreaRequestResponder"
              lazy-init="true">
            <property name="messageBuilder" ref="drawCardMessageBuilder"/>
            <property name="drawCardAssignmentRetrievalService" ref="drawCardAssignmentRetrievalServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardRequestResponder"
              class="minestar.production.application.underground.messaging.DrawCardRequestResponder"
              lazy-init="true">
            <property name="messageBuilder" ref="drawCardMessageBuilder"/>
            <property name="drawCardPersistentStore" ref="drawCardPersistentStore"/>
            <property name="drawCardAssignmentService" ref="drawCardAssignmentServiceImpl"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="drawCardStartupHandler"
              class="minestar.production.application.underground.messaging.DrawCardStartupHandler"
              lazy-init="true">
            <property name="messageSender" ref="drawCardMessageSender"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="operatingStatusUpdateHandler"
              class="minestar.production.application.underground.messaging.OperatingStatusUpdateHandler"
              lazy-init="true">
            <property name="alarmService" ref="alarmServiceImpl"/>
            <property name="drawCardMessageSender" ref="drawCardMessageSender"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="undergroundNameParser" ref="undergroundNameParser"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="standardMessageLoader"
              class="minestar.pitlink.application.StandardMessageLoader"
              lazy-init="true">
            <property name="mineMessageService" ref="mineMessageServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundChuteMessagingHandler"
              class="minestar.pitlink.application.underground.messaging.UndergroundChuteMessagingHandler"
              lazy-init="true">
            <property name="notification" ref="notification"/>
            <property name="delayManagementService" ref="delayManagementServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="undergroundMachineService" ref="undergroundMachineServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundChuteEventPublisher"
              class="minestar.production.application.chute.UndergroundChuteEventPublisher"
              lazy-init="false">
            <!--
            Not lazily initialized because no other bean will need to refer to it. It's a standalone bean that
            listens to MineStar change events, and reacts accordingly.
              -->
            <property name="notification" ref="notification"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundMachineLostTracker"
              class="minestar.pitlink.application.underground.messaging.UndergroundMachineLostTracker"
              lazy-init="true" init-method="init">
            <property name="machineLostRecordDao" ref="machineLostRecordDao"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundMachineStartupConfigurator"
              class="minestar.pitlink.application.underground.messaging.UndergroundMachineStartupConfigurator"
              lazy-init="true">
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="sensorService" ref="sensorServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundOperationModeTracker"
              class="minestar.pitlink.application.underground.messaging.UndergroundOperationModeTracker"
              lazy-init="true">
            <property name="undergroundOperationModeChangeRecordDao" ref="undergroundOperationModeChangeRecordDao"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="sensorService" ref="sensorServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundSensorHealthTracker"
              class="minestar.pitlink.application.underground.messaging.UndergroundSensorHealthTracker"
              lazy-init="true">
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="sensorService" ref="sensorServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundRFRNodeHealthTracker"
              class="minestar.pitlink.application.underground.messaging.UndergroundRFRNodeHealthTracker"
              lazy-init="true">
            <property name="sensorService" ref="sensorServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundOperationModeStatusCalculator"
              class="minestar.pitlink.application.underground.UndergroundOperationModeStatusCalculator"
              lazy-init="true">
            <property name="undergroundOperationModeChangeRecordDao" ref="undergroundOperationModeChangeRecordDao"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="orePassAssociator"
              class="minestar.mine.application.minemodel.underground.OrePassAssociator"
              lazy-init="true">
            <property name="orePassDao" ref="orePassDao"/>
            <property name="pitModelService" ref="pitModelServiceImpl"/>
            <property name="undergroundMachineService" ref="undergroundMachineServiceImpl"/>
        </bean>
    </condbean:cond>

    <!-- *NOT* a singleton. Each class that uses a UndergroundFieldMessageListener must have its own instance. -->
    <condbean:cond privilege="Underground">
        <bean id="undergroundFieldMessageListener"
              class="minestar.pitlink.application.underground.messaging.UndergroundFieldMessageListener"
              scope="prototype">
            <property name="notification" ref="notification"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>

    <!-- *NOT* a singleton. Each class that uses a QueuedFieldMessageSender must have its own instance. -->
    <condbean:cond privilege="Underground">
        <bean id="queuedFieldMessageSender"
              class="minestar.pitlink.application.underground.messaging.QueuedFieldMessageSender"
              scope="prototype">
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="notification" ref="notification"/>
        </bean>
    </condbean:cond>

    <bean id="areaMapDao" class="minestar.mine.persistence.minemodel.AreaMapDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        <property name="undergroundAreaDao" ref="undergroundAreaDao"/>
    </bean>
    <bean id="orePassDao" class="minestar.mine.persistence.minemodel.OrePassDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        <property name="dumpGoalDao" ref="dumpGoalDao"/>
    </bean>
    <bean id="drawPointDao" class="minestar.mine.persistence.minemodel.DrawPointDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        <property name="loadGoalDao" ref="loadGoalDao"/>
    </bean>
    <bean id="dumpGoalDao" class="minestar.mine.persistence.minemodel.DumpGoalDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>
    <bean id="loadGoalDao" class="minestar.mine.persistence.minemodel.LoadGoalDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>
    <bean id="inversionGoalDao" class="minestar.mine.persistence.minemodel.InversionGoalDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>
    <bean id="macroDao" class="minestar.mine.persistence.minemodel.MacroDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>
    <bean id="undergroundAreaDao" class="minestar.mine.persistence.minemodel.UndergroundAreaDaoImpl"
          parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        <property name="aimsAreaDao" ref="aimsAreaDao"/>
    </bean>
    <bean id="joinedUndergroundAreaDao" class="minestar.mine.persistence.minemodel.JoinedUndergroundAreaDaoImpl"
          parent="minestarDao"
          lazy-init="true">
        <property name="undergroundAreaDao" ref="undergroundAreaDao"/>
    </bean>
    <bean id="drawPointStatusDao" class="minestar.mine.persistence.minemodel.DrawPointStatusDaoImpl"
          parent="minestarDao" lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>
    <bean id="operatingStatusDao" class="minestar.mine.persistence.minemodel.OperatingStatusDaoImpl"
          parent="minestarDao" lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>
    <bean id="chuteHazardStatusDao" class="minestar.mine.persistence.minemodel.ChuteHazardStatusDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="activeDrawCardDao" class="minestar.production.persistence.drawcard.ActiveDrawCardDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="activeDrawCardEntryListDao"
          class="minestar.production.persistence.drawcard.ActiveDrawCardEntryListDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="futureDrawCardEntryListDao"
          class="minestar.production.persistence.drawcard.FutureDrawCardEntryListDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="activeDrawCardEntryDao" class="minestar.production.persistence.drawcard.ActiveDrawCardEntryDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalDrawCardEntryDao"
          class="minestar.production.persistence.drawcard.HistoricalDrawCardEntryDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalDrawCardEntryListDao"
          class="minestar.production.persistence.drawcard.HistoricalDrawCardEntryListDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalDrawCardDao" class="minestar.production.persistence.drawcard.HistoricalDrawCardDaoImpl"
          parent="minestarDao" lazy-init="true">
        <property name="historicalDrawCardEntryDao" ref="historicalDrawCardEntryDao"/>
    </bean>
    <bean id="futureDrawCardEntryDao" class="minestar.production.persistence.drawcard.FutureDrawCardEntryDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="futureDrawCardDao" class="minestar.production.persistence.drawcard.FutureDrawCardDaoImpl"
          parent="minestarDao" lazy-init="true">
        <property name="futureDrawCardEntryDao" ref="futureDrawCardEntryDao"/>
    </bean>
    <bean id="activeOrePassDataDao" class="minestar.production.persistence.orepass.ActiveOrePassDataDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalOrePassDataEntryDao"
          class="minestar.production.persistence.orepass.HistoricalOrePassDataEntryDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalOrePassDataDao" class="minestar.production.persistence.orepass.HistoricalOrePassDataDaoImpl"
          parent="minestarDao" lazy-init="true">
        <property name="historicalOrePassDataEntryDao" ref="historicalOrePassDataEntryDao"/>
    </bean>
    <bean id="historicalChuteDataDao"
          class="minestar.production.persistence.underground.chute.HistoricalChuteDataDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalChuteOverrideDao"
          class="minestar.production.persistence.underground.chute.HistoricalChuteOverrideDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalProcessorDataDao"
          class="minestar.production.persistence.underground.processor.HistoricalProcessorDataDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="drawPointTimeLineRecordDao"
          class="minestar.production.persistence.drawcard.DrawPointTimeLineRecordDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="orePassTimeLineRecordDao" class="minestar.production.persistence.orepass.OrePassTimeLineRecordDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="undergroundAreaTimeLineRecordDao"
          class="minestar.production.persistence.underground.area.UndergroundAreaTimeLineRecordDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="drawCardAssignmentDao" class="minestar.production.persistence.drawcard.DrawCardAssignmentDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="undergroundAlarmRecordDao" class="minestar.production.persistence.drawcard.UndergroundAlarmRecordDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="machineLostRecordDao" class="minestar.production.persistence.underground.machine.MachineLostRecordDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="undergroundOperationModeChangeRecordDao"
          class="minestar.production.persistence.underground.machine.UndergroundOperationModeChangeRecordDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="activeDailyServiceScheduleDao"
          class="minestar.production.persistence.underground.schedule.ActiveDailyServiceScheduleDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="historicalDailyServiceScheduleDao"
          class="minestar.production.persistence.underground.schedule.HistoricalDailyServiceScheduleDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="undergroundChuteDao"
          class="minestar.production.persistence.underground.chute.UndergroundChuteDaoImpl"
          parent="minestarDao" lazy-init="true"/>
    <bean id="chuteTimeLineRecordDao"
          class="minestar.production.persistence.underground.chute.ChuteTimeLineRecordDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="undergroundRockBreakerDao"
          class="minestar.production.persistence.underground.rockbreaker.UndergroundRockBreakerDaoImpl"
          parent="minestarDao" lazy-init="true">
        <property name="machineDao" ref="machineDao"/>
    </bean>
    <bean id="rockBreakerOverrideDao"
          class="minestar.production.persistence.underground.rockbreaker.RockBreakerOverrideDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="positionOfInterestDao"
          class="minestar.production.persistence.underground.PositionOfInterestDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="loadingBayDao"
          class="minestar.production.persistence.underground.machine.LoadingBayDaoImpl"
          parent="minestarDao" lazy-init="true"/>

    <bean id="pinDao" class="minestar.mine.persistence.minemodel.PinDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>

    <bean id="signDao" class="minestar.mine.persistence.minemodel.SignDaoImpl" parent="minestarDao"
          lazy-init="true">
        <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
    </bean>


    <condbean:cond privilege="Underground">
        <bean id="configStoreDao"
              class="minestar.mine.persistence.minemodel.ConfigStoreDaoImpl">
            <property name="notification" ref="notification"/>
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        </bean>
    </condbean:cond>
    <condbean:cond privilege="Underground">
        <bean id="configStoreMetaDataDao"
              class="minestar.mine.persistence.minemodel.ConfigStoreMetaDataDaoImpl">
            <property name="notification" ref="notification"/>
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        </bean>
    </condbean:cond>
    <condbean:cond privilege="Underground">
        <bean id="abstractDisplayableNotification"
              abstract="true" init-method="init" destroy-method="cleanUp">
            <property name="notification" ref="notification"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundAreaNotification"
              class="minestar.mine.service.minemodel.UndergroundAreaNotification"
              lazy-init="true"
              parent="abstractDisplayableNotification">
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="displayableDrawPointNotification"
              class="minestar.mine.service.minemodel.DisplayableDrawPointNotification"
              lazy-init="true"
              parent="abstractDisplayableNotification">
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="undergroundReportExporter"
              class="minestar.production.application.underground.reporting.UndergroundReportExporter"
              lazy-init="true"/>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="productionSummaryByDrawPointReportGenerator"
              class="minestar.production.application.underground.reporting.ProductionSummaryByDrawPointReportGenerator"
              lazy-init="true">
            <property name="drawCardPeriodHelper" ref="drawCardPeriodHelper"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="drawCardRetrievalService" ref="drawCardRetrievalServiceImpl"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="productionSummaryByPanelReportGenerator"
              class="minestar.production.application.underground.reporting.ProductionSummaryByPanelReportGenerator"
              lazy-init="true">
            <property name="drawPointReportGenerator" ref="productionSummaryByDrawPointReportGenerator"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="drawCardRetrievalService" ref="drawCardRetrievalServiceImpl"/>
            <property name="materialManagementService" ref="materialManagementServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="lhdProductionDetailReportGenerator"
              class="minestar.production.application.underground.reporting.LHDProductionDetailReportGenerator"
              lazy-init="true">
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="equipmentPerformanceReportGenerator"
              class="minestar.production.application.underground.reporting.EquipmentPerformanceReportGenerator"
              lazy-init="true">
            <property name="delayManagementService" ref="delayManagementServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="drawPointAvailabilityReportGenerator"
              class="minestar.production.application.underground.reporting.DrawPointAvailabilityReportGenerator"
              lazy-init="true">
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="undergroundStatusTimelineService" ref="undergroundStatusTimelineServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="equipmentStatusSummaryReportGenerator"
              class="minestar.production.application.underground.reporting.EquipmentStatusSummaryReportGenerator"
              lazy-init="true">
            <property name="delayManagementService" ref="delayManagementServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="shiftPerformanceReportGenerator"
              class="minestar.production.application.underground.reporting.ShiftPerformanceReportGenerator"
              lazy-init="true">
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
            <property name="fleetProductionService" ref="fleetProductionServiceImpl"/>
            <property name="equipmentPerformanceReportGenerator" ref="equipmentPerformanceReportGenerator"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="equipmentCycleTimeReportGenerator"
              class="minestar.production.application.underground.reporting.EquipmentCycleTimeReportGenerator"
              lazy-init="true">
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground Reporting">
        <bean id="dailyServiceScheduleComplianceReportGenerator"
              class="minestar.production.application.underground.reporting.DailyServiceScheduleComplianceReportGenerator"
              lazy-init="true">
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="shiftService" ref="shiftServiceImpl"/>
            <property name="undergroundCycleHelper" ref="undergroundCycleHelper"/>
            <property name="undergroundMachineService" ref="undergroundMachineServiceImpl"/>
        </bean>
    </condbean:cond>

    <bean id="undergroundDxfMapDao" class="minestar.mine.persistence.underground.map.UndergroundDxfMapDaoImpl"
          parent="minestarDao"
          lazy-init="true">
    </bean>

    <condbean:cond privilege="Underground">
        <bean name="undergroundMapServiceImpl"
              class="minestar.mine.service.underground.map.UndergroundMapServiceImpl"
              lazy-init="false">
            <property name="cleanupPeriodSeconds" value="3600"/><!-- 1 hour-->
            <property name="undergroundDxfMapDao" ref="undergroundDxfMapDao"/>
            <property name="geometryUtil" ref="geometryUtil"/>
            <property name="undergroundLayoutService" ref="undergroundLayoutServiceImpl"/>
            <property name="undergroundAssignmentService" ref="undergroundAssignmentServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
            <property name="undergroundMachinePolytopeService" ref="undergroundMachinePolytopeServiceImpl"/>
            <property name="navigationGraphManager" ref="navigationGraphManagerImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="notification" ref="notification"/>
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundMapService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground Map Service"/>
            <constructor-arg value="minestar.mine.service.underground.map.UndergroundMapService"/>
            <constructor-arg ref="undergroundMapServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="automaticDelayTypeBuilderFactory"
              class="minestar.production.application.AutomaticDelayTypeBuilderFactory"
              lazy-init="false">
            <property name="delayManagementService" ref="delayManagementServiceImpl"/>
            <property name="mineFleetService" ref="mineFleetServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="undergroundAutomaticDelayTypeCacheImpl"
              class="minestar.production.application.underground.UndergroundAutomaticDelayTypeCacheImpl"
              lazy-init="false">
            <property name="notification" ref="notification"/>
            <property name="automaticDelayTypeBuilderFactory" ref="automaticDelayTypeBuilderFactory"/>
            <property name="delayManagementService" ref="delayManagementServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUndergroundAutomaticDelayTypeCache" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="Underground AutomaticDelay Type Cache"/>
            <constructor-arg value="minestar.production.application.underground.UndergroundAutomaticDelayTypeCache"/>
            <constructor-arg ref="undergroundAutomaticDelayTypeCacheImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="eventLogHooks"
              class="minestar.production.application.underground.event.EventLogHooks"
              lazy-init="false"
              init-method="init"
              destroy-method="cleanUp">
            <property name="eventLogService" ref="eventLogServiceImpl"/>
            <property name="notification" ref="notification"/>
        </bean>
    </condbean:cond>


    <condbean:cond privilege="Underground">
        <bean id="metadataDao"
              class="minestar.mine.persistence.minemodel.metadata.MetadataDaoImpl" parent="minestarDao">
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        </bean>
    </condbean:cond>
    <condbean:cond privilege="Underground">
        <bean id="metadataSchemaDao"
              class="minestar.mine.persistence.minemodel.metadata.MetadataSchemaDaoImpl" parent="minestarDao">
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="metadataSchemaServiceImpl"
              class="minestar.mine.service.underground.metadata.MetadataSchemaServiceImpl"
              lazy-init="false">
            <property name="txManager" ref="minestarTransactionManager"/>
            <property name="metadataSchemaDao" ref="metadataSchemaDao"/>
            <property name="sequenceValueService" ref="sequenceValueServiceImpl" />
        </bean>
    </condbean:cond>
    <condbean:cond privilege="Underground">
        <bean id="registerMetadataSchemaService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="UG Meta Data Schema Service"/>
            <constructor-arg value="minestar.mine.service.underground.metadata.MetadataSchemaService"/>
            <constructor-arg ref="metadataSchemaServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="metadataServiceImpl"
              class="minestar.mine.service.underground.metadata.MetadataServiceImpl"
              lazy-init="false">
            <property name="metadataSchemaService" ref="metadataSchemaServiceImpl"/>
            <property name="metadataDao" ref="metadataDao"/>
            <property name="metadataSchemaDao" ref="metadataSchemaDao"/>
            <property name="notification" ref="notification"/>
            <property name="sequenceValueService" ref="sequenceValueServiceImpl"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>
    <condbean:cond privilege="Underground">
        <bean id="registerMetadataService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="UG Meta Data Service"/>
            <constructor-arg value="minestar.mine.service.underground.metadata.MetadataService"/>
            <constructor-arg ref="metadataServiceImpl"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="ugConfigStoreServiceImpl"
              class="minestar.mine.service.underground.configmetadata.UGConfigStoreServiceImpl"
              lazy-init="false">
            <property name="configStoreDao" ref="configStoreDao"/>
            <property name="configStoreMetaDataDao" ref="configStoreMetaDataDao"/>
            <property name="notification" ref="notification"/>
            <property name="txManager" ref="minestarTransactionManager"/>
        </bean>
    </condbean:cond>

    <condbean:cond privilege="Underground">
        <bean id="registerUGConfigStoreService" parent="registrationInstance" lazy-init="true">
            <constructor-arg value="UG Config Store Data Service"/>
            <constructor-arg value="minestar.mine.service.underground.configmetadata.UGConfigStoreService"/>
            <constructor-arg ref="ugConfigStoreServiceImpl"/>
        </bean>
    </condbean:cond>


</beans>
