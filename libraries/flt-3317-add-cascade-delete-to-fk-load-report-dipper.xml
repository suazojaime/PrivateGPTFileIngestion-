<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    <changeSet id="3361c1ae-9a24-4ff6-8ef4-00d7ee030554" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for LOAD_REPORT_DIPPER_ELT_FK of table LOAD_REPORT_DIPPER as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="LOAD_REPORT_DIPPER" foreignKeyName="LOAD_REPORT_DIPPER_ELT_FK"/>
        </preConditions>
        <comment>{JIRA}: DropForeignKeyConstraint LOAD_REPORT_DIPPER_ELT_FK from LOAD_REPORT_DIPPER (ELT)</comment>
        <dropForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" constraintName="LOAD_REPORT_DIPPER_ELT_FK"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" baseColumnNames="ELT" constraintName="LOAD_REPORT_DIPPER_ELT_FK" referencedTableName="DIPPERRECORD" referencedColumnNames="OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="60a3d3b4-f7e2-4772-ba65-3002124e795d" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for LOAD_REPORT_DIPPER_EVENT_OI_FK of table LOAD_REPORT_DIPPER as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="LOAD_REPORT_DIPPER" foreignKeyName="LOAD_REPORT_DIPPER_EVENT_OI_FK"/>
        </preConditions>
        <comment>{JIRA}: DropForeignKeyConstraint LOAD_REPORT_DIPPER_EVENT_OI_FK from LOAD_REPORT_DIPPER (EVENT_OID)</comment>
        <dropForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" constraintName="LOAD_REPORT_DIPPER_EVENT_OI_FK"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" baseColumnNames="EVENT_OID" constraintName="LOAD_REPORT_DIPPER_EVENT_OI_FK" referencedTableName="PRODUCTION_EVENT" referencedColumnNames="EVENT_OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>
    <changeSet id="a6f30e07-d9a6-4ef4-bb87-dbeb0425f66c" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for LOAD_REPORT_DIPPER_ELT_FK to table LOAD_REPORT_DIPPER as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="LOAD_REPORT_DIPPER"/>
            <tableExists tableName="DIPPERRECORD"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="LOAD_REPORT_DIPPER" foreignKeyName="LOAD_REPORT_DIPPER_ELT_FK"/>
            </not>
        </preConditions>
        <comment>{JIRA}: AddForeignKeyConstraint LOAD_REPORT_DIPPER_ELT_FK to LOAD_REPORT_DIPPER (ELT)</comment>
        <sql>DELETE FROM LOAD_REPORT_DIPPER WHERE ELT IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM DIPPERRECORD WHERE DIPPERRECORD.OID = LOAD_REPORT_DIPPER.ELT)</sql>
        <addForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" baseColumnNames="ELT" constraintName="LOAD_REPORT_DIPPER_ELT_FK" referencedTableName="DIPPERRECORD" referencedColumnNames="OID" onDelete="CASCADE"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" constraintName="LOAD_REPORT_DIPPER_ELT_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="2edb21a3-df94-44af-bbf2-8d3dad18f793" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for LOAD_REPORT_DIPPER_EVENT_OI_FK to table LOAD_REPORT_DIPPER as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="LOAD_REPORT_DIPPER"/>
            <tableExists tableName="PRODUCTION_EVENT"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="LOAD_REPORT_DIPPER" foreignKeyName="LOAD_REPORT_DIPPER_EVENT_OI_FK"/>
            </not>
        </preConditions>
        <comment>{JIRA}: AddForeignKeyConstraint LOAD_REPORT_DIPPER_EVENT_OI_FK to LOAD_REPORT_DIPPER (EVENT_OID)</comment>
        <sql>DELETE FROM LOAD_REPORT_DIPPER WHERE EVENT_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM PRODUCTION_EVENT WHERE PRODUCTION_EVENT.EVENT_OID = LOAD_REPORT_DIPPER.EVENT_OID)</sql>
        <addForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" baseColumnNames="EVENT_OID" constraintName="LOAD_REPORT_DIPPER_EVENT_OI_FK" referencedTableName="PRODUCTION_EVENT" referencedColumnNames="EVENT_OID" onDelete="CASCADE"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="LOAD_REPORT_DIPPER" constraintName="LOAD_REPORT_DIPPER_EVENT_OI_FK"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
