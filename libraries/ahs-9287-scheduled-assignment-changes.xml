<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">

    <changeSet id="3870d38e-1c4d-49f4-aa6d-9db3d8302800" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for SCHED_ASSIGNMENT_MACHINE_FK1 of table SCHED_ASSIGNMENT_MACHINE as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="SCHED_ASSIGNMENT_MACHINE" foreignKeyName="SCHED_ASSIGNMENT_MACHINE_FK1"/>
        </preConditions>
        <comment>AHS-9287: DropForeignKeyConstraint SCHED_ASSIGNMENT_MACHINE_FK1 from SCHED_ASSIGNMENT_MACHINE (SA_LOCATION_OID)</comment>
        <dropForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" constraintName="SCHED_ASSIGNMENT_MACHINE_FK1"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" baseColumnNames="SCHEDULEDASSIGNMENT_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_FK1" referencedTableName="SCHEDULEDASSIGNMENT" referencedColumnNames="SCHEDULEDASSIGNMENT_OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>

    <changeSet id="3870d38e-1c4d-49f4-aa6d-9db3d8302801" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for SCHED_ASSIGNMENT_MACHINE_FK2 of table SCHED_ASSIGNMENT_MACHINE as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="SCHED_ASSIGNMENT_MACHINE" foreignKeyName="SCHED_ASSIGNMENT_MACHINE_FK2"/>
        </preConditions>
        <comment>AHS-9287: DropForeignKeyConstraint SCHED_ASSIGNMENT_MACHINE_FK2 from SCHED_ASSIGNMENT_MACHINE (SA_LOCATION_OID)</comment>
        <dropForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" constraintName="SCHED_ASSIGNMENT_MACHINE_FK2"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" baseColumnNames="MACHINE_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_FK2" referencedTableName="MACHINE" referencedColumnNames="MACHINE_OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>

    <changeSet id="3870d38e-1c4d-49f4-aa6d-9db3d8302802" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropForeignKeyConstraint for SCHED_ASSIGNMENT_MACHINE_FK3 of table SCHED_ASSIGNMENT_MACHINE as foreignKey does not exist." onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="SCHED_ASSIGNMENT_MACHINE" foreignKeyName="SCHED_ASSIGNMENT_MACHINE_FK3"/>
        </preConditions>
        <comment>AHS-9287: DropForeignKeyConstraint SCHED_ASSIGNMENT_MACHINE_FK3 from SCHED_ASSIGNMENT_MACHINE (SA_LOCATION_OID)</comment>
        <dropForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" constraintName="SCHED_ASSIGNMENT_MACHINE_FK3"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" baseColumnNames="SA_LOCATION_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_FK3" referencedTableName="SCHED_ASSIGNMENT_LOCATION" referencedColumnNames="SCHEDASSIGNMENTLOCATION_OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>

    <changeSet id="35993366-1fa5-449d-bad8-34ce4f1444c4" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropPrimaryKey for SCHED_ASSIGNMENT_MACHINE_PK of table SCHED_ASSIGNMENT_MACHINE as primaryKey does not exist." onFail="MARK_RAN">
            <primaryKeyExists primaryKeyName="SCHED_ASSIGNMENT_MACHINE_PK" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        </preConditions>
        <comment>AHS-9287: DropPrimaryKey SCHED_ASSIGNMENT_MACHINE_PK from SCHED_ASSIGNMENT_MACHINE (SCHEDASSIGNMENTMACHINE_OID)</comment>
        <dropPrimaryKey constraintName="SCHED_ASSIGNMENT_MACHINE_PK" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        <rollback>
            <addPrimaryKey columnNames="SCHEDASSIGNMENTMACHINE_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_PK" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

    <changeSet id="259451f0-3dad-4af0-8c03-0ff8c48ec657" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropColumn for SCHEDASSIGNMENTMACHINE_OID of table SCHED_ASSIGNMENT_MACHINE as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="SCHEDASSIGNMENTMACHINE_OID"/>
        </preConditions>
        <comment>AHS-9287: DropColumn SCHED_ASSIGNMENT_MACHINE.SCHEDASSIGNMENTMACHINE_OID</comment>
        <dropColumn columnName="SCHEDASSIGNMENTMACHINE_OID" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        <rollback>
            <sql>DELETE FROM SCHED_ASSIGNMENT_LOCATION</sql>
            <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE</sql>
            <sql>DELETE FROM SCHEDULEDASSIGNMENT</sql>
            <addColumn tableName="SCHED_ASSIGNMENT_MACHINE">
                <column name="SCHEDASSIGNMENTMACHINE_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
            </addColumn>
        </rollback>
    </changeSet>

    <changeSet id="1f9863c3-c2bf-4802-9a63-11cb07ad48ca" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for LOCATION_OID to table SCHED_ASSIGNMENT_MACHINE as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="SCHED_ASSIGNMENT_MACHINE"/>
            <not>
                <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="LOCATION_OID"/>
            </not>
        </preConditions>
        <comment>AHS-9287: AddColumn SCHED_ASSIGNMENT_MACHINE.LOCATION_OID</comment>
        <addColumn tableName="SCHED_ASSIGNMENT_MACHINE">
            <column name="LOCATION_OID" type="BIGINT"/>
        </addColumn>
    </changeSet>

    <changeSet id="22bb91ed-7022-423e-9956-0f8ef58ec2f7" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for PENALTY to table SCHED_ASSIGNMENT_MACHINE as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="SCHED_ASSIGNMENT_MACHINE"/>
            <not>
                <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="PENALTY"/>
            </not>
        </preConditions>
        <comment>AHS-9287: AddColumn SCHED_ASSIGNMENT_MACHINE.PENALTY</comment>
        <addColumn tableName="SCHED_ASSIGNMENT_MACHINE">
            <column name="PENALTY" type="DOUBLE"/>
        </addColumn>
    </changeSet>

    <changeSet id="68897199-d895-4685-8fcf-10b0917cba57" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored upgrade as columns do not exist" onFail="MARK_RAN">
            <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="SA_LOCATION_OID"/>
            <columnExists tableName="SCHED_ASSIGNMENT_LOCATION" columnName="SCHEDASSIGNMENTLOCATION_OID"/>
        </preConditions>
        <comment>AHS-9287: Update SCHED_ASSIGNMENT_MACHINE.LOCATION_OID and PENALTY</comment>
        <sql>UPDATE SCHED_ASSIGNMENT_MACHINE SET LOCATION_OID = (SELECT MIN(LOCATION_OID) FROM SCHED_ASSIGNMENT_LOCATION WHERE SCHEDASSIGNMENTLOCATION_OID = SA_LOCATION_OID)</sql>
        <sql>UPDATE SCHED_ASSIGNMENT_MACHINE SET PENALTY = (SELECT MIN(PENALTY) FROM SCHED_ASSIGNMENT_LOCATION WHERE SCHEDASSIGNMENTLOCATION_OID = SA_LOCATION_OID)</sql>
        <rollback>
            <comment>@EmptyRollback</comment>
        </rollback>
    </changeSet>

    <changeSet id="19a19d3b-9466-4701-b349-3194b31abecc" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropColumn for SA_LOCATION_OID of table SCHED_ASSIGNMENT_MACHINE as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="SA_LOCATION_OID"/>
        </preConditions>
        <comment>AHS-9287: DropColumn SCHED_ASSIGNMENT_MACHINE.SA_LOCATION_OID</comment>
        <dropColumn columnName="SA_LOCATION_OID" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        <rollback>
            <sql>DELETE FROM SCHED_ASSIGNMENT_LOCATION</sql>
            <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE</sql>
            <sql>DELETE FROM SCHEDULEDASSIGNMENT</sql>
            <addColumn tableName="SCHED_ASSIGNMENT_MACHINE">
                <column name="SA_LOCATION_OID" type="BIGINT"/>
            </addColumn>
        </rollback>
    </changeSet>

    <changeSet id="7ef616c7-510c-41c6-956a-7c2b12c775f0" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHED_ASSIGNMENT_MACHINE.MACHINE_OID as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHED_ASSIGNMENT_MACHINE" columnName="MACHINE_OID"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHED_ASSIGNMENT_MACHINE.MACHINE_OID</comment>
        <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE WHERE MACHINE_OID IS NULL</sql>
        <addNotNullConstraint columnName="MACHINE_OID" columnDataType="BIGINT" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHED_ASSIGNMENT_MACHINE" columnName="MACHINE_OID" columnDataType="BIGINT"/>
        </rollback>
    </changeSet>

    <changeSet id="bd9006c8-07d2-4efc-9a0e-f5791717abe6" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHED_ASSIGNMENT_MACHINE.SCHEDULEDASSIGNMENT_OID as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHED_ASSIGNMENT_MACHINE" columnName="SCHEDULEDASSIGNMENT_OID"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHED_ASSIGNMENT_MACHINE.SCHEDULEDASSIGNMENT_OID</comment>
        <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE WHERE SCHEDULEDASSIGNMENT_OID IS NULL</sql>
        <addNotNullConstraint columnName="SCHEDULEDASSIGNMENT_OID" columnDataType="BIGINT" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHED_ASSIGNMENT_MACHINE" columnName="SCHEDULEDASSIGNMENT_OID" columnDataType="BIGINT"/>
        </rollback>
    </changeSet>

    <changeSet id="151edceb-a32c-47b8-b8f0-6c195166d576" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddPrimaryKey for SCHED_ASSIGNMENT_MACHINE_PK to table SCHED_ASSIGNMENT_MACHINE as table does not exist or primaryKey already exists." onFail="MARK_RAN">
            <tableExists tableName="SCHED_ASSIGNMENT_MACHINE"/>
            <not>
                <primaryKeyExists primaryKeyName="SCHED_ASSIGNMENT_MACHINE_PK" tableName="SCHED_ASSIGNMENT_MACHINE"/>
            </not>
        </preConditions>
        <comment>AHS-9287: AddPrimaryKey SCHED_ASSIGNMENT_MACHINE_PK to SCHED_ASSIGNMENT_MACHINE (SCHEDULEDASSIGNMENT_OID,MACHINE_OID)</comment>
        <sql dbms="oracle">DELETE FROM SCHED_ASSIGNMENT_MACHINE WHERE ROWID IN (SELECT RID FROM (SELECT ROWID RID, ROW_NUMBER() OVER (PARTITION BY SCHEDULEDASSIGNMENT_OID, MACHINE_OID ORDER BY ROWID) RN FROM SCHED_ASSIGNMENT_MACHINE) WHERE RN &lt;&gt; 1)</sql>
        <sql dbms="mssql">WITH CTE AS (SELECT ROW_NUMBER() OVER (PARTITION BY SCHEDULEDASSIGNMENT_OID, MACHINE_OID ORDER BY %%physloc%%) AS ROW_NUM FROM SCHED_ASSIGNMENT_MACHINE) DELETE FROM CTE WHERE ROW_NUM &gt; 1</sql>
        <addPrimaryKey columnNames="SCHEDULEDASSIGNMENT_OID,MACHINE_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_PK" tablespace="MW_IDXENT" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        <rollback>
            <dropPrimaryKey constraintName="SCHED_ASSIGNMENT_MACHINE_PK" tableName="SCHED_ASSIGNMENT_MACHINE"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

    <changeSet id="b46b93d6-79d4-4f0f-93e4-a962fa84dfc0" author="MineStar" context="Assignment/Assignment_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for SCHED_ASSIGNMENT_MACHINE_FK1 to table SCHED_ASSIGNMENT_MACHINE as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="SCHEDULEDASSIGNMENT_OID"/>
            <columnExists tableName="SCHEDULEDASSIGNMENT" columnName="SCHEDULEDASSIGNMENT_OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="SCHED_ASSIGNMENT_MACHINE" foreignKeyName="SCHED_ASSIGNMENT_MACHINE_FK1"/>
            </not>
        </preConditions>
        <comment>AHS-9287: AddForeignKeyConstraint SCHED_ASSIGNMENT_MACHINE_FK1 to SCHED_ASSIGNMENT_MACHINE (SCHEDULEDASSIGNMENT_OID)</comment>
        <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE WHERE SCHEDULEDASSIGNMENT_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM SCHEDULEDASSIGNMENT WHERE SCHEDULEDASSIGNMENT.SCHEDULEDASSIGNMENT_OID = SCHED_ASSIGNMENT_MACHINE.SCHEDULEDASSIGNMENT_OID)</sql>
        <addForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" baseColumnNames="SCHEDULEDASSIGNMENT_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_FK1" referencedTableName="SCHEDULEDASSIGNMENT" referencedColumnNames="SCHEDULEDASSIGNMENT_OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" constraintName="SCHED_ASSIGNMENT_MACHINE_FK1"/>
        </rollback>
    </changeSet>

    <changeSet id="fbcaa5e4-8a9d-4478-b914-34191361e7c1" author="MineStar" context="Assignment/Assignment_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for SCHED_ASSIGNMENT_MACHINE_FK2 to table SCHED_ASSIGNMENT_MACHINE as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="MACHINE_OID"/>
            <columnExists tableName="MACHINE" columnName="MACHINE_OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="SCHED_ASSIGNMENT_MACHINE" foreignKeyName="SCHED_ASSIGNMENT_MACHINE_FK2"/>
            </not>
        </preConditions>
        <comment>AHS-9287: AddForeignKeyConstraint SCHED_ASSIGNMENT_MACHINE_FK2 to SCHED_ASSIGNMENT_MACHINE (MACHINE_OID)</comment>
        <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE WHERE MACHINE_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM MACHINE WHERE MACHINE.MACHINE_OID = SCHED_ASSIGNMENT_MACHINE.MACHINE_OID)</sql>
        <addForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" baseColumnNames="MACHINE_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_FK2" referencedTableName="MACHINE" referencedColumnNames="MACHINE_OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" constraintName="SCHED_ASSIGNMENT_MACHINE_FK2"/>
        </rollback>
    </changeSet>

    <changeSet id="9b2cd61c-c33b-4483-b20b-6fae3dde3b03" author="MineStar" context="Assignment/Assignment_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for SCHED_ASSIGNMENT_MACHINE_FK3 to table SCHED_ASSIGNMENT_MACHINE as (1) the source or referenced column does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <columnExists tableName="SCHED_ASSIGNMENT_MACHINE" columnName="LOCATION_OID"/>
            <columnExists tableName="LOCATION" columnName="LOCATION_OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="SCHED_ASSIGNMENT_MACHINE" foreignKeyName="SCHED_ASSIGNMENT_MACHINE_FK3"/>
            </not>
        </preConditions>
        <comment>AHS-9287: AddForeignKeyConstraint SCHED_ASSIGNMENT_MACHINE_FK3 to SCHED_ASSIGNMENT_MACHINE (LOCATION_OID)</comment>
        <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE WHERE LOCATION_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM LOCATION WHERE LOCATION.LOCATION_OID = SCHED_ASSIGNMENT_MACHINE.LOCATION_OID)</sql>
        <addForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" baseColumnNames="LOCATION_OID" constraintName="SCHED_ASSIGNMENT_MACHINE_FK3" referencedTableName="LOCATION" referencedColumnNames="LOCATION_OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="SCHED_ASSIGNMENT_MACHINE" constraintName="SCHED_ASSIGNMENT_MACHINE_FK3"/>
        </rollback>
    </changeSet>

    <changeSet id="5e749a81-e070-406c-869a-966eed1e83fd" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropPrimaryKey for SCHED_ASSIGNMENT_LOCATION_PK of table SCHED_ASSIGNMENT_LOCATION as primaryKey does not exist." onFail="MARK_RAN">
            <primaryKeyExists primaryKeyName="SCHED_ASSIGNMENT_LOCATION_PK" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        </preConditions>
        <comment>AHS-9287: DropPrimaryKey SCHED_ASSIGNMENT_LOCATION_PK from SCHED_ASSIGNMENT_LOCATION (SCHEDASSIGNMENTLOCATION_OID)</comment>
        <dropPrimaryKey constraintName="SCHED_ASSIGNMENT_LOCATION_PK" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        <rollback>
            <addPrimaryKey columnNames="SCHEDASSIGNMENTLOCATION_OID" constraintName="SCHED_ASSIGNMENT_LOCATION_PK" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>
    
    <changeSet id="7d3323ca-5f4b-4105-bb0a-26f35358749c" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored DropColumn for SCHEDASSIGNMENTLOCATION_OID of table SCHED_ASSIGNMENT_LOCATION as column does not exist." onFail="MARK_RAN">
            <columnExists tableName="SCHED_ASSIGNMENT_LOCATION" columnName="SCHEDASSIGNMENTLOCATION_OID"/>
        </preConditions>
        <comment>AHS-9287: DropColumn SCHED_ASSIGNMENT_LOCATION.SCHEDASSIGNMENTLOCATION_OID</comment>
        <dropColumn columnName="SCHEDASSIGNMENTLOCATION_OID" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        <rollback>
            <sql>DELETE FROM SCHED_ASSIGNMENT_LOCATION</sql>
            <sql>DELETE FROM SCHED_ASSIGNMENT_MACHINE</sql>
            <sql>DELETE FROM SCHEDULEDASSIGNMENT</sql>
            <addColumn tableName="SCHED_ASSIGNMENT_LOCATION">
                <column name="SCHEDASSIGNMENTLOCATION_OID" type="BIGINT">
                    <constraints nullable="false"/>
                </column>
            </addColumn>
        </rollback>
    </changeSet>
    
    <changeSet id="dd143382-98bd-4bea-877e-4d85b0424773" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHED_ASSIGNMENT_LOCATION.LOCATION_OID as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHED_ASSIGNMENT_LOCATION" columnName="LOCATION_OID"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHED_ASSIGNMENT_LOCATION.LOCATION_OID</comment>
        <sql>DELETE FROM SCHED_ASSIGNMENT_LOCATION WHERE LOCATION_OID IS NULL</sql>
        <addNotNullConstraint columnName="LOCATION_OID" columnDataType="BIGINT" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHED_ASSIGNMENT_LOCATION" columnName="LOCATION_OID" columnDataType="BIGINT"/>
        </rollback>
    </changeSet>
    
    <changeSet id="6f12affe-8b59-4c7d-8eb8-b913e96e9087" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHED_ASSIGNMENT_LOCATION.PENALTY as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHED_ASSIGNMENT_LOCATION" columnName="PENALTY"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHED_ASSIGNMENT_LOCATION.PENALTY</comment>
        <sql>UPDATE SCHED_ASSIGNMENT_LOCATION SET PENALTY = 0 WHERE PENALTY IS NULL</sql>
        <addNotNullConstraint columnName="PENALTY" columnDataType="DOUBLE" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHED_ASSIGNMENT_LOCATION" columnName="PENALTY" columnDataType="DOUBLE"/>
        </rollback>
    </changeSet>
    
    <changeSet id="e8290e17-11d5-4b6a-b273-dbb607156210" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHED_ASSIGNMENT_LOCATION.SCHEDULEDASSIGNMENT_OID as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHED_ASSIGNMENT_LOCATION" columnName="SCHEDULEDASSIGNMENT_OID"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHED_ASSIGNMENT_LOCATION.SCHEDULEDASSIGNMENT_OID</comment>
        <sql>DELETE FROM SCHED_ASSIGNMENT_LOCATION WHERE SCHEDULEDASSIGNMENT_OID IS NULL</sql>
        <addNotNullConstraint columnName="SCHEDULEDASSIGNMENT_OID" columnDataType="BIGINT" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHED_ASSIGNMENT_LOCATION" columnName="SCHEDULEDASSIGNMENT_OID" columnDataType="BIGINT"/>
        </rollback>
    </changeSet>
    
    <changeSet id="06627457-4dac-4a0e-a00b-7bba2578ba28" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddPrimaryKey for SCHED_ASSIGNMENT_LOCATION_PK to table SCHED_ASSIGNMENT_LOCATION as table does not exist or primaryKey already exists." onFail="MARK_RAN">
            <tableExists tableName="SCHED_ASSIGNMENT_LOCATION"/>
            <not>
                <primaryKeyExists primaryKeyName="SCHED_ASSIGNMENT_LOCATION_PK" tableName="SCHED_ASSIGNMENT_LOCATION"/>
            </not>
        </preConditions>
        <comment>AHS-9287: AddPrimaryKey SCHED_ASSIGNMENT_LOCATION_PK to SCHED_ASSIGNMENT_LOCATION (SCHEDULEDASSIGNMENT_OID,LOCATION_OID)</comment>
        <sql dbms="oracle">DELETE FROM SCHED_ASSIGNMENT_LOCATION WHERE ROWID IN (SELECT RID FROM (SELECT ROWID RID, ROW_NUMBER() OVER (PARTITION BY SCHEDULEDASSIGNMENT_OID, LOCATION_OID ORDER BY ROWID) RN FROM SCHED_ASSIGNMENT_LOCATION) WHERE RN &lt;&gt; 1)</sql>
        <sql dbms="mssql">WITH CTE AS (SELECT ROW_NUMBER() OVER (PARTITION BY SCHEDULEDASSIGNMENT_OID, LOCATION_OID ORDER BY %%physloc%%) AS ROW_NUM FROM SCHED_ASSIGNMENT_LOCATION) DELETE FROM CTE WHERE ROW_NUM &gt; 1</sql>
        <addPrimaryKey columnNames="SCHEDULEDASSIGNMENT_OID,LOCATION_OID" constraintName="SCHED_ASSIGNMENT_LOCATION_PK" tablespace="MW_IDXENT" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        <rollback>
            <dropPrimaryKey constraintName="SCHED_ASSIGNMENT_LOCATION_PK" tableName="SCHED_ASSIGNMENT_LOCATION"/>
        </rollback>
        <modifySql dbms="mssql,h2,postgresql">
            <regExpReplace replace="( USING INDEX)? (ON|TABLESPACE) MW_[A-Z]+" with=""/>
        </modifySql>
    </changeSet>

    <changeSet id="bca42730-ff74-42bb-a365-2ec70d6086a5" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHEDULEDASSIGNMENT.ASAP as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHEDULEDASSIGNMENT" columnName="ASAP"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHEDULEDASSIGNMENT.ASAP</comment>
        <sql>UPDATE SCHEDULEDASSIGNMENT SET ASAP = 0 WHERE ASAP IS NULL</sql>
        <addNotNullConstraint columnName="ASAP" columnDataType="BOOLEAN" tableName="SCHEDULEDASSIGNMENT"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHEDULEDASSIGNMENT" columnName="ASAP" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>
    
    <changeSet id="f6b13914-e78c-40d8-95df-05693f6e1794" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHEDULEDASSIGNMENT.RESCHEDULE as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHEDULEDASSIGNMENT" columnName="RESCHEDULE"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHEDULEDASSIGNMENT.RESCHEDULE</comment>
        <sql>UPDATE SCHEDULEDASSIGNMENT SET RESCHEDULE = 0 WHERE RESCHEDULE IS NULL</sql>
        <addNotNullConstraint columnName="RESCHEDULE" columnDataType="BOOLEAN" tableName="SCHEDULEDASSIGNMENT"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHEDULEDASSIGNMENT" columnName="RESCHEDULE" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>
    
    <changeSet id="77b5dd77-2620-40db-92ed-97bc74605cdd" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHEDULEDASSIGNMENT.CREATIONTIME_UTC as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHEDULEDASSIGNMENT" columnName="CREATIONTIME_UTC"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHEDULEDASSIGNMENT.CREATIONTIME_UTC</comment>
        <sql>UPDATE SCHEDULEDASSIGNMENT SET CREATIONTIME_UTC = '01-JAN-1970' WHERE CREATIONTIME_UTC IS NULL</sql>
        <addNotNullConstraint columnName="CREATIONTIME_UTC" columnDataType="DATETIME2" tableName="SCHEDULEDASSIGNMENT"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHEDULEDASSIGNMENT" columnName="CREATIONTIME_UTC" columnDataType="DATETIME2"/>
        </rollback>
    </changeSet>
    
    <changeSet id="b99c7e39-d4f1-4588-835d-8b5ea83c0d93" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHEDULEDASSIGNMENT.MANUAL as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHEDULEDASSIGNMENT" columnName="MANUAL"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHEDULEDASSIGNMENT.MANUAL</comment>
        <sql>UPDATE SCHEDULEDASSIGNMENT SET MANUAL = 0 WHERE MANUAL IS NULL</sql>
        <addNotNullConstraint columnName="MANUAL" columnDataType="BOOLEAN" tableName="SCHEDULEDASSIGNMENT"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHEDULEDASSIGNMENT" columnName="MANUAL" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>
    
    <changeSet id="d10d8dd0-ef3d-4c33-9e25-f1caff7d7570" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHEDULEDASSIGNMENT.ONARRIVALDELAYTYPEPROD as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHEDULEDASSIGNMENT" columnName="ONARRIVALDELAYTYPEPROD"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHEDULEDASSIGNMENT.ONARRIVALDELAYTYPEPROD</comment>
        <sql>UPDATE SCHEDULEDASSIGNMENT SET ONARRIVALDELAYTYPEPROD = 0 WHERE ONARRIVALDELAYTYPEPROD IS NULL</sql>
        <addNotNullConstraint columnName="ONARRIVALDELAYTYPEPROD" columnDataType="BOOLEAN" tableName="SCHEDULEDASSIGNMENT"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHEDULEDASSIGNMENT" columnName="ONARRIVALDELAYTYPEPROD" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>
    
    <changeSet id="6b82cc18-0752-4966-baeb-80c8b8a637db" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddNotNullConstraint for SCHEDULEDASSIGNMENT.ONASSIGNMENTDELAYPROD as column does not exist or is already not-nullable" onFail="MARK_RAN">
            <ext:columnIsNullable tableName="SCHEDULEDASSIGNMENT" columnName="ONASSIGNMENTDELAYPROD"/>
        </preConditions>
        <comment>AHS-9287: AddNotNullConstraint to SCHEDULEDASSIGNMENT.ONASSIGNMENTDELAYPROD</comment>
        <sql>UPDATE SCHEDULEDASSIGNMENT SET ONASSIGNMENTDELAYPROD = 0 WHERE ONASSIGNMENTDELAYPROD IS NULL</sql>
        <addNotNullConstraint columnName="ONASSIGNMENTDELAYPROD" columnDataType="BOOLEAN" tableName="SCHEDULEDASSIGNMENT"/>
        <rollback>
            <dropNotNullConstraint tableName="SCHEDULEDASSIGNMENT" columnName="ONASSIGNMENTDELAYPROD" columnDataType="BOOLEAN"/>
        </rollback>
    </changeSet>
    
</databaseChangeLog>
