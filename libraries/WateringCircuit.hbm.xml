<?xml version="1.0"?>
<!-- Copyright (c) 2021 Caterpillar -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping schema="model" default-access="field" default-lazy="false">

    <class
            name="minestar.mine.domain.minemodel.watering.WateringCircuit"
            table="WATERING_CIRCUIT">

        <meta attribute="description">Watering Circuits define the areas to be automatically watered.</meta>

        <meta attribute="view-master">true</meta>
        <meta attribute="view-include">true</meta>

        <cache usage="read-write" region="model"/>

        <id name="OID"
            type="java.lang.Long"
            column="OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <property name="name" type="java.lang.String" column="NAME"/>

        <property name="valid" type="java.lang.Boolean" column="IS_VALID" not-null="true">
            <meta attribute="defaultValue">true</meta>
            <meta attribute="description">Is this watering circuit valid</meta>
        </property>

        <property name="createdDate"
                  type="TimestampType"
                  column="CREATED_DATE_UTC">
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The watering circuit creation utc timestamp.</meta>
            <meta attribute="description">The watering circuit creation timestamp</meta>
        </property>

        <property name="lastUpdatedDate"
                  type="TimestampType"
                  column="LAST_UPDATED_DATE_UTC">
            <meta attribute="view-localtime">true</meta>
            <meta attribute="utc-description">The watering circuit updated utc timestamp.</meta>
            <meta attribute="description">The watering circuit updated timestamp</meta>
        </property>

        <list name="legs" table="WATERING_CIRCUIT_LEG" cascade="all-delete-orphan">
            <meta attribute="description">The start and end point in the mine model for watering</meta>

            <key column="CIRCUIT_OID" not-null="true"/>
            <list-index column="LEG_NR"/>
            <composite-element class="minestar.mine.domain.minemodel.watering.WateringCircuitLeg">
                <property name="name" type="java.lang.String" column="NAME" not-null="false">
                    <meta attribute="description">The leg name</meta>
                </property>
                <property name="valid" type="java.lang.Boolean" column="IS_VALID" not-null="true">
                    <meta attribute="defaultValue">true</meta>
                    <meta attribute="description">Is this circuit leg valid</meta>
                </property>
                <property name="watering" type="java.lang.Boolean" column="IS_WATERING" not-null="true">
                    <meta attribute="defaultValue">true</meta>
                    <meta attribute="description">Is this a watering circuit leg</meta>
                </property>
                <property name="intermittent" type="java.lang.Boolean" column="IS_INTERMITTENT" not-null="true">
                    <meta attribute="defaultValue">true</meta>
                    <meta attribute="description">Is intermittent watering to be performed on this circuit leg?</meta>
                </property>

                <many-to-one name="machineClassRef"
                             column="MACHINE_CLASS_OID"
                             class="minestar.pitlink.domain.machine.MachineClassReference"
                             not-null="false">
                    <meta attribute="alias">machineClass</meta>
                </many-to-one>

                <many-to-one name="startLaneRef"
                             class="minestar.mine.domain.minemodel.LaneReference"
                             column="START_LANE"
                             not-null="false">
                    <meta attribute="alias">lane</meta>
                    <meta attribute="description">The lane that is the start leg destination.</meta>
                </many-to-one>
                <many-to-one name="endLaneRef"
                             class="minestar.mine.domain.minemodel.LaneReference"
                             column="END_LANE"
                             not-null="false">
                    <meta attribute="alias">lane</meta>
                    <meta attribute="description">The lane that is the end leg destination.</meta>
                </many-to-one>

                <many-to-one name="startPlanRef"
                             class="minestar.mine.domain.minemodel.planning.PlanReference"
                             column="START_PLAN"
                             not-null="false">
                    <meta attribute="alias">plan</meta>
                    <meta attribute="description">The plan that is the start leg destination.</meta>
                </many-to-one>
                <many-to-one name="endPlanRef"
                             class="minestar.mine.domain.minemodel.planning.PlanReference"
                             column="END_PLAN"
                             not-null="false">
                    <meta attribute="alias">plan</meta>
                    <meta attribute="description">The plan that is the end leg destination.</meta>
                </many-to-one>

                <property name="desiredSaturationAdjustment" column="DESIRED_SATURATION_ADJUSTMENT" not-null="true">
                    <meta attribute="description">A percentage adjustment to apply to the desired saturation level for this leg.  eg -50%, -25%, 0% (default), 25%, 50%</meta>
                    <meta attribute="unitType">ratio</meta>
                    <type name="quantity">
                        <param name="unitType">ratio</param>
                    </type>
                </property>

                <property name="sprayHeadGroups" column="SPRAY_HEAD_GROUPS" type="minestar.pitlink.domain.machine.SprayHeadGroupSetUserType" length="255">
                    <meta attribute="description">Comma-separated list of spray head group names</meta>
                </property>

            </composite-element>
        </list>
    </class>

    <!-- A lightweight reference to a WateringCircuit -->
    <class name="minestar.mine.domain.minemodel.watering.WateringCircuitReference" table="WATERING_CIRCUIT" mutable="false" lazy="false">

        <meta attribute="alias" inherit="false">WATERING_CIRCUIT_REFERENCE</meta>
        <meta attribute="description">A minimal reference to a WateringCircuit.</meta>
        <meta attribute="view-create-order">1</meta>

        <cache usage="read-only" region="model"/>

        <id name="OID" type="long" column="OID"/>
        <property name="name" type="string" column="NAME" not-null="true"/>
    </class>

</hibernate-mapping>
