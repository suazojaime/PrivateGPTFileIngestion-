<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">


    <changeSet id="c51ebf5d-a136-42c6-baea-dab20a1c1d6a" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropForeignKeyConstraint for LANE_REASSIGNMENT_CLASSES_FK1 of table LANE_REASSIGNMENT_CLASSES as foreignKey does not exist."
                onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="LANE_REASSIGNMENT_CLASSES"
                                        foreignKeyName="LANE_REASSIGNMENT_CLASSES_FK1"/>
        </preConditions>
        <comment>FLT-7832: DropForeignKeyConstraint LANE_REASSIGNMENT_CLASSES_FK1 from LANE_REASSIGNMENT_CLASSES (MACHINE_CLASS_OID)</comment>
        <dropForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES"
                                  constraintName="LANE_REASSIGNMENT_CLASSES_FK1"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES" baseColumnNames="MACHINE_CLASS_OID"
                                     constraintName="LANE_REASSIGNMENT_CLASSES_FK1" referencedTableName="MACHINECLASS"
                                     referencedColumnNames="MACHINECLASS_OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>

    <changeSet id="8f317571-5dd9-486b-becf-5df3e343849f" author="MineStar" failOnError="false">
        <preConditions
                onFailMessage="Ignored DropForeignKeyConstraint for LANE_REASSIGNMENT_CLASSES_FK2 of table LANE_REASSIGNMENT_CLASSES as foreignKey does not exist."
                onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyTableName="LANE_REASSIGNMENT_CLASSES"
                                        foreignKeyName="LANE_REASSIGNMENT_CLASSES_FK2"/>
        </preConditions>
        <comment>FLT-7832: DropForeignKeyConstraint LANE_REASSIGNMENT_CLASSES_FK2 from LANE_REASSIGNMENT_CLASSES (OID)</comment>
        <dropForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES"
                                  constraintName="LANE_REASSIGNMENT_CLASSES_FK2"/>
        <rollback>
            <addForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES" baseColumnNames="OID"
                                     constraintName="LANE_REASSIGNMENT_CLASSES_FK2"
                                     referencedTableName="LANE_REASSIGNMENT_INFO"
                                     referencedColumnNames="LANE_REASSIGNMENT_OID" onDelete="NO ACTION"/>
        </rollback>
    </changeSet>

    <changeSet id="17bdb3b3-e5b3-4239-ba5e-f498ef7993e0" author="MineStar"
               context="Machine_Tracking/Machine_Tracking_Management" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddForeignKeyConstraint for LANE_REASSIGNMENT_CLASSES_FK1 to table LANE_REASSIGNMENT_CLASSES as (1) the source or referenced column does not exist, or (2) the foreignKey already exists."
                onFail="MARK_RAN">
            <columnExists tableName="LANE_REASSIGNMENT_CLASSES" columnName="MACHINE_CLASS_OID"/>
            <columnExists tableName="MACHINECLASS" columnName="MACHINECLASS_OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="LANE_REASSIGNMENT_CLASSES"
                                            foreignKeyName="LANE_REASSIGNMENT_CLASSES_FK1"/>
            </not>
        </preConditions>
        <comment>FLT-7832: AddForeignKeyConstraint LANE_REASSIGNMENT_CLASSES_FK1 to LANE_REASSIGNMENT_CLASSES (MACHINE_CLASS_OID)</comment>
        <sql>
            DELETE FROM LANE_REASSIGNMENT_CLASSES
            WHERE NOT EXISTS (SELECT 'x' FROM MACHINECLASS WHERE MACHINECLASS.MACHINECLASS_OID = LANE_REASSIGNMENT_CLASSES.MACHINE_CLASS_OID)
        </sql>
        <addForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES" baseColumnNames="MACHINE_CLASS_OID"
                                 constraintName="LANE_REASSIGNMENT_CLASSES_FK1" referencedTableName="MACHINECLASS"
                                 referencedColumnNames="MACHINECLASS_OID" onDelete="CASCADE"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES"
                                      constraintName="LANE_REASSIGNMENT_CLASSES_FK1"/>
        </rollback>
    </changeSet>

    <changeSet id="1bceb568-f0ca-455a-abeb-d2c104c6bb62" author="MineStar"
               context="Machine_Tracking/Machine_Tracking_Management" failOnError="false">
        <preConditions
                onFailMessage="Ignored AddForeignKeyConstraint for LANE_REASSIGNMENT_CLASSES_FK2 to table LANE_REASSIGNMENT_CLASSES as (1) the source or referenced column does not exist, or (2) the foreignKey already exists."
                onFail="MARK_RAN">
            <columnExists tableName="LANE_REASSIGNMENT_CLASSES" columnName="OID"/>
            <columnExists tableName="LANE_REASSIGNMENT_INFO" columnName="LANE_REASSIGNMENT_OID"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="LANE_REASSIGNMENT_CLASSES"
                                            foreignKeyName="LANE_REASSIGNMENT_CLASSES_FK2"/>
            </not>
        </preConditions>
        <comment>FLT-7832: AddForeignKeyConstraint LANE_REASSIGNMENT_CLASSES_FK2 to LANE_REASSIGNMENT_CLASSES (OID)</comment>
        <sql>
            DELETE FROM LANE_REASSIGNMENT_CLASSES
            WHERE NOT EXISTS (SELECT 'x' FROM LANE_REASSIGNMENT_INFO WHERE LANE_REASSIGNMENT_INFO.LANE_REASSIGNMENT_OID = LANE_REASSIGNMENT_CLASSES.OID)
        </sql>
        <addForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES" baseColumnNames="OID"
                                 constraintName="LANE_REASSIGNMENT_CLASSES_FK2"
                                 referencedTableName="LANE_REASSIGNMENT_INFO"
                                 referencedColumnNames="LANE_REASSIGNMENT_OID" onDelete="CASCADE"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="LANE_REASSIGNMENT_CLASSES"
                                      constraintName="LANE_REASSIGNMENT_CLASSES_FK2"/>
        </rollback>
    </changeSet>

</databaseChangeLog>
