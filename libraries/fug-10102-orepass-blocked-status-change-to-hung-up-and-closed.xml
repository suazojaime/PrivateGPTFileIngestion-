<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="025d5896-eb2a-45d3-add3-0f873b2a3cca" author="MineStar" context="Underground/Underground_Management"
               failOnError="false" onValidationFail="HALT">
        <preConditions
                onFailMessage="Copy OPERATING_STATUS.BLOCKED to the HUNGUP column failed as both fields don't exist"
                onFail="MARK_RAN">
            <columnExists tableName="OPERATING_STATUS" columnName="BLOCKED"/>
            <columnExists tableName="OPERATING_STATUS" columnName="HUNGUP"/>
        </preConditions>
        <comment>FUG-10102: Copy OPERATING_STATUS.BLOCKED to the HUNGUP column</comment>
        <sql>update OPERATING_STATUS set HUNGUP = BLOCKED WHERE BLOCKED = 1 AND ECF_CLASS_ID LIKE '%OrePass%'</sql>
        <rollback>
            <sql>update OPERATING_STATUS set HUNGUP = NULL WHERE HUNGUP = BLOCKED AND ECF_CLASS_ID LIKE '%OrePass%'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="7a7efd74-b864-40cf-a355-14293559780a" author="MineStar" context="Underground/Underground_Management"
               failOnError="false">
        <preConditions
                onFailMessage="Ignored DropColumn for BLOCKED of table OPERATING_STATUS as column does not exist."
                onFail="MARK_RAN">
            <columnExists tableName="OPERATING_STATUS" columnName="BLOCKED"/>
        </preConditions>
        <comment>FUG-10102: DropColumn OPERATING_STATUS.BLOCKED</comment>
        <dropColumn columnName="BLOCKED" tableName="OPERATING_STATUS"/>
        <rollback>
            <addColumn tableName="OPERATING_STATUS">
                <column name="BLOCKED" type="BOOLEAN"/>
            </addColumn>
        </rollback>
    </changeSet>

</databaseChangeLog>
