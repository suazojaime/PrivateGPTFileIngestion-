<!--************************************************************************-->
<!-- STATE MACHINES-->
<!-- $Id: CycleStateConfig.xml,v 1.1 2004-08-16 07:43:41 andrewc Exp $   -->
<!--************************************************************************-->



<!-- This configfuration contains the Report.Activity event to indicate a state change to loading.  This will not
     always be the case. -->
<!--************************************************************************-->
<!-- STATE MACHINES-->
<!-- $Id: CycleStateConfig.xml,v 1.1 2004-08-16 07:43:41 andrewc Exp $   -->
<!--************************************************************************-->



<!-- This configfuration contains the Report.Activity event to indicate a state change to loading.  This will not
     always be the case. -->
<StateMachineConfiguration>
    <StateMachine
        name="Truck.State.Machine"
        class="com.mincom.util.statemachine.CommandDrivenStateMachine"
        >
        <state name="Previous.Cycle" stateType="mandatory">
            <transition
                events="End.Cycle Begin.Travelling.Empty"
                newState="Travelling.Empty"
                />
        </state>

        <state name="Dumping" stateType="mandatory">
            <transition
                events="End.Cycle Begin.Travelling.Empty"
                newState="Travelling.Empty"
                />
            <transition
                events="Begin.Loading Report.Activity"
                newState="Loading"
                />
        </state>

        <state name="Travelling.Empty" stateType="mandatory">
            <transition
                events="Begin.Reverse"
                newState="Spotting.At.Source"
                conditions="atSource"
                />
            <transition
                events="Begin.Stop"
                newState="Queuing.At.Source"
                conditions="atSource"
                />
            <transition
                events="Begin.Loading Report.Activity"
                newState="Loading"
                />
            <transition
                events="End.Cycle"
                newState="Travelling.Empty"
                />
        </state>

        <state name="At.Sink" stateType="mandatory">
            <transition
                events="Enter.Sink Set.Loaded"
                newState="Queuing.At.Sink"
                />
        </state>

        <state name="At.Source" stateType="mandatory">
            <transition
                events="Enter.Source Set.Empty"
                newState="Queuing.At.Source"
                />
        </state>
        <state name="Queuing.At.Source" stateType="mandatory">
            <transition
                events="Begin.Reverse"
                newState="Spotting.At.Source"
                conditions="atSource"
                />
            <transition
                events="Begin.Loading Report.Activity"
                newState="Loading"
                />
            <transition
                events="End.Cycle"
                newState="Travelling.Empty"
                />
        </state>

        <state name="Spotting.At.Source" stateType="mandatory">
            <transition
                events="Begin.Loading Report.Activity"
                newState="Loading"
                />
            <transition
                events="End.Cycle"
                newState="Travelling.Empty"
                />
        </state>

        <state name="Loading" stateType="mandatory">
            <transition
                events="Begin.Travelling.Full Exit.Source Enter.Source Enter.Beacon"
                newState="Travelling.Full"
                />
            <transition
                events="End.Cycle"
                newState="Travelling.Empty"
                />
        </state>

        <state name="Travelling.Full" stateType="mandatory">
            <transition
                events="Begin.Stop"
                newState="Queuing.At.Sink"
                conditions="atSink"
                />
            <transition
                events="Begin.Queue Enter.Queue"
                newState="Queuing.At.Sink"
                />
            <transition
                events="Begin.Reverse"
                newState="Spotting.At.Sink"
                conditions="atSink"
                />
            <transition
                events="Begin.Dumping"
                newState="Dumping"
                />
            <transition
                events="End.Cycle"
                newState="Travelling.Empty"
                />
        </state>

        <state name="Queuing.At.Sink" stateType="optional">
            <transition
                events="Begin.Reverse"
                newState="Spotting.At.Sink"
                conditions="atSink"
                />
            <transition
                events="Begin.Reverse.At.Sink"
                newState="Spotting.At.Sink"
                />
            <transition
                events="Exit.Queue"
                newState="[Previous State]"
                />
            <transition
                events="Begin.Dumping"
                newState="Dumping"
                />
            <transition
                events="End.Cycle"
                newState="Travelling.Empty"
                />
        </state>

        <state name="Spotting.At.Sink" stateType="optional">
            <transition
                events="Begin.Dumping"
                newState="Dumping"
                />
            <transition
                events="End.Cycle"
                newState="Travelling.Empty"
                />
        </state>

        <state name="Include.Event" stateType="optional">
            <transition
                events="Report.JobCode Machine.Operator.Change"
                newState="Queing.At.Source"
                />
        </state>
    </StateMachine>

</StateMachineConfiguration>

