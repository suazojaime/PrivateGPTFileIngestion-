<?xml version="1.0"?>
<!-- Copyright (c) 2019 Caterpillar -->

<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="minestar.mine.domain.material" schema="model" default-access="field" default-lazy="false">

    <class name="Blend" table="BLEND">

        <meta attribute="table">
    		tablespace=MW_ENT
        </meta>
        <meta attribute="primary-key">
		    tablespace=MW_IDXENT
        </meta>
        <meta attribute="index">
            name=BLEND_NAME
            unique=true
            columns=NAME
            tablespace=MW_IDXENT
        </meta>
 		<meta attribute="description">A material blend</meta>

        <id name="OID" type="long" column="OID">
            <generator class="com.mincom.env.base.persistence.IDGenerator"/>
        </id>

        <property name="active" type="boolean" column="IS_ACTIVE" not-null="true">
            <meta attribute="defaultValue">true</meta>
            <meta attribute="description">Is the blend active</meta>
        </property>

        <property name="name" type="string" column="NAME" length="254" not-null="true">
           <meta attribute="description">The blend name</meta>
         </property>

        <property name="controlMass" column="CONTROL_MASS">
            <meta attribute="unitType">mass</meta>
            <meta attribute="description">The blend control mass</meta>
             <type name="quantity">
                <param name="nullable">true</param>
                <param name="unitType">mass</param>
            </type>
        </property>

        <property name="controlDuration" column="CONTROL_DURATION">
            <meta attribute="unitType">duration</meta>
            <meta attribute="description">The blend control duration</meta>
            <type name="quantity">
                <param name="nullable">true</param>
                <param name="unitType">duration</param>
            </type>
        </property>

        <property
                name="blendComputationMethod"
                type="minestar.mine.domain.material.BlendComputationMethodEnumUserType"
                column="BLEND_METHOD"
                length="255">
            <meta attribute="description">The destination blend computation method</meta>
        </property>

        <set name="allowedMaterials" table="BLEND_ALLOWED_MATERIAL">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                tablespace=MW_IDXENT
            </meta>

            <meta attribute="choices" inherit="false">entity:Entity.Material</meta>
            <meta attribute="description">The materials allowed for this blend</meta>
            <key column="BLEND_OID" not-null="true"/>
            <many-to-many class="minestar.machinetracking.domain.MaterialReference" column="MATERIAL_OID"/>
        </set>

        <set name="continuousGradeCriteria" table = "BLEND_CRITERIA_CONTINUOUS">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                columns=BLEND_OID, GRADE_OID
                tablespace=MW_IDXENT
            </meta>
			<meta attribute="description">The continuous grade criteria</meta>
            <key column="BLEND_OID" not-null="true"/>

            <composite-element class="ContinuousGradeCriteria">
                <many-to-one class="minestar.production.domain.grade.GradeReference" name="grade" column="GRADE_OID" not-null="true"/>
                <property name="minimumValue" type="double" column="MINIMUMVALUE" not-null="true">
                    <meta attribute="description">The minimum value of the continuous grade criteria</meta>
                </property>
                <property name="maximumValue" type="double" column="MAXIMUMVALUE" not-null="true">
                    <meta attribute="description">The maximum value of the continuous grade criteria</meta>
                </property>
            </composite-element>
        </set>

        <set name="discreteGradeCriteria"
            table = "BLEND_CRITERIA_DISCRETE">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                columns=BLEND_OID, GRADE_OID, GRADE_VALUE
                tablespace=MW_IDXENT
            </meta>
			<meta attribute="description">The discrete grade criteria</meta>
            <key column="BLEND_OID" not-null="true"/>
            <composite-element class="DiscreteGradeCriteria">
                <many-to-one class="minestar.production.domain.grade.GradeReference" name="grade" column="GRADE_OID" not-null="true"/>
                <property name="gradeValue" type="string" column="GRADE_VALUE" not-null="true">
                   <meta attribute="description">The discrete grade value.</meta>
                </property>
                <property name="minimumValue" column="MINIMUM_VALUE" not-null="true">
                    <meta attribute="unitType">ratio</meta>
                    <meta attribute="description">The minimum value of the discrete grade criteria</meta>
                    <type name="quantity">
                        <param name="unitType">ratio</param>
                    </type>
                </property>
                <property name="maximumValue" column="MAXIMUM_VALUE" not-null="true">
                    <meta attribute="unitType">ratio</meta>
                    <meta attribute="description">The maximum value of the discrete grade criteria</meta>
                    <type name="quantity">
                        <param name="unitType">ratio</param>
                    </type>
                </property>
            </composite-element>
        </set>

        <set name="materialCriteria"
            table = "BLEND_CRITERIA_MATERIAL">
            <meta attribute="collection-table">
                tablespace=MW_ENT
            </meta>
            <meta attribute="collection-primary-key">
                columns=BLEND_OID, MATERIAL_OID
                tablespace=MW_IDXENT
            </meta>
			<meta attribute="description">The material criteria</meta>
            <key column="BLEND_OID"/>

            <composite-element class="MaterialCriteria">
                <many-to-one class="minestar.machinetracking.domain.MaterialReference" name="material" column="MATERIAL_OID" not-null="true"/>
                <property name="minimumValue" column="MINIMUM_VALUE" not-null="true">
                    <meta attribute="unitType">ratio</meta>
                    <meta attribute="description">The minimum value of the material criteria</meta>
                    <type name="quantity">
                        <param name="unitType">ratio</param>
                    </type>
                </property>
                <property name="maximumValue" column="MAXIMUM_VALUE" not-null="true">
                    <meta attribute="unitType">ratio</meta>
                    <meta attribute="description">The maximum value of the material criteria</meta>
                    <type name="quantity">
                        <param name="unitType">ratio</param>
                    </type>
                </property>
            </composite-element>
        </set>
    </class>

    <!-- A lightweight reference to a Blend -->
    <class name="BlendReference" table="BLEND" mutable="false" lazy="false">

        <meta attribute="alias" inherit="false">BLEND_REFERENCE</meta>
        <meta attribute="description">A minimal reference to a blend.</meta>
        <meta attribute="view-create-order">1</meta>
        <meta attribute="view-master">true</meta>

        <cache usage="read-only" region="model"/>

        <id name="OID" type="long" column="OID"/>
        <property name="name" type="string" column="NAME" length="254" not-null="true"/>
    </class>
    
</hibernate-mapping>
