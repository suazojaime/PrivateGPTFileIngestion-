<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext /dbchangelog-ext-3.1.xsd">
    <changeSet id="b39d7c3e-5451-4934-a722-9fa121a41091" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for ENTRY_WAYPOINT_OID to table GRADEBLOCK as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <not>
                <columnExists tableName="GRADEBLOCK" columnName="ENTRY_WAYPOINT_OID"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddColumn GRADEBLOCK.ENTRY_WAYPOINT_OID</comment>
        <addColumn tableName="GRADEBLOCK">
            <column name="ENTRY_WAYPOINT_OID" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet id="91b05a1b-35fd-4530-bff5-987ea989b5fa" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for CONNECTING_WAYPOINT_OID to table GRADEBLOCK as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <not>
                <columnExists tableName="GRADEBLOCK" columnName="CONNECTING_WAYPOINT_OID"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddColumn GRADEBLOCK.CONNECTING_WAYPOINT_OID</comment>
        <addColumn tableName="GRADEBLOCK">
            <column name="CONNECTING_WAYPOINT_OID" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet id="ea82015b-468e-45df-8a7d-27c22676994b" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for DESTINATION_OID to table GRADEBLOCK as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <not>
                <columnExists tableName="GRADEBLOCK" columnName="DESTINATION_OID"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddColumn GRADEBLOCK.DESTINATION_OID</comment>
        <addColumn tableName="GRADEBLOCK">
            <column name="DESTINATION_OID" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet id="435e1034-7819-422a-bb07-1cd57a101914" author="MineStar" failOnError="false">
        <preConditions onFailMessage="Ignored AddColumn for PROCESSOR_OID to table GRADEBLOCK as table does not exist or column already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <not>
                <columnExists tableName="GRADEBLOCK" columnName="PROCESSOR_OID"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddColumn GRADEBLOCK.PROCESSOR_OID</comment>
        <addColumn tableName="GRADEBLOCK">
            <column name="PROCESSOR_OID" type="BIGINT"/>
        </addColumn>
    </changeSet>
    <changeSet id="1ab38de3-6223-4cc3-8cc9-2a7739d3ab55" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for GRADEBLOCK_ENTRY_WAYPOINT_O_FK to table GRADEBLOCK as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <tableExists tableName="VIRTUALBEACON"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="GRADEBLOCK" foreignKeyName="GRADEBLOCK_ENTRY_WAYPOINT_O_FK"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddForeignKeyConstraint GRADEBLOCK_ENTRY_WAYPOINT_O_FK to GRADEBLOCK (ENTRY_WAYPOINT_OID)</comment>
        <sql>UPDATE GRADEBLOCK SET ENTRY_WAYPOINT_OID = NULL WHERE ENTRY_WAYPOINT_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM VIRTUALBEACON WHERE VIRTUALBEACON.VIRTUALBEACON_OID = GRADEBLOCK.ENTRY_WAYPOINT_OID)</sql>
        <addForeignKeyConstraint baseTableName="GRADEBLOCK" baseColumnNames="ENTRY_WAYPOINT_OID" constraintName="GRADEBLOCK_ENTRY_WAYPOINT_O_FK" referencedTableName="VIRTUALBEACON" referencedColumnNames="VIRTUALBEACON_OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="GRADEBLOCK" constraintName="GRADEBLOCK_ENTRY_WAYPOINT_O_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="ff20b55d-4790-44b1-a093-9fa2a364df08" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for GRADEBLOCK_CONNECTING_WAYPO_FK to table GRADEBLOCK as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <tableExists tableName="VIRTUALBEACON"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="GRADEBLOCK" foreignKeyName="GRADEBLOCK_CONNECTING_WAYPO_FK"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddForeignKeyConstraint GRADEBLOCK_CONNECTING_WAYPO_FK to GRADEBLOCK (CONNECTING_WAYPOINT_OID)</comment>
        <sql>UPDATE GRADEBLOCK SET CONNECTING_WAYPOINT_OID = NULL WHERE CONNECTING_WAYPOINT_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM VIRTUALBEACON WHERE VIRTUALBEACON.VIRTUALBEACON_OID = GRADEBLOCK.CONNECTING_WAYPOINT_OID)</sql>
        <addForeignKeyConstraint baseTableName="GRADEBLOCK" baseColumnNames="CONNECTING_WAYPOINT_OID" constraintName="GRADEBLOCK_CONNECTING_WAYPO_FK" referencedTableName="VIRTUALBEACON" referencedColumnNames="VIRTUALBEACON_OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="GRADEBLOCK" constraintName="GRADEBLOCK_CONNECTING_WAYPO_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="d30f84db-f38f-4127-8e11-2c8b669d3ded" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for GRADEBLOCK_DESTINATION_OID_FK to table GRADEBLOCK as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <tableExists tableName="LOCATION"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="GRADEBLOCK" foreignKeyName="GRADEBLOCK_DESTINATION_OID_FK"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddForeignKeyConstraint GRADEBLOCK_DESTINATION_OID_FK to GRADEBLOCK (DESTINATION_OID)</comment>
        <sql>UPDATE GRADEBLOCK SET DESTINATION_OID = NULL WHERE DESTINATION_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM LOCATION WHERE LOCATION.LOCATION_OID = GRADEBLOCK.DESTINATION_OID)</sql>
        <addForeignKeyConstraint baseTableName="GRADEBLOCK" baseColumnNames="DESTINATION_OID" constraintName="GRADEBLOCK_DESTINATION_OID_FK" referencedTableName="LOCATION" referencedColumnNames="LOCATION_OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="GRADEBLOCK" constraintName="GRADEBLOCK_DESTINATION_OID_FK"/>
        </rollback>
    </changeSet>
    <changeSet id="2d0ccfe2-9739-4ab9-83c2-6807b1e9ff36" author="MineStar" context="Production/Production_Management" failOnError="false">
        <preConditions onFailMessage="Ignored AddForeignKeyConstraint for GRADEBLOCK_PROCESSOR_OID_FK to table GRADEBLOCK as (1) the table does not exist, or (2) the foreignKey already exists." onFail="MARK_RAN">
            <tableExists tableName="GRADEBLOCK"/>
            <tableExists tableName="MACHINE"/>
            <not>
                <foreignKeyConstraintExists foreignKeyTableName="GRADEBLOCK" foreignKeyName="GRADEBLOCK_PROCESSOR_OID_FK"/>
            </not>
        </preConditions>
        <comment>FLT-3295: AddForeignKeyConstraint GRADEBLOCK_PROCESSOR_OID_FK to GRADEBLOCK (PROCESSOR_OID)</comment>
        <sql>UPDATE GRADEBLOCK SET PROCESSOR_OID = NULL WHERE PROCESSOR_OID IS NOT NULL AND NOT EXISTS (SELECT 'x' FROM MACHINE WHERE MACHINE.MACHINE_OID = GRADEBLOCK.PROCESSOR_OID)</sql>
        <addForeignKeyConstraint baseTableName="GRADEBLOCK" baseColumnNames="PROCESSOR_OID" constraintName="GRADEBLOCK_PROCESSOR_OID_FK" referencedTableName="MACHINE" referencedColumnNames="MACHINE_OID" onDelete="NO ACTION"/>
        <rollback>
            <dropForeignKeyConstraint baseTableName="GRADEBLOCK" constraintName="GRADEBLOCK_PROCESSOR_OID_FK"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
